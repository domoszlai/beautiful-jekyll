(this.webpackJsonpmealee=this.webpackJsonpmealee||[]).push([[0],{119:function(e,t){},120:function(e,t){},122:function(e,t,n){"use strict";n.r(t);n(98);var a=n(0),r=n.n(a),i=n(18),o=n.n(i),c=n(10),l=n(21),s=n(94),u=n(92),m=n(141),d=n(135),p=n(140),f=n(89),g=n(130),h=n(129),v=n(86),y=n(128),E=n(138),b=n(139),w=n(136),S=n(43),I=n(85),k=n(38),x=n.n(k),O=n(28),j=function e(t,n){var a=this;Object(c.a)(this,e),this.recipesMap=void 0,this.index=void 0,this.fieldAccessors=[function(e){return e.getTitle()},function(e){var t;return null!==(t=e.getSummary())&&void 0!==t?t:""},function(e){return e.getIngredients().map((function(e){return e.getName()})).join(" ")}],this.fieldBoostFactors=[2,.5,1],this.termFilter=function(e){return e.normalize("NFD").replace(/[\u0300-\u036f]/g,"").toLowerCase()},this.add=function(t){var n=t.getId(),r=!0;if(a.recipesMap.has(n)&&JSON.stringify(a.recipesMap.get(n))===JSON.stringify(t)&&(r=!1),r){a.delete(n);var i=a.recipesMap.set(n,t);return Object(S.a)(a.index,a.fieldAccessors,k.words,a.termFilter,n,t),new e(a.index,i)}return a},this.addAll=function(e){return e.reduce((function(e,t){return e.add(t)}),a)},this.search=function(e){return Object(I.a)(a.index,a.fieldBoostFactors,1.2,.75,k.words,a.termFilter,void 0,e).reduce((function(e,t){var n=a.recipesMap.get(t.key);return n&&e.push({key:n,score:t.score}),e}),[])},this.all=function(){return Array.from(a.recipesMap.values())},this.get=function(e){return a.recipesMap.get(e)},this.delete=function(t){if(a.recipesMap.has(t)){var n=a.recipesMap.delete(t);return Object(S.d)(a.index,new Set,t),new e(a.index,n)}return a},this.getAll=function(e){return e.reduce((function(e,t){var n=a.recipesMap.get(t);return n&&e.push(n),e}),[])},this.count=function(){return a.recipesMap.size},this.index=t||Object(S.b)(3),this.recipesMap=n||Object(O.b)({})};j.new=function(){return new j};var N=function(){function e(t){Object(c.a)(this,e),this.db=void 0,this.db=t}return Object(l.a)(e,[{key:"getIngredients",value:function(){var e=new Set;this.db.all().forEach((function(t){t.getIngredients().forEach((function(t){e.add(t.getName().toLowerCase())}))}));var t=new Intl.Collator;return Array.from(e).sort(t.compare)}},{key:"getUnits",value:function(){var e=new Set;this.db.all().forEach((function(t){t.getIngredients().forEach((function(t){e.add(t.getUnit().toLowerCase())}))}));var t=new Intl.Collator;return Array.from(e).sort(t.compare)}}]),e}();var C=n(14);var R=function e(){Object(c.a)(this,e),this.name="Minimal number of ingredients",this.id="miningredients",this.filter=function(e,t,n){var a=new Set(e.concat(t).flatMap((function(e){return e.getIngredients().map((function(e){return e.getName()}))}))),r=n.map((function(e){return{recipe:e,score:(t=a,n=e,n.getIngredients().reduce((function(e,n){return t.has(n.getName())?e:e+1}),0))};var t,n})).sort((function(e,t){return e.score<t.score?-1:e.score>t.score?1:0})),i=[];if(r.length>0){var o,c=Object(C.a)(r);try{for(c.s();!(o=c.n()).done;){var l=o.value;if(r[0].score!==l.score)break;i.push(l.recipe)}}catch(s){c.e(s)}finally{c.f()}}return i}};var M=function e(){Object(c.a)(this,e),this.name="Maximal reuse of ingredients",this.id="maxreuse",this.filter=function(e,t,n){var a=new Set(e.concat(t).flatMap((function(e){return e.getIngredients().map((function(e){return e.getName()}))}))),r=n.map((function(e){return{recipe:e,score:(t=a,n=e,n.getIngredients().reduce((function(e,n){return t.has(n.getName())?e+1:e}),0))};var t,n})).sort((function(e,t){return e.score<t.score?1:e.score>t.score?-1:0})),i=[];if(r.length>0){var o,c=Object(C.a)(r);try{for(c.s();!(o=c.n()).done;){var l=o.value;if(r[0].score!==l.score)break;i.push(l.recipe)}}catch(s){c.e(s)}finally{c.f()}}return i}},D=new function e(){Object(c.a)(this,e),this.name="Random filter",this.id="rnd",this.filter=function(e,t,n){return 0===n.length?[]:[n[(a=n.length,Math.floor(Math.random()*Math.floor(a)))]];var a}};var F,T=function(){var e=[new R,new M,D],t=new Map(e.map((function(e){return[e.id,e]})));return{all:function(){return e},get:function(e){return t.get(e)}}}();!function(e){e[e.MinimalNrIngrediants=1]="MinimalNrIngrediants",e[e.MaximalResueOfIngredients=2]="MaximalResueOfIngredients"}(F||(F={}));var A=function(){function e(){Object(c.a)(this,e),this.nrRecipes=void 0,this.optimization=void 0,this.nrRecipes=5,this.optimization=T.all()[0]}return Object(l.a)(e,[{key:"clone",value:function(){return Object.create(this)}}]),e}(),L=function(){function e(t){Object(c.a)(this,e),this.buckets=Object(O.a)(),this.buckets=t}return Object(l.a)(e,[{key:"setNrBuckets",value:function(t){return new e(this.buckets.setSize(t))}},{key:"getNrBuckets",value:function(){return this.buckets.size}},{key:"getNrRecipes",value:function(){var e,t=0,n=Object(C.a)(this.buckets);try{for(n.s();!(e=n.n()).done;){var a=e.value;a&&(t+=a.count())}}catch(r){n.e(r)}finally{n.f()}return t}},{key:"addRecipeId",value:function(t,n){var a,r=null!==(a=this.buckets.get(t))&&void 0!==a?a:Object(O.c)();return new e(this.buckets.set(t,r.add(n)))}},{key:"deleteRecipeId",value:function(t,n){var a,r=null!==(a=this.buckets.get(t))&&void 0!==a?a:Object(O.c)();return new e(this.buckets.set(t,r.delete(n)))}},{key:"getRecipeIds",value:function(e){var t,n=null!==(t=this.buckets.get(e))&&void 0!==t?t:Object(O.c)();return Array.from(n)}},{key:"getAllRecipeIds",value:function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];if(e){var t,n=Object(O.c)(),a=Object(C.a)(this.buckets);try{for(a.s();!(t=a.n()).done;){var r=t.value;r&&(n=n.concat(r))}}catch(s){a.e(s)}finally{a.f()}return Array.from(n)}var i,o=Object(O.a)(),c=Object(C.a)(this.buckets);try{for(c.s();!(i=c.n()).done;){var l=i.value;l&&(o=o.concat(l))}}catch(s){c.e(s)}finally{c.f()}return Array.from(o)}}]),e}();L.new=function(e){return new L(Object(O.a)().setSize(e))};var B=function(){function e(t,n,a){Object(c.a)(this,e),this.name=void 0,this.amount=void 0,this.unit=void 0,this.name=t,this.amount=n,this.unit=a}return Object(l.a)(e,[{key:"getName",value:function(){return this.name}},{key:"getAmount",value:function(){return this.amount}},{key:"getUnit",value:function(){return this.unit}},{key:"toJSON",value:function(){return{name:this.name,amount:this.amount,unit:this.unit}}}],[{key:"fromJSON",value:function(t){if(!t.name)throw new Error("Missing ingredient name");if(!t.unit)throw new Error("Missing ingredient unit");if(void 0===t.amount)throw new Error("Missing ingredient amount");return new e(t.name,t.amount,t.unit)}}]),e}();var P=function(){function e(t,n){Object(c.a)(this,e),this.id=void 0,this.title=void 0,this.summary=void 0,this.source=void 0,this.sourceUrl=void 0,this.readyInMinutes=void 0,this.ingredients=void 0,this.id=t,this.title=n,this.ingredients=[]}return Object(l.a)(e,[{key:"getId",value:function(){return this.id}},{key:"getTitle",value:function(){return this.title}},{key:"getSummary",value:function(){return this.summary}},{key:"getSource",value:function(){return this.source}},{key:"getReadyInMinutes",value:function(){return this.readyInMinutes}},{key:"getIngredients",value:function(){return this.ingredients}},{key:"toJSON",value:function(){return{id:this.id,title:this.title,summary:this.summary,source:this.source,readyInMinutes:this.readyInMinutes,ingredients:this.ingredients.map((function(e){return e.toJSON()}))}}}],[{key:"fromJSON",value:function(t){if(t.id||(t.id="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(function(e){var t=16*Math.random()|0;return("x"===e?t:3&t|8).toString(16)}))),!t.title)throw new Error("Missing recipe title");var n=new e(t.id,t.title);return n.summary=t.summary,n.source=t.source,n.readyInMinutes=t.readyInMinutes,Array.isArray(t.ingredients)&&(n.ingredients=t.ingredients.map((function(e){return B.fromJSON(e)}))),n}}]),e}();var _=n(13),J=n(146),z=n(133),H=n(88),U=n(143),G=n(145),W=n(131),X=n(132),q=function(e){var t=e.recipe,n=t.getSummary()?t.getSummary():"Summary is not available",a=new Intl.Collator,i=t.getIngredients().map((function(e){return e.getName()})).sort(a.compare).map((function(e){return r.a.createElement(v.a,{key:e,sm:"auto",className:"border mt-1 ml-2 pt-2 pb-2"},e)}));return r.a.createElement(y.a,{className:"pl-0 pr-0"},r.a.createElement(h.a,{className:"pb-2"},r.a.createElement(v.a,null,n)),r.a.createElement(h.a,{className:"pb-2"},r.a.createElement(v.a,{sm:"auto"},r.a.createElement(g.a,{src:"clock20x20.jpg"})),r.a.createElement(v.a,{sm:"auto"},t.getReadyInMinutes()?t.getReadyInMinutes()+" mintes":"unknown"),r.a.createElement(v.a,{sm:"auto"},r.a.createElement(g.a,{src:"babyowl17x20.jpg"})),r.a.createElement(v.a,{sm:"auto"},t.getSource()?t.getSource():"-")),r.a.createElement(h.a,null,i))},K=n(142),V=function(e){var t=e.recipe,n=e.selected,a=e.onEdit,i=Object(K.a)({item:{type:"recipe",id:t.getId()},collect:function(e){return{isDragging:!!e.isDragging()}}}),o=Object(_.a)(i,2),c=o[0].isDragging,l=o[1];return r.a.createElement("div",{className:"hover",style:{position:"relative",width:"100%",height:"100%",backgroundColor:"#FFFFFF"}},r.a.createElement(J.a.Item,{className:"mealee-recipe-selector-item",key:t.getId(),ref:l,style:{opacity:c||n?.5:1,cursor:"move"}},t.getTitle()),r.a.createElement("div",{className:"hover-on",style:{position:"absolute",top:10,right:10,height:20,width:40,zIndex:1,opacity:.5}},r.a.createElement(W.a,{height:"18",onClick:function(){return a(t)},style:{cursor:"pointer"}}),"\xa0",r.a.createElement(U.a,{placement:"right",overlay:r.a.createElement(G.a,{id:"popover-basic"},r.a.createElement(G.a.Title,{as:"h4"},t.getTitle()),r.a.createElement(G.a.Content,null,r.a.createElement(q,{recipe:t})))},r.a.createElement(X.a,{height:"18",style:{cursor:"pointer"}}))))},Y=function(e){var t=e.recipeIndex,n=e.plan,a=e.onEdit,i=r.a.useState(""),o=Object(_.a)(i,2),c=o[0],l=o[1],s=0===c.trim().length?t.all():t.search(c).map((function(e){return e.key})),u=new Set(n.getAllRecipeIds()),m=s.map((function(e){return r.a.createElement(V,{key:e.getId(),recipe:e,onEdit:a,selected:u.has(e.getId())})}));return r.a.createElement(b.a,{className:"pt-2 h-100 d-flex flex-column",onSubmit:function(e){return e.preventDefault()}},r.a.createElement(z.a,{className:"mb-1"},r.a.createElement(z.a.Prepend,null,r.a.createElement(z.a.Text,{id:"basic-addon1"},"@")),r.a.createElement(H.a,{type:"text",placeholder:"Filter recipes",onChange:function(e){l(e.currentTarget.value)}})),r.a.createElement(b.a.Group,{controlId:"recipeGroup",className:"flex-grow-1 overflow-auto mealee-recipe-selector-list"},r.a.createElement(J.a,null,m)))},Q=function(e){var t=e.title,n=e.loadButtonTitle,a=e.onClose,i=e.onLoad,o=r.a.useState(null),c=Object(_.a)(o,2),l=c[0],s=c[1];return r.a.createElement(E.a,{show:!0,onHide:a},r.a.createElement(E.a.Header,{closeButton:!0},r.a.createElement(E.a.Title,null,t)),r.a.createElement(E.a.Body,null,r.a.createElement(b.a,null,r.a.createElement(H.a,{type:"file",onChange:function(e){e.target.files?s(e.target.files[0]):s(null)}}))),r.a.createElement(E.a.Footer,null,r.a.createElement(f.a,{type:"button",variant:"secondary",onClick:a},"Close"),r.a.createElement(f.a,{type:"button",variant:"primary",disabled:!l,onClick:function(){l&&i(l)}},n)))},Z=n(90),$=n.n(Z),ee=function(e){var t=e.title,n=e.saveButtonTitle,a=e.onClose,i=e.onSave,o=e.data,c=e.type,l=e.initialFileName,s=e.extension,u=r.a.useState(l),m=Object(_.a)(u,2),d=m[0],p=m[1];return r.a.createElement(E.a,{show:!0,onHide:a},r.a.createElement(E.a.Header,{closeButton:!0},r.a.createElement(E.a.Title,null,t)),r.a.createElement(E.a.Body,null,r.a.createElement(b.a,null,r.a.createElement(b.a.Group,{controlId:"formBasicFileName"},r.a.createElement(b.a.Label,null,"File name"),r.a.createElement(b.a.Control,{type:"fileName",value:d,onChange:function(e){return p(e.target.value)}})))),r.a.createElement(E.a.Footer,null,r.a.createElement(f.a,{type:"button",variant:"secondary",onClick:a},"Close"),r.a.createElement(f.a,{type:"button",variant:"primary",disabled:!d||0===d.length,onClick:function(){$()(o,d+"."+s,c),i()}},n)))},te=n(147),ne=n(134),ae=n(144),re=function(e){var t=e.bucketId,n=e.recipe,a=e.onDelete,i=Object(K.a)({item:{type:"recipe",id:n.getId(),from:t},collect:function(e){return{isDragging:!!e.isDragging()}}}),o=Object(_.a)(i,2),c=o[0].isDragging,l=o[1];return r.a.createElement("div",{ref:l,className:"hover",style:{position:"relative",width:"100%",height:"100%",opacity:c?.5:1,cursor:"move"}},r.a.createElement(te.a,{className:"mealee-bucket-recipe"},r.a.createElement(te.a.Body,{className:"mealee-bucket-recipe-body"},n.getTitle())),r.a.createElement("div",{className:"hover-on",style:{position:"absolute",top:0,right:0,height:40,width:20,zIndex:1,opacity:.5}},r.a.createElement(ne.a,{height:"18",onClick:function(){return a(n.getId())},style:{cursor:"pointer"}}),r.a.createElement(U.a,{placement:"right",overlay:r.a.createElement(G.a,{id:"popover-basic"},r.a.createElement(G.a.Title,{as:"h4"},n.getTitle()),r.a.createElement(G.a.Content,null,r.a.createElement(q,{recipe:n})))},r.a.createElement(X.a,{height:"18",style:{cursor:"pointer"}}))))},ie=function(e){var t=e.bucketId,n=e.recipes,a=e.onDelete;return r.a.createElement(te.a,{className:"mealee-bucket"},r.a.createElement(te.a.Header,{className:"mealee-bucket-header"},"Day "+(t+1)),r.a.createElement(te.a.Body,{className:"mealee-bucket-body"},n.map((function(e){return r.a.createElement(re,{key:e.getId(),bucketId:t,recipe:e,onDelete:function(e){return a(t,e)}})}))))},oe=function(e){var t=e.bucketId,n=e.recipes,a=e.onDrop,i=e.onMove,o=e.onDelete,c=Object(ae.a)({accept:"recipe",drop:function(e){var n=e;void 0!==n.from?i(n.from,t,n.id):a(t,n.id)},collect:function(e){return{isOver:!!e.isOver()}}}),l=Object(_.a)(c,2),s=l[0].isOver,u=l[1];return r.a.createElement("div",{ref:u,style:{position:"relative",width:"100%",height:"100%"}},r.a.createElement(ie,{bucketId:t,recipes:n,onDelete:o}),s&&r.a.createElement("div",{style:{position:"absolute",top:0,left:0,height:"100%",width:"100%",zIndex:1,opacity:.5,backgroundColor:"yellow"}}))},ce=function(e){var t=e.recipeDB,n=e.plan,a=e.updatePlan,i=function(e,t){a(n.addRecipeId(e,t))},o=function(e,t){a(n.deleteRecipeId(e,t))},c=function(e,t,r){a(n.deleteRecipeId(e,r).addRecipeId(t,r))},l=x.a.range(n.getNrBuckets()).map((function(e){return r.a.createElement(v.a,{key:e,className:"pr-2 pl-0"},r.a.createElement(oe,{bucketId:e,recipes:t.getAll(n.getRecipeIds(e)),onDrop:i,onDelete:o,onMove:c}))}));return r.a.createElement(y.a,{className:"pt-0 pb-2 pl-0 pr-0"},r.a.createElement(h.a,null,l))},le=n(25),se=n(11),ue=n.n(se);n(108),n(109),n(110),n(111),n(82),n(112),n(113);function me(e,t){for(var n=[],a=e.split(/\r?\n/),r=0;r<a.length;r++){var i=a[r];if(i.trim().length>0){var o=i.split(";");if(o.length<3)t.push({from:ue.a.Pos(r,0),to:ue.a.Pos(r,i.length),message:"Not enough parts. Syntax: <name>;<amount>;<unit>"});else if(o.length>3){var c=o[0].length+o[1].length+o[2].length+2;t.push({from:ue.a.Pos(r,c),to:ue.a.Pos(r,i.length),message:"Too many parts. Syntax: <name>;<amount>;<unit>"})}else{var l=o[0].length+1,s=l+o[1].length;0===(o=o.map((function(e){return e.trim()})))[0].length||0===o[1].length||0===o[2].length?t.push({from:ue.a.Pos(r,0),to:ue.a.Pos(r,i.length),message:"Empty part(s). Syntax: <name>;<amount>;<unit>"}):""+Number.parseFloat(o[1])!==o[1]?t.push({from:ue.a.Pos(r,l),to:ue.a.Pos(r,s),message:"Amount should be a number."}):n.push({name:o[0],amount:Number.parseFloat(o[1]),unit:o[2]})}}}return n}function de(e,t){return function(n){var a=n.getCursor(),r=n.getLine(a.line),i=a.ch,o=a.ch,c=(r.substring(0,o).match(/;/g)||[]).length;if(0!==c&&2!==c)return null;for(;i&&";"!==r.charAt(i-1);)--i;for(;o<r.length&&";"!==r.charAt(o);)++o;var l=r.slice(i,o).trimLeft().toLowerCase(),s=0===c?e.filter((function(e){return e.indexOf(l)>=0})):t.filter((function(e){return e.startsWith(l)}));return 1===s.length&&s[0]===l&&(s=[]),{list:s,from:ue.a.Pos(a.line,i),to:ue.a.Pos(a.line,o)}}}ue.a.defineMode("ingredients",(function(){var e=0,t=1,n=2,a=3;return{startState:function(){return{location:e}},token:function(r,i){r.sol()&&(i.location=e);var o=r.next();return";"===o&&(i.location===e?i.location=t:i.location===t?i.location=n:i.location=a),i.location===a?"error":";"===o?"keyword":i.location===e?(r.eatWhile((function(e){return";"!==e})),"atom"):i.location===t?(r.eatWhile((function(e){return";"!==e})),"number"):i.location===n?(r.eatWhile((function(e){return";"!==e})),"atom"):"error"}}})),ue.a.registerHelper("lint","ingredients",(function(e){var t=[];return me(e,t),t}));var pe=function(e){var t=r.a.useState(e.recipe?e.recipe.toJSON():Object.create({})),n=Object(_.a)(t,2),a=n[0],i=n[1],o=r.a.useState(!e.recipe),c=Object(_.a)(o,2),l=c[0],s=c[1],u=r.a.useState(!1),m=Object(_.a)(u,2),d=m[0],p=m[1],g=r.a.useState(e.recipe?e.recipe.getIngredients().map((function(e){return e.getName()+";"+e.getAmount()+";"+e.getUnit()})).join("\n"):""),h=Object(_.a)(g,2),v=h[0],y=h[1],w=function(){e.recipe&&e.onDelete(e.recipe)},S=r.a.createRef(),I=r.a.createRef();return r.a.createElement(E.a,{show:!0,onHide:e.onClose,onEntered:function(){if(S.current&&S.current.focus(),I.current){var t=ue.a.fromTextArea(I.current,{lineNumbers:!1,mode:"ingredients",gutters:["CodeMirror-lint-markers"],lint:!0,extraKeys:{"Ctrl-Space":"autocomplete"}});t.on("change",(function(e){!function(e){y(e);var t=[],n=me(e,t);t.length>0?p(!0):(p(!1),i((function(e){return Object(le.a)(Object(le.a)({},e),{ingredients:n})})))}(e.getValue())})),t.on("cursorActivity",(function(t){t.showHint({hint:de(e.recipeService.getIngredients(),e.recipeService.getUnits()),completeSingle:!1,closeOnUnfocus:!0})}))}}},r.a.createElement(E.a.Header,{closeButton:!0},r.a.createElement(E.a.Title,null,"Add new recipe")),r.a.createElement(E.a.Body,null,r.a.createElement(b.a,null,r.a.createElement(b.a.Group,{controlId:"formTitle"},r.a.createElement(b.a.Control,{type:"title",value:a.title,placeholder:"Title",isInvalid:l,onChange:function(e){var t=e.currentTarget.value;s(!t||0===t.length),i((function(e){return Object(le.a)(Object(le.a)({},e),{title:t})}))},ref:S,size:"sm"}),r.a.createElement(b.a.Control.Feedback,{type:"invalid"},"Required field!")),r.a.createElement(b.a.Group,{controlId:"formSummary"},r.a.createElement(b.a.Control,{as:"textarea",value:a.summary,onChange:function(e){var t=e.currentTarget.value;i((function(e){return Object(le.a)(Object(le.a)({},e),{summary:t})}))},rows:4,placeholder:"Summary",size:"sm"})),r.a.createElement(b.a.Group,{controlId:"formSource"},r.a.createElement(b.a.Control,{type:"source",value:a.source,onChange:function(e){var t=e.currentTarget.value;i((function(e){return Object(le.a)(Object(le.a)({},e),{source:t})}))},placeholder:"Where to find the recipe",size:"sm"})),r.a.createElement(b.a.Group,{controlId:"formMinutes"},r.a.createElement(b.a.Control,{type:"minutes",value:a.readyInMinutes,onChange:function(e){var t=Number.parseInt(e.currentTarget.value);isNaN(t)&&(t=void 0),i((function(e){return Object(le.a)(Object(le.a)({},e),{readyInMinutes:t})}))},placeholder:"Number of minutes to cook",size:"sm"})),r.a.createElement(b.a.Group,{controlId:"formIngredients"},r.a.createElement(b.a.Control,{as:"textarea",value:v,ref:I,placeholder:"Ingredients: <name>;<amount>;<unit>"})))),r.a.createElement(E.a.Footer,null,r.a.createElement(f.a,{type:"button",variant:"secondary",onClick:e.onClose},"Close"),r.a.createElement(f.a,{type:"button",variant:"primary",onClick:function(){e.onSave(P.fromJSON(a))},disabled:l||d},"Save recipe"),function(){if(e.recipe)return r.a.createElement(f.a,{type:"button",variant:"primary",onClick:w},"Delete recipe")}()))},fe=n(24),ge=n.n(fe);function he(e){var t=new Map;return e.forEach((function(e){e.getIngredients().forEach((function(n){var a,r=n.getName().toLowerCase(),i=t.get(r);i||(i=new Map,t.set(r,i));var o=null!==(a=i.get(e.getId()))&&void 0!==a?a:[];o.push([n.getAmount(),n.getUnit().toLowerCase()]),i.set(e.getId(),o)}))})),t}function ve(e,t){var n,a=t.map((function(t){var n,a,r=new Map,i=null!==(n=e.get(t))&&void 0!==n?n:new Map,o=Object(C.a)(i.values());try{for(o.s();!(a=o.n()).done;){var c,l=a.value,s=Object(C.a)(l);try{for(s.s();!(c=s.n()).done;){var u,m=Object(_.a)(c.value,2),d=m[0],p=m[1];r.set(p,(null!==(u=r.get(p))&&void 0!==u?u:0)+d)}}catch(f){s.e(f)}finally{s.f()}}}catch(f){o.e(f)}finally{o.f()}return{name:t,amounts:r}})),r=[],i=Object(C.a)(a);try{for(i.s();!(n=i.n()).done;){var o,c=n.value,l=c.name,s=c.amounts,u=[l],m=Object(C.a)(s);try{for(m.s();!(o=m.n()).done;){var d=Object(_.a)(o.value,2),p=d[0],f=d[1];u.push(f+" "+p)}}catch(g){m.e(g)}finally{m.f()}r.push(u)}}catch(g){i.e(g)}finally{i.f()}return r}function ye(e,t){var n,a=he(e.getAll(t.getAllRecipeIds(!1))),r=new Intl.Collator,i=Array.from(a.keys()).sort(r.compare),o=ve(a,i),c="",l=Object(C.a)(o);try{for(l.s();!(n=l.n()).done;){var s=n.value;c+="**"+s.shift()+"**",c+=" - ",c+=s.join(" + "),c+="\n"}}catch(u){l.e(u)}finally{l.f()}return c}function Ee(e,t){var n=e.getAll(t.getAllRecipeIds(!1)),a=new Set(n),r=he(n),i=Array.from(r.keys()).sort(),o=ge.a.utils.book_new(),c=x.a.range(0,t.getNrBuckets()).map((function(n){return["Day #"+(n+1)].concat(e.getAll(t.getRecipeIds(n)).map((function(e){return e.getTitle()})))})),l=ge.a.utils.aoa_to_sheet(c);ge.a.utils.book_append_sheet(o,l,"Plan");var s=ve(r,i),u=ge.a.utils.aoa_to_sheet(s);ge.a.utils.book_append_sheet(o,u,"Shopping list");var m=n.map((function(e){return e.getTitle()}));m.unshift("");var d=i.map((function(e){var t,a=[e],i=Object(C.a)(n);try{for(i.s();!(t=i.n()).done;){var o,c=t.value,l=(null!==(o=r.get(e))&&void 0!==o?o:new Map).get(c.getId());l?a.push(l.map((function(e){return e[0]+" "+e[1]})).join(", ")):a.push("")}}catch(s){i.e(s)}finally{i.f()}return a})),p=[m].concat(d),f=ge.a.utils.aoa_to_sheet(p);ge.a.utils.book_append_sheet(o,f,"Ingredient map");var g,h=Object(C.a)(a);try{for(h.s();!(g=h.n()).done;){var v,y,E,b,w=g.value,S=[["Title",w.getTitle()],["Summary",null!==(v=w.getSummary())&&void 0!==v?v:"-"],["Ready in minutes",null!==(y=w.getReadyInMinutes())&&void 0!==y?y:"-"],["Source",null!==(E=w.getSource())&&void 0!==E?E:"-"],["Ingredients:"]],I=Object(C.a)(w.getIngredients());try{for(I.s();!(b=I.n()).done;){var k=b.value;S.push([k.getName().toLowerCase(),k.getAmount(),k.getUnit().toLowerCase()])}}catch(N){I.e(N)}finally{I.f()}var O=ge.a.utils.aoa_to_sheet(S);ge.a.utils.book_append_sheet(o,O,w.getTitle().substr(0,31))}}catch(N){h.e(N)}finally{h.f()}var j=ge.a.write(o,{bookType:"xlsx",bookSST:!1,type:"array"});return new Blob([j],{type:"application/octet-stream"})}var be=n(93);n(121);var we,Se=function(e){var t=e.onLoadFile,n=e.onNewRecipe,a=e.onSaveFile,i=e.unsavedChanges;return r.a.createElement(m.a,{bg:"mealee-menu",variant:"dark",className:"pl-1"},r.a.createElement(m.a.Brand,{className:"logo",href:"#home"},"Mealee"),r.a.createElement(m.a.Toggle,{"aria-controls":"basic-navbar-nav"}),r.a.createElement(m.a.Collapse,{id:"basic-navbar-nav"},r.a.createElement(d.a,{className:"container-fluid"},r.a.createElement(p.a,{title:"Recipes",id:"collasible-nav-dropdown"},r.a.createElement(p.a.Item,{href:"#",active:!1,onClick:t},"Load recipes..."),r.a.createElement(p.a.Item,{href:"#",active:!1,onClick:a,disabled:!i},"Save recipes..."),r.a.createElement(p.a.Divider,null),r.a.createElement(p.a.Item,{href:"#",active:!1,onClick:n},"Add new recipe...")),r.a.createElement(d.a.Item,{className:"ml-auto"},r.a.createElement(d.a.Link,null,"v","".concat("0.2.2"))))))};!function(e){e[e.LoadFile=0]="LoadFile",e[e.SaveFile=1]="SaveFile",e[e.RecipeEditor=2]="RecipeEditor",e[e.SavePlanXLS=3]="SavePlanXLS",e[e.ShoppingList=4]="ShoppingList"}(we||(we={}));var Ie=function(e){Object(s.a)(n,e);var t=Object(u.a)(n);function n(e){var a;Object(c.a)(this,n),(a=t.call(this,e)).addRecipes=function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];a.setState((function(n){var a=n.unsavedChanges||!(t&&0===n.recipeIndex.count()),r={},i=n.recipeIndex.addAll(e);return i!==n.recipeIndex&&(r={recipeIndex:i,unsavedChanges:a}),r}))},a.saveRecipe=function(e){a.addRecipes([e]),a.closeRecipeEditor()},a.onFileLoaded=function(e){var t,n=null===(t=e.target)||void 0===t?void 0:t.result;if("string"==typeof n)try{a.addRecipes(function(e){var t=JSON.parse(e);if(Array.isArray(t))return t.map(P.fromJSON);if("object"===typeof t){var n=t;if("undefined"!==typeof n.version){if(1!==n.version)throw new Error("Invalid recipe file version");if(Array.isArray(n.recipes))return n.recipes.map(P.fromJSON)}}throw new Error("Invalid recipe file")}(n),!0)}catch(r){a.setState({error:r.message})}a.closeDialog()},a.loadFile=function(e){var t=new FileReader;t.onload=function(e){return a.onFileLoaded(e)},t.readAsText(e,"UTF-8")},a.genRecipeFileContent=function(){return function(e){var t=JSON.stringify({version:1,recipes:e}),n=(new TextEncoder).encode(t);return new Blob([n],{type:"application/json;charset=utf-8"})}(a.state.recipeIndex.all())},a.fileSaved=function(){a.setState({unsavedChanges:!1}),a.closeDialog()},a.showDialog=function(e){return function(){return a.setState({showDialog:e})}},a.closeDialog=function(){a.setState({showDialog:void 0})},a.closeRecipeEditor=function(){a.setState({recipeToEdit:void 0,showDialog:void 0})},a.dismissError=function(){a.setState({error:null})},a.updatePlanSettings=function(e){a.setState((function(t){return{planSettings:e,plan2:t.plan2.setNrBuckets(e.nrRecipes)}}))},a.updatePlan=function(e){a.setState({plan2:e})},a.editRecipe=function(e){a.setState({showDialog:we.RecipeEditor,recipeToEdit:e})},a.deleteRecipe=function(e){a.setState((function(t){return{recipeIndex:t.recipeIndex.delete(e.getId()),showDialog:void 0,recipeToEdit:void 0,unsavedChanges:!0}}))},a.exportButtons=function(){return a.state.plan2.getNrRecipes()>0?r.a.createElement(h.a,null,r.a.createElement(v.a,{className:"pl-0"},r.a.createElement(f.a,{variant:"mealee",onClick:a.showDialog(we.SavePlanXLS)},"Export plan \xa0",r.a.createElement(g.a,{src:"xlsx_logo.svg",height:"18"})),r.a.createElement(f.a,{className:"ml-2",variant:"mealee",onClick:a.showDialog(we.ShoppingList)},"Show shopping list \xa0",r.a.createElement(g.a,{src:"todoist_logo.svg",height:"18"})))):r.a.createElement(r.a.Fragment,null)},a.renderDialog=function(){switch(a.state.showDialog){case we.LoadFile:return r.a.createElement(Q,{onClose:a.closeDialog,title:"Load recipes file",loadButtonTitle:"Load recipes",onLoad:a.loadFile});case we.SaveFile:return r.a.createElement(ee,{onClose:a.closeDialog,title:"Save recipes file",saveButtonTitle:"Save recipes",data:a.genRecipeFileContent(),type:"application/json",initialFileName:"recipes",extension:"json",onSave:a.fileSaved});case we.RecipeEditor:return r.a.createElement(pe,{onClose:a.closeRecipeEditor,onSave:a.saveRecipe,onDelete:a.deleteRecipe,recipe:a.state.recipeToEdit,recipeService:new N(a.state.recipeIndex)});case we.SavePlanXLS:return r.a.createElement(ee,{onClose:a.closeDialog,title:"Save plan",saveButtonTitle:"Save plan",data:Ee(a.state.recipeIndex,a.state.plan2),type:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet",initialFileName:"plan",extension:"xlsx",onSave:a.closeDialog});case we.ShoppingList:return r.a.createElement(E.a,{show:!0,onHide:a.closeDialog},r.a.createElement(E.a.Header,{closeButton:!0},r.a.createElement(E.a.Title,null,"Shopping list")),r.a.createElement(E.a.Body,null,r.a.createElement(b.a,null,r.a.createElement(b.a.Control,{as:"textarea",rows:20,cols:80,value:ye(a.state.recipeIndex,a.state.plan2),readOnly:!0}))),r.a.createElement(E.a.Footer,null,r.a.createElement(f.a,{variant:"secondary",onClick:a.closeDialog},"Close")));default:return r.a.createElement(r.a.Fragment,null)}};var i=new j,o=new A;return a.state={recipeIndex:i,planSettings:o,plan2:L.new(o.nrRecipes),showDialog:void 0,recipeToEdit:void 0,error:null,unsavedChanges:!1},a}return Object(l.a)(n,[{key:"render",value:function(){var e=this;return r.a.createElement(y.a,{fluid:!0,className:"d-flex flex-column vh-100"},r.a.createElement(w.a,{variant:"danger",onClose:this.dismissError,show:!!this.state.error,dismissible:!0},this.state.error),function(){if(e.state.unsavedChanges)return r.a.createElement(be.a,{onBeforeunload:function(){return"You'll lose your data!"}})}(),this.renderDialog(),r.a.createElement(h.a,null,r.a.createElement(v.a,null,r.a.createElement(Se,{onLoadFile:this.showDialog(we.LoadFile),onNewRecipe:this.showDialog(we.RecipeEditor),onSaveFile:this.showDialog(we.SaveFile),unsavedChanges:this.state.unsavedChanges}))),0===e.state.recipeIndex.count()?r.a.createElement(h.a,null,r.a.createElement(v.a,{xs:"12",className:"pt-3"},r.a.createElement(w.a,{key:"recipe",variant:"warning"},"There are no recipes. ",r.a.createElement(f.a,{variant:"info",onClick:e.showDialog(we.LoadFile)},"Load some")," or ",r.a.createElement(f.a,{variant:"info",onClick:e.showDialog(we.RecipeEditor)},"add a new one"),"."))):r.a.createElement(h.a,{className:"h-100",style:{minHeight:0}},r.a.createElement(v.a,{xs:"3",className:"h-100",style:{minHeight:0}},r.a.createElement(Y,{plan:e.state.plan2,recipeIndex:e.state.recipeIndex,onEdit:e.editRecipe})),r.a.createElement(v.a,null,r.a.createElement(y.a,{className:"pt-2 pl-0 pr-0"},r.a.createElement(h.a,null,r.a.createElement(v.a,null,r.a.createElement(ce,{recipeDB:e.state.recipeIndex,plan:e.state.plan2,updatePlan:e.updatePlan}))),e.exportButtons()))))}}]),n}(r.a.Component),ke=n(137),xe=n(91);o.a.render(r.a.createElement(r.a.StrictMode,null,r.a.createElement(ke.a,{backend:xe.a},r.a.createElement(Ie,null))),document.getElementById("root"))},84:function(e,t){},97:function(e,t,n){e.exports=n(122)},98:function(e,t,n){}},[[97,1,2]]]);
//# sourceMappingURL=main.8fdb114c.chunk.js.map