{"version":3,"sources":["model/Recipe.tsx","components/RecipeSelector.tsx","RecipeDB.tsx","components/LoadFileDialog.tsx","components/SaveFileDialog.tsx","filters/RandomFilter.tsx","filters/MinIngredientsFilter.tsx","filters/MaxReuseFilter.tsx","filters/Filter.tsx","model/PlanSettings.tsx","components/PlanSettings.tsx","PlanExporter.ts","components/PlanVisualizer.tsx","components/RecipeEditor.tsx","model/Plan.tsx","Planner.tsx","App.tsx","index.js"],"names":["Ingredient","name","amount","unit","this","o","Error","undefined","Recipe","id","title","summary","source","sourceUrl","readyInMinutes","ingredients","map","i","toJSON","replace","c","r","Math","random","toString","Array","isArray","fromJSON","RecipeSelector","recipeIndex","selectedRecipes","maxNrSelected","onUpdate","onEdit","React","useState","filter","setFilter","currentRecipeid","setCurrentRecipeId","filteredRecipes","trim","length","all","search","res","key","selectedRecipeMap","Map","getId","renderRecipe","recipe","getSummary","getIngredients","getName","sort","n","Col","sm","className","Popover","Title","as","getTitle","Content","Container","Row","Image","src","getReadyInMinutes","getSource","listItems","OverlayTrigger","placement","overlay","onEnter","onExit","ListGroup","Item","Form","Check","type","label","disabled","has","size","checked","onChange","delete","set","from","values","Button","variant","onClick","e","editButton","onSubmit","preventDefault","InputGroup","Prepend","Text","FormControl","placeholder","event","currentTarget","value","Group","controlId","RecipeIndex","index","recipesMap","fieldAccessors","join","fieldBoostFactors","termFilter","term","toLowerCase","add","toUpdate","JSON","stringify","get","newMap","addDocumentToIndex","words","addAll","recipes","reduce","idx","q","query","acc","push","score","removeDocumentFromIndex","Set","getAll","keys","count","createIndex","new","LoadFileDialog","loadButtonTitle","onClose","onLoad","file","setFile","Modal","show","onHide","Header","closeButton","Body","target","files","Footer","SaveFileDialog","saveButtonTitle","onSave","data","initialFileName","extension","fileName","setFileName","Label","Control","download","MinIngredientsFilter","explicitRecipes","remainingRecipes","ingredientsAlreadyUsed","concat","flatMap","scoredRecipes","ingredientsAlreadyUSed","sum","a","b","result","scoredRecipe","MaxReuseFilter","randomFilter","max","floor","Optimization","filters","filterMap","f","createFilters","PlanSettingsPanel","props","collapsed","setCollapsed","filterList","Accordion","defaultActiveKey","Card","Toggle","eventKey","Collapse","planSettings","nrRecipes","newNrRecipes","newSettings","clone","changeNrRecipes","parseInt","optimization","filterId","changeOptimization","PlanSettings","Object","create","getIngredientMap","ingredientMap","forEach","oneIngredientRecord","getAmount","getUnit","exportPlan","plan","allRecipes","wb","XLSX","utils","book_new","ingredientList","ingredient","ingredientsRows","amounts","line","ingredientsWS","aoa_to_sheet","book_append_sheet","planHeaderRow","unshift","planDataRows","recipeIngredient","planRows","planWS","recipeRows","recipeWS","bytes","write","bookType","bookSST","Blob","PlanVisualizer","explicitRecipeHeaderList","calculatedRecipeHeaderList","calculatedRecipes","ingredientLineList","perRecipe","Table","striped","bordered","RecipeEditor","recipeJSON","setRecipeJSON","isTitleInvalid","setIsTitleInvalid","isIngredientsInvalid","setIsIngredientsInvalid","ingredientCSV","setIngredientCSV","deleteRecipe","onDelete","focusElement","createRef","onEntered","current","focus","isInvalid","newVal","ref","Feedback","rows","Number","isNaN","lines","split","invalid","parts","s","Plan","optimizePlan","previousPlan","settings","nrRecipesToCalculate","allRecipeIds","freeRecipeIds","calcultedRecipes","freeRecipes","currentRecipes","finalRecipe","newPlan","Dialog","Menu","onLoadFile","onNewRecipe","onSaveFile","unsavedChanges","Navbar","bg","Brand","href","aria-controls","Nav","NavDropdown","active","Divider","App","addRecipes","newRecipes","fromFile","setState","st","needsSave","ret","newRecipeIndex","saveRecipe","closeRecipeEditor","onFileLoaded","ev","json","parse","version","deserializeRecipes","error","message","closeDialog","loadFile","reader","FileReader","onload","readAsText","genRecipeFileContent","state","fileSaved","showDialog","dialog","recipeToEdit","dismissError","updatePlanSettings","ps","updateExplicitRecipes","newExplicitRecipes","editRecipe","renderDialog","LoadFile","SaveFile","SavePlanXLS","fluid","Alert","dismissible","onBeforeunload","xs","Component","ReactDOM","render","StrictMode","document","getElementById"],"mappings":"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","file":"static/js/main.6eb39369.chunk.js","sourcesContent":["export interface IngredientJSON {\r\n    name: string,\r\n    amount: number,\r\n    unit: string\r\n}   \r\n \r\nexport interface RecipeJSON {\r\n    id: string,\r\n    title: string,\r\n    source?: string,\r\n    summary?: string,\r\n    readyInMinutes?: number,\r\n    ingredients: IngredientJSON[]\r\n}\r\n\r\ninterface RecipeFileJSON {\r\n    version: number,\r\n    recipes: RecipeJSON[]\r\n}\r\n\r\nexport class Ingredient {\r\n\r\n    private constructor(name: string, amount: number, unit: string)\r\n    {\r\n        this.name = name;\r\n        this.amount = amount;\r\n        this.unit = unit;\r\n    }\r\n\r\n    public getName(): string\r\n    {\r\n        return this.name;\r\n    }\r\n\r\n    public getAmount(): number\r\n    {\r\n        return this.amount;\r\n    }\r\n\r\n    public getUnit(): string\r\n    {\r\n        return this.unit;\r\n    }\r\n\r\n    public static fromJSON(o: IngredientJSON) : Ingredient\r\n    {\r\n        if(!o.name)\r\n        {\r\n            throw new Error(\"Missing ingredient name\");\r\n        }\r\n\r\n        if(!o.unit)\r\n        {\r\n            throw new Error(\"Missing ingredient unit\");\r\n        }\r\n\r\n        if(o.amount === undefined)\r\n        {\r\n            throw new Error(\"Missing ingredient amount\");\r\n        }\r\n\r\n        return new Ingredient(o.name, o.amount, o.unit);\r\n    }\r\n\r\n    public toJSON() : IngredientJSON\r\n    {\r\n        return {\r\n            name: this.name,\r\n            amount: this.amount,\r\n            unit: this.unit\r\n        }\r\n    }\r\n\r\n    private name: string; \r\n    private amount: number;\r\n    private unit: string;\r\n}\r\n\r\nfunction uuidv4() {\r\n    return 'xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx'.replace(/[xy]/g, function(c) {\r\n      var r = Math.random() * 16 | 0, v = c === 'x' ? r : ((r & 0x3) | 0x8);\r\n      return v.toString(16);\r\n    });\r\n  }\r\n\r\nexport class Recipe {\r\n    \r\n    private constructor(id: string, title: string)\r\n    {\r\n        this.id = id;\r\n        this.title = title;\r\n        this.ingredients = [];\r\n    }\r\n\r\n    public getId(): string\r\n    {\r\n        return this.id;\r\n    }\r\n\r\n    public getTitle(): string\r\n    {\r\n        return this.title;\r\n    }\r\n\r\n    public getSummary(): string | undefined\r\n    {\r\n        return this.summary;\r\n    }\r\n\r\n    public getSource(): string | undefined\r\n    {\r\n        return this.source;\r\n    }\r\n\r\n    public getReadyInMinutes(): number | undefined\r\n    {\r\n        return this.readyInMinutes;\r\n    }\r\n\r\n    public getIngredients(): Ingredient[] \r\n    {\r\n        return this.ingredients;\r\n    }\r\n\r\n    public static fromJSON(o: RecipeJSON) : Recipe\r\n    {\r\n        if(!o.id)\r\n        {\r\n            o.id = uuidv4();\r\n        }\r\n\r\n        if(!o.title)\r\n        {\r\n            throw new Error(\"Missing recipe title\");\r\n        }\r\n\r\n        let r = new Recipe(o.id, o.title);\r\n\r\n        r.summary = o.summary;\r\n        r.source = o.source;\r\n        r.readyInMinutes = o.readyInMinutes;\r\n\r\n        if(Array.isArray(o.ingredients))\r\n        {\r\n            r.ingredients = o.ingredients.map(i => Ingredient.fromJSON(i));\r\n        }\r\n\r\n        return r;\r\n    }\r\n\r\n    public toJSON() : RecipeJSON\r\n    {\r\n        return {\r\n            id: this.id,\r\n            title: this.title,\r\n            summary: this.summary,\r\n            source: this.source,\r\n            readyInMinutes: this.readyInMinutes,\r\n            ingredients: this.ingredients.map(i=>i.toJSON())\r\n        }\r\n    }\r\n\r\n    private id: string;\r\n    private title: string;\r\n    private summary?: string;\r\n    private source?: string;\r\n    private sourceUrl?: string;\r\n    private readyInMinutes?: number;\r\n    private ingredients: Ingredient[];\r\n}\r\n\r\nexport function serializeRecipes(recipes: Recipe[]) {\r\n    return JSON.stringify({version: 1, recipes: recipes});\r\n}\r\n\r\nexport function deserializeRecipes(data: string) {\r\n    let json = JSON.parse(data);\r\n\r\n    if(Array.isArray(json))\r\n    {\r\n        let v0: RecipeJSON[] = json;\r\n        return v0.map(Recipe.fromJSON);\r\n    }\r\n\r\n    if(typeof json === 'object')\r\n    {\r\n        let r: RecipeFileJSON = json;\r\n        \r\n        if(typeof r.version !== 'undefined')\r\n        {\r\n            if(r.version !== 1)\r\n            {\r\n                throw new Error(\"Invalid recipe file version\");\r\n            }\r\n    \r\n            if(Array.isArray(r.recipes))\r\n            {\r\n                return r.recipes.map(Recipe.fromJSON);\r\n            }    \r\n        }\r\n    }\r\n\r\n    throw new Error(\"Invalid recipe file\");\r\n}","import React, {FunctionComponent} from 'react';\r\n\r\nimport {Form, ListGroup, FormControl, InputGroup} from 'react-bootstrap';\r\nimport {Container, OverlayTrigger, Popover, Col, Row, Image} from 'react-bootstrap';\r\nimport {Button} from 'react-bootstrap';\r\n\r\nimport {Recipe} from '../model/Recipe';\r\nimport {RecipeIndex} from '../RecipeDB';\r\n\r\ntype RecipeSelectorProps = {\r\n    recipeIndex: RecipeIndex,\r\n    selectedRecipes: Recipe[],\r\n    maxNrSelected: number,\r\n    onUpdate: (recipes: Recipe[]) => void,\r\n    onEdit: (recipe: Recipe) => void\r\n}\r\n\r\nexport const RecipeSelector: FunctionComponent<RecipeSelectorProps> = ({recipeIndex, selectedRecipes, maxNrSelected, onUpdate, onEdit}) => {\r\n\r\n    const [filter, setFilter] = React.useState(\"\");\r\n    const [currentRecipeid, setCurrentRecipeId] = React.useState<string | null>(null);\r\n\r\n    const refresh = (event : React.ChangeEvent<HTMLInputElement>) => {\r\n        setFilter(event.currentTarget.value);\r\n    }\r\n\r\n    const filteredRecipes = (filter.trim().length === 0) ? \r\n        recipeIndex.all() : recipeIndex.search(filter).map(res=>res.key);\r\n\r\n    const selectedRecipeMap = new Map(selectedRecipes.map(r => [r.getId(), r]))\r\n\r\n    const toggleSelection = (r: Recipe) => {\r\n        if(selectedRecipeMap.has(r.getId()))\r\n        {\r\n            selectedRecipeMap.delete(r.getId());\r\n        }\r\n        else\r\n        {\r\n            selectedRecipeMap.set(r.getId(), r);\r\n        }\r\n\r\n        onUpdate(Array.from(selectedRecipeMap.values()));\r\n    }\r\n\r\n    const renderRecipe = (recipe: Recipe) => {\r\n\r\n        const summary = recipe.getSummary() ? recipe.getSummary() : \"Summary is not available\"\r\n        const ingredients = recipe.getIngredients().map(r=> r.getName())\r\n                                              .sort()\r\n                                              .map(n => <Col sm=\"auto\" className=\"border mt-1 ml-2 pt-2 pb-2\">{n}</Col>)\r\n\r\n        return (\r\n            <Popover id=\"popover-basic\">\r\n                <Popover.Title as=\"h4\">{recipe.getTitle()}</Popover.Title>\r\n                <Popover.Content>\r\n                <Container className=\"pl-0 pr-0\">\r\n                <Row className=\"pb-2\">\r\n                    <Col>{summary}</Col>\r\n                </Row>\r\n                <Row className=\"pb-2\">\r\n                    <Col sm=\"auto\"><Image src=\"clock20x20.jpg\"/></Col>\r\n                    <Col sm=\"auto\">{recipe.getReadyInMinutes() ? \"\" + recipe.getReadyInMinutes() + \" mintes\" : \"unknown\"}</Col>\r\n                    <Col sm=\"auto\"><Image src=\"babyowl17x20.jpg\"/></Col>\r\n                    <Col sm=\"auto\">{recipe.getSource() ? recipe.getSource() : \"-\"}</Col>\r\n                </Row>\r\n                <Row>\r\n                        {ingredients}\r\n                </Row>\r\n                </Container> \r\n                </Popover.Content>\r\n            </Popover>)\r\n    }\r\n\r\n    const editButton = (recipe: Recipe) => {\r\n        if(currentRecipeid===recipe.getId())\r\n        {\r\n            return <Button variant=\"outline-primary\" size=\"sm\" className=\"mt-2\" onClick={e=>onEdit(recipe)}>Edit</Button>\r\n        }\r\n        else\r\n        {\r\n            return \"\"\r\n        }\r\n    }\r\n\r\n    const listItems = filteredRecipes\r\n        .map((recipe) =>\r\n                <OverlayTrigger placement=\"right\" overlay={renderRecipe(recipe)} \r\n                                    onEnter={()=>setCurrentRecipeId(recipe.getId())}\r\n                                    onExit={()=>setCurrentRecipeId(null)}\r\n                                    key={recipe.getId()}>\r\n                    <ListGroup.Item key={recipe.getId()}>\r\n                        <Form.Check type=\"checkbox\" \r\n                                    id={recipe.getId()}\r\n                                    label={recipe.getTitle()}\r\n                                    disabled={!selectedRecipeMap.has(recipe.getId()) && selectedRecipeMap.size >= maxNrSelected}\r\n                                    checked={selectedRecipeMap.has(recipe.getId())}\r\n                                    onChange={() => toggleSelection(recipe)}/>\r\n                        {editButton(recipe)}\r\n                    </ListGroup.Item>\r\n                </OverlayTrigger>\r\n            );\r\n\r\n    return (\r\n        <Form className=\"pt-2\" onSubmit={(e)=>e.preventDefault()}>\r\n        <InputGroup className=\"mb-2\">\r\n        <InputGroup.Prepend>\r\n        <InputGroup.Text id=\"basic-addon1\">@</InputGroup.Text>\r\n        </InputGroup.Prepend>\r\n        <FormControl type=\"text\" placeholder=\"Filter recipes\" onChange={refresh}/>\r\n        </InputGroup>\r\n        <Form.Group controlId=\"recipeGroup\">\r\n            <ListGroup>{listItems}</ListGroup>\r\n        </Form.Group>\r\n        </Form>\r\n    );\r\n}","import { Index, createIndex, addDocumentToIndex, removeDocumentFromIndex } from 'ndx';\r\nimport { query, QueryResult } from 'ndx-query';\r\nimport { words } from 'lodash';\r\n\r\nimport { Recipe } from './model/Recipe';\r\n\r\nimport { Map } from 'immutable';\r\n\r\nexport class RecipeIndex {\r\n\r\n    private readonly recipesMap: Map<string, Recipe>;\r\n    private readonly index: Index<string>;\r\n\r\n    private readonly fieldAccessors = [\r\n        (r: Recipe) => r.getTitle(),\r\n        (r: Recipe) => r.getSummary() ?? \"\",\r\n        (r: Recipe) => r.getIngredients().map(i => i.getName()).join(\" \")\r\n    ]\r\n\r\n    private readonly fieldBoostFactors = [2, 0.5, 1];\r\n\r\n    constructor(index?: Index<string>, recipesMap?: Map<string, Recipe>) {\r\n        this.index = index ? index : createIndex<string>(3);\r\n        this.recipesMap = recipesMap ? recipesMap : Map({}); \r\n    }\r\n\r\n    private termFilter = (term: string) => {\r\n        return term.toLowerCase();\r\n    }\r\n\r\n    public static new = () => {\r\n        return new RecipeIndex();\r\n    }\r\n\r\n    // `add()` function will add documents to the index.\r\n    public add = (r: Recipe) => {\r\n        let key = r.getId();\r\n\r\n        let toUpdate = true;\r\n\r\n        if(this.recipesMap.has(key))\r\n        {\r\n            if(JSON.stringify(this.recipesMap.get(key)) === JSON.stringify(r))\r\n            {\r\n                toUpdate = false;\r\n            }\r\n        }\r\n\r\n        if(toUpdate)\r\n        {\r\n            // Don't add the same document twice, ndx becomes crazy...\r\n            this.delete(key);\r\n            let newMap = this.recipesMap.set(key, r);\r\n\r\n            addDocumentToIndex(\r\n                this.index,\r\n                this.fieldAccessors,\r\n                // Tokenizer is a function that breaks text into words, phrases, symbols, or other meaningful elements\r\n                // called tokens.\r\n                // Lodash function `words()` splits string into an array of its words, see https://lodash.com/docs/#words for\r\n                // details.\r\n                words,\r\n                // Filter is a function that processes tokens and returns terms, terms are used in Inverted Index to\r\n                // index documents.\r\n                this.termFilter,\r\n                // Document key, it can be a unique document id or a reference to a document if you want to store all documents\r\n                // in memory.\r\n                key,\r\n                // Document.\r\n                r,\r\n            );\r\n\r\n            return new RecipeIndex(this.index, newMap);\r\n        }\r\n        else\r\n        {\r\n            return this;\r\n        }\r\n    };\r\n\r\n    public addAll = (recipes: Recipe[]) => {\r\n        return recipes.reduce((idx: RecipeIndex, recipe: Recipe) => {\r\n            return idx.add(recipe);\r\n        }, this);\r\n    };\r\n\r\n    // `search()` function will be used to perform queries.\r\n    public search = (q: string) => query<string>(\r\n          this.index,\r\n          this.fieldBoostFactors,\r\n          // BM25 ranking function constants:\r\n          1.2,  // BM25 k1 constant, controls non-linear term frequency normalization (saturation).\r\n          0.75, // BM25 b constant, controls to what degree document length normalizes tf values.\r\n          words,\r\n          this.termFilter,\r\n          // Set of removed documents, in this example we don't want to support removing documents from the index,\r\n          // so we can ignore it by specifying this set as `undefined` value.\r\n          undefined, \r\n          q,\r\n        ).reduce((acc: QueryResult<Recipe>[],res) => {\r\n            let r = this.recipesMap.get(res.key);\r\n            if(r)\r\n            {\r\n                acc.push({key: r, score: res.score});\r\n            }\r\n            return acc;\r\n        }, []);\r\n\r\n    public all = () => {\r\n        return Array.from(this.recipesMap.values());\r\n    };\r\n\r\n    public get = (key: string) => {\r\n        return this.recipesMap.get(key);\r\n    };\r\n\r\n    public delete = (key: string) => {\r\n        if(this.recipesMap.has(key))\r\n        {\r\n            let newMap = this.recipesMap.delete(key);\r\n            removeDocumentFromIndex(\r\n                this.index,\r\n                new Set(),\r\n                key);    \r\n            return new RecipeIndex(this.index, newMap);    \r\n        }\r\n        else\r\n        {\r\n            return this;\r\n        }\r\n    };\r\n\r\n    public getAll = (keys: string[]) => {\r\n        return keys.reduce((acc: Recipe[],key) => {\r\n            let r = this.recipesMap.get(key);\r\n            if(r)\r\n            {\r\n                acc.push(r);\r\n            }\r\n            return acc;\r\n        }, []);\r\n    };\r\n\r\n    public count = () => {\r\n        return this.recipesMap.size;\r\n    }\r\n};\r\n    \r\n","import React, {FunctionComponent} from 'react';\r\n\r\nimport {Modal, Form, FormControl, Button} from 'react-bootstrap';\r\n\r\ntype LoadFileDialogProps = {\r\n    title: string,\r\n    loadButtonTitle: string,\r\n    onClose: () => void,\r\n    onLoad: (file: File) => void\r\n}\r\n\r\nexport const LoadFileDialog: FunctionComponent<LoadFileDialogProps> = ({title, loadButtonTitle, onClose, onLoad}) => {\r\n\r\n    const [file, setFile] = React.useState<null | File>(null);\r\n\r\n    return (\r\n        <Modal show={true} onHide={onClose}>\r\n        <Modal.Header closeButton>\r\n        <Modal.Title>{title}</Modal.Title>\r\n        </Modal.Header>\r\n        <Modal.Body>\r\n        <Form>\r\n        <FormControl type=\"file\" onChange={(e: React.ChangeEvent<HTMLInputElement>) => {\r\n                                                if(e.target.files)\r\n                                                {\r\n                                                    setFile(e.target.files[0])\r\n                                                }\r\n                                                else\r\n                                                {\r\n                                                    setFile(null)\r\n                                                }\r\n                                            }}/>\r\n        </Form>\r\n        </Modal.Body>\r\n        <Modal.Footer>\r\n            <Button type=\"button\" variant=\"secondary\" onClick={onClose}>Close</Button>\r\n            <Button type=\"button\" variant=\"primary\" disabled={!file} \r\n                        onClick={() => {if(file) onLoad(file)}}>{loadButtonTitle}</Button>\r\n        </Modal.Footer>   \r\n        </Modal>\r\n    );\r\n}","import React, {FunctionComponent} from 'react';\r\n\r\nimport {Modal, Form, Button} from 'react-bootstrap';\r\n\r\nimport download from 'downloadjs'\r\n\r\ntype SaveFileDialogProps = {\r\n    title: string,\r\n    saveButtonTitle: string,\r\n    data: string | Blob,\r\n    type: string,\r\n    initialFileName: string,\r\n    extension: string,\r\n    onClose: () => void,\r\n    onSave: () => void\r\n}\r\n\r\nexport const SaveFileDialog: FunctionComponent<SaveFileDialogProps> \r\n                = ({title, saveButtonTitle, onClose, onSave, data, type, initialFileName, extension }) => {\r\n\r\n    const [fileName, setFileName] = React.useState(initialFileName);\r\n\r\n    const startDownload = () => {\r\n        download(data, fileName+\".\"+extension, type)\r\n    }\r\n\r\n    return (\r\n        <Modal show={true} onHide={onClose}>\r\n        <Modal.Header closeButton>\r\n        <Modal.Title>{title}</Modal.Title>\r\n        </Modal.Header>\r\n        <Modal.Body>\r\n        <Form>\r\n        <Form.Group controlId=\"formBasicFileName\">\r\n        <Form.Label>File name</Form.Label>\r\n        <Form.Control type=\"fileName\" value={fileName} onChange={(e: React.ChangeEvent<HTMLInputElement>) => setFileName(e.target.value)}/>\r\n        </Form.Group>\r\n        </Form>\r\n        </Modal.Body>\r\n        <Modal.Footer>\r\n            <Button type=\"button\" variant=\"secondary\" onClick={onClose}>Close</Button>\r\n            <Button type=\"button\" variant=\"primary\" disabled={!fileName || fileName.length===0} \r\n                        onClick={() => {startDownload(); onSave()}}>{saveButtonTitle}</Button>\r\n        </Modal.Footer>   \r\n        </Modal>\r\n    );\r\n}","import {Filter} from './Filter';\r\nimport {Recipe} from '../model/Recipe';\r\n\r\nfunction getRandomInt(max: number) {\r\n    return Math.floor(Math.random() * Math.floor(max));\r\n}\r\n\r\nexport class RandomFilter implements Filter {\r\n    public name = \"Random filter\";\r\n    public id =\"rnd\";\r\n    public filter = (explicitRecipes: Recipe[], selectedRecipes: Recipe[], remainingRecipes: Recipe[]) => {\r\n        if(remainingRecipes.length === 0)\r\n        {\r\n            return []\r\n        }\r\n        else\r\n        {\r\n            return [remainingRecipes[getRandomInt(remainingRecipes.length)]];\r\n        }\r\n    }\r\n}","import {Filter} from './Filter';\r\nimport {Recipe} from '../model/Recipe';\r\n\r\nfunction getScore(ingredientsAlreadyUSed: Set<string>, recipe: Recipe) {\r\n    \r\n    return recipe.getIngredients().reduce((sum, i) => {\r\n        if(ingredientsAlreadyUSed.has(i.getName()))\r\n        {\r\n            return sum;\r\n        }\r\n        else\r\n        {\r\n            return sum+1;\r\n        }\r\n    }, 0);\r\n}\r\n\r\nexport class MinIngredientsFilter implements Filter {\r\n    public name = \"Minimal number of ingredients\";\r\n    public id =\"miningredients\";\r\n    public filter = (explicitRecipes: Recipe[], selectedRecipes: Recipe[], remainingRecipes: Recipe[]) => {\r\n\r\n        const ingredientsAlreadyUsed = new Set<string>(\r\n            explicitRecipes.concat(selectedRecipes).flatMap(r => r.getIngredients().map(i => i.getName())));\r\n\r\n        const scoredRecipes = remainingRecipes\r\n            .map(r => ({recipe: r, score: getScore(ingredientsAlreadyUsed, r)}))\r\n            .sort((a,b) => {\r\n                if(a.score < b.score)\r\n                {\r\n                    return -1;\r\n                }\r\n                else if(a.score > b.score)\r\n                {\r\n                    return 1;\r\n                }\r\n                else\r\n                {\r\n                    return 0;\r\n                }\r\n            });\r\n\r\n        const result: Recipe[] = [];\r\n\r\n        if(scoredRecipes.length>0)\r\n        {\r\n            for(let scoredRecipe of scoredRecipes)\r\n            {\r\n                if(scoredRecipes[0].score === scoredRecipe.score)\r\n                {\r\n                    result.push(scoredRecipe.recipe);\r\n                }\r\n                else\r\n                {\r\n                    break;\r\n                }\r\n            }\r\n        }\r\n        \r\n        return result;\r\n    }\r\n}","import {Filter} from './Filter';\r\nimport {Recipe} from '../model/Recipe';\r\n\r\nfunction getScore(ingredientsAlreadyUSed: Set<string>, recipe: Recipe) {\r\n    \r\n    return recipe.getIngredients().reduce((sum, i) => {\r\n        if(ingredientsAlreadyUSed.has(i.getName()))\r\n        {\r\n            return sum+1;\r\n        }\r\n        else\r\n        {\r\n            return sum;\r\n        }\r\n    }, 0);\r\n}\r\n\r\nexport class MaxReuseFilter implements Filter {\r\n    public name = \"Maximal reuse of ingredients\";\r\n    public id =\"maxreuse\";\r\n    public filter = (explicitRecipes: Recipe[], selectedRecipes: Recipe[], remainingRecipes: Recipe[]) => {\r\n\r\n        const ingredientsAlreadyUsed = new Set<string>(\r\n            explicitRecipes.concat(selectedRecipes).flatMap(r => r.getIngredients().map(i => i.getName())));\r\n\r\n        const scoredRecipes = remainingRecipes\r\n            .map(r => ({recipe: r, score: getScore(ingredientsAlreadyUsed, r)}))\r\n            .sort((a,b) => {\r\n                if(a.score < b.score)\r\n                {\r\n                    return 1;\r\n                }\r\n                else if(a.score > b.score)\r\n                {\r\n                    return -1;\r\n                }\r\n                else\r\n                {\r\n                    return 0;\r\n                }\r\n            });\r\n\r\n        const result: Recipe[] = [];\r\n\r\n        if(scoredRecipes.length>0)\r\n        {\r\n            for(let scoredRecipe of scoredRecipes)\r\n            {\r\n                if(scoredRecipes[0].score === scoredRecipe.score)\r\n                {\r\n                    result.push(scoredRecipe.recipe);\r\n                }\r\n                else\r\n                {\r\n                    break;\r\n                }\r\n            }\r\n        }\r\n\r\n        return result;\r\n    }\r\n}","import {Recipe} from '../model/Recipe';\r\n\r\nimport { RandomFilter } from './RandomFilter';\r\nimport { MinIngredientsFilter } from './MinIngredientsFilter';\r\nimport { MaxReuseFilter } from './MaxReuseFilter';\r\n\r\nexport const randomFilter = new RandomFilter();\r\n\r\nexport interface Filter {\r\n    id: string,\r\n    name: string,\r\n    filter: (explicitRecipes: Recipe[], selectedRecipes: Recipe[], remainingRecipes: Recipe[]) => Recipe[]\r\n}\r\n\r\nexport type Filters = {\r\n    all: () => Filter[],\r\n    get: (id: string) => Filter | undefined \r\n}\r\n\r\nfunction createFilters() {\r\n\r\n    const filters = [new MinIngredientsFilter(), new MaxReuseFilter(), randomFilter];\r\n    const filterMap = new Map<string,Filter>(filters.map(f => [f.id, f])); \r\n\r\n    return {\r\n        all: () => filters,\r\n        get: (id: string) => filterMap.get(id)\r\n    }\r\n}\r\n\r\nexport const filters: Filters = createFilters();\r\n","import {Filter, filters} from '../filters/Filter';\r\n\r\nexport enum Optimization {\r\n    MinimalNrIngrediants = 1,\r\n    MaximalResueOfIngredients\r\n  }\r\n\r\nexport class PlanSettings {\r\n\r\n    constructor() {\r\n        this.nrRecipes = 5;\r\n        this.optimization = filters.all()[0];\r\n     }\r\n\r\n    public clone() : PlanSettings {\r\n        return Object.create(this);\r\n    }\r\n\r\n    public nrRecipes: number\r\n    public optimization: Filter\r\n}\r\n","import React, {FunctionComponent} from 'react';\r\n\r\nimport {Accordion, Card} from 'react-bootstrap';\r\nimport {Form} from 'react-bootstrap';\r\n\r\nimport {PlanSettings} from '../model/PlanSettings';\r\nimport {filters} from '../filters/Filter';\r\n\r\ntype PlanSettingsPanelProps = {\r\n    planSettings: PlanSettings,\r\n    onUpdate: (planSettings: PlanSettings) => void\r\n}\r\n\r\nexport const PlanSettingsPanel: FunctionComponent<PlanSettingsPanelProps> = (props) => {\r\n\r\n    const [collapsed, setCollapsed] = React.useState(true);\r\n\r\n    const changeNrRecipes = (newNrRecipes: number) => {\r\n        let newSettings = props.planSettings.clone();\r\n        newSettings.nrRecipes = newNrRecipes;\r\n        props.onUpdate(newSettings);\r\n    }\r\n\r\n    const changeOptimization = (filterId: string) => {\r\n        let filter = filters.get(filterId);\r\n        if(filter)\r\n        {\r\n            let newSettings = props.planSettings.clone();\r\n            newSettings.optimization = filter;\r\n            props.onUpdate(newSettings);    \r\n        }\r\n    }\r\n\r\n    const filterList = filters.all().map(f => \r\n        <option value={f.id}>{f.name}</option>\r\n    )\r\n\r\n    return (\r\n        <Accordion defaultActiveKey=\"0\">\r\n        <Card>\r\n            <Accordion.Toggle as={Card.Header} variant=\"link\" eventKey=\"1\" onClick={() => setCollapsed(!collapsed)}>\r\n                Plan settings {collapsed ? \"[+]\" : \"[-]\"}\r\n            </Accordion.Toggle>\r\n            <Accordion.Collapse eventKey=\"1\">\r\n            <Card.Body>\r\n                <Form onSubmit={(e)=>e.preventDefault()}>\r\n                <Form.Group controlId=\"nrRecipes\">\r\n                    <Form.Label>Number of recipes:</Form.Label>\r\n                    <Form.Control as=\"select\" value={props.planSettings.nrRecipes} \r\n                                  onChange={(e)=>changeNrRecipes(parseInt(e.target.value))}>\r\n                    <option>3</option>\r\n                    <option>4</option>\r\n                    <option>5</option>\r\n                    <option>6</option>\r\n                    <option>7</option>\r\n                    </Form.Control>\r\n                </Form.Group>\r\n                <Form.Group controlId=\"optimization\">\r\n                    <Form.Label>Optimize by:</Form.Label>\r\n                    <Form.Control as=\"select\" value={props.planSettings.optimization.id} \r\n                                  onChange={(e)=>changeOptimization(e.target.value)}>\r\n                    {filterList}\r\n                    </Form.Control>\r\n                </Form.Group>\r\n                </Form>\r\n            </Card.Body>\r\n            </Accordion.Collapse>\r\n        </Card>\r\n        </Accordion>\r\n    );    \r\n}\r\n","import {Plan} from './model/Plan';\r\nimport {Recipe} from './model/Recipe';\r\n\r\nimport XLSX from 'xlsx';\r\n\r\nexport function getIngredientMap(recipes: Recipe[])\r\n{\r\n    // Ingredient -> (recipe id -> [amount, unit])\r\n    let ingredientMap = new Map<string, Map<string, [number, string]>>();\r\n\r\n    recipes.forEach(r => {\r\n        \r\n        r.getIngredients().forEach(i => {\r\n              let oneIngredientRecord = ingredientMap.get(i.getName());\r\n              if(!oneIngredientRecord)\r\n              {\r\n                oneIngredientRecord = new Map()\r\n                ingredientMap.set(i.getName(), oneIngredientRecord);\r\n              }\r\n              \r\n              oneIngredientRecord.set(r.getId(), [i.getAmount(), i.getUnit()]);\r\n        });\r\n    });\r\n\r\n    return ingredientMap;\r\n}\r\n\r\nexport function exportPlan(plan: Plan) : Blob\r\n{\r\n    let recipes = plan.allRecipes();\r\n    let ingredientMap = getIngredientMap(recipes); \r\n    let ingredients = Array.from(ingredientMap.keys()).sort();\r\n\r\n    let wb = XLSX.utils.book_new();\r\n\r\n    // ----------------------------------------------------------------------------------------\r\n    // Calculate shopping list\r\n\r\n    let ingredientList = ingredients.map(name => {\r\n\r\n        let oneIngredientRecord = new Map<string, number>()\r\n        let ingredient = ingredientMap.get(name) ?? new Map()\r\n\r\n        // Group ingredient usages by unit\r\n        for (let [amount, unit] of ingredient.values()) {\r\n            oneIngredientRecord.set(unit, \r\n                (oneIngredientRecord.get(unit) ?? 0) + amount)\r\n        }\r\n        \r\n        return {\"name\": name, \"amounts\": oneIngredientRecord}\r\n    });\r\n\r\n    let ingredientsRows = []\r\n\r\n    for (let {name, amounts} of ingredientList)\r\n    {\r\n        let line: [string] = [name]\r\n        for (let [unit, amount] of amounts)\r\n        {\r\n            line.push(\"\" + amount + \" \" + unit)\r\n        }\r\n        ingredientsRows.push(line)\r\n    }\r\n\r\n    let ingredientsWS = XLSX.utils.aoa_to_sheet(ingredientsRows);\r\n    XLSX.utils.book_append_sheet(wb, ingredientsWS, \"Shopping list\");\r\n\r\n    // ----------------------------------------------------------------------------------------\r\n    // Generate detailed plan\r\n\r\n    const planHeaderRow = recipes.map(r => r.getTitle()) \r\n    planHeaderRow.unshift(\"\")\r\n\r\n    const planDataRows = ingredients.map(name => {\r\n        \r\n        let line = [name]\r\n\r\n        for (let r of recipes)\r\n        {\r\n            let ingredient = ingredientMap.get(name) ?? new Map();\r\n            let recipeIngredient = ingredient.get(r.getId());\r\n            if(recipeIngredient)\r\n            {\r\n                line.push(\"\" + recipeIngredient[0] + \" \" +  recipeIngredient[1]);\r\n            }\r\n            else\r\n            {\r\n                line.push(\"\");\r\n            }\r\n\r\n        }\r\n\r\n        return line;\r\n    });\r\n\r\n    let planRows = [planHeaderRow].concat(planDataRows);\r\n\r\n    let planWS = XLSX.utils.aoa_to_sheet(planRows);\r\n    XLSX.utils.book_append_sheet(wb, planWS, \"Plan\");\r\n\r\n    // ----------------------------------------------------------------------------------------\r\n    // Generate recipes\r\n\r\n    for (let r of recipes)\r\n    {\r\n        let recipeRows = [\r\n            [\"Title\",r.getTitle()],\r\n            [\"Summary\", r.getSummary() ?? \"-\"],\r\n            [\"Ready in minutes\",r.getReadyInMinutes() ?? \"-\"],\r\n            [\"Source\", r.getSource() ?? \"-\"],\r\n            [\"Ingredients:\"]\r\n        ];\r\n\r\n        for (let i of r.getIngredients())\r\n        {\r\n            recipeRows.push([i.getName(), i.getAmount(), i.getUnit()])\r\n        }\r\n\r\n        let recipeWS = XLSX.utils.aoa_to_sheet(recipeRows);\r\n        XLSX.utils.book_append_sheet(wb, recipeWS, r.getTitle());    \r\n    }\r\n\r\n    let bytes = XLSX.write(wb, {bookType:'xlsx', bookSST: false, type: 'array'});\r\n    return new Blob([bytes], {\r\n        type: 'application/octet-stream'\r\n    });\r\n}\r\n","import React, {FunctionComponent} from 'react';\r\n\r\nimport {Container, Table} from 'react-bootstrap';\r\n\r\nimport {Plan} from \"../model/Plan\";\r\nimport {PlanSettings} from \"../model/PlanSettings\";\r\nimport {getIngredientMap}  from \"../PlanExporter\";\r\n\r\ntype PlanVisualizerProps = {\r\n    plan: Plan,\r\n    planSettings: PlanSettings\r\n}\r\n\r\nexport const PlanVisualizer: FunctionComponent<PlanVisualizerProps> = ({plan}) => {\r\n\r\n    const allRecipes = plan.allRecipes();\r\n\r\n    const explicitRecipeHeaderList = plan.explicitRecipes.map(r => \r\n        <th>{r.getTitle()}</th>)\r\n\r\n    const calculatedRecipeHeaderList = plan.calculatedRecipes.map(r => \r\n        <th className=\"bg-light\">{r.getTitle()}</th>)\r\n\r\n    let ingredientMap = getIngredientMap(allRecipes);\r\n\r\n    const ingredientLineList = Array.from(ingredientMap.keys()).sort().map(name => {\r\n        \r\n        const perRecipe = allRecipes.map(r => {\r\n            let ingredient = ingredientMap.get(name) ?? new Map();\r\n            let recipeIngredient = ingredient.get(r.getId());\r\n            if(recipeIngredient)\r\n            {\r\n                return <td>{\"\" + recipeIngredient[0] + \" \" +  recipeIngredient[1]}</td>;\r\n            }\r\n            else\r\n            {\r\n                return <td>&nbsp;</td>;\r\n            }\r\n        });\r\n\r\n        return (<tr>\r\n                    <th>{name}</th>\r\n                    {perRecipe}\r\n                </tr>);\r\n    });\r\n\r\n\r\n    return (\r\n        <Container className=\"pt-0 pb-0 pl-0 pr-0\">\r\n        <Table striped bordered size=\"sm\">\r\n            <thead>\r\n                <tr>\r\n                <th></th>\r\n                {explicitRecipeHeaderList}\r\n                {calculatedRecipeHeaderList}\r\n                </tr>\r\n            </thead>\r\n            <tbody>\r\n            {ingredientLineList}\r\n            </tbody>\r\n        </Table>\r\n        </Container>\r\n    );\r\n\r\n}","import React, {FunctionComponent, ChangeEvent} from 'react';\r\nimport {Modal, Form, Button} from 'react-bootstrap';\r\n\r\nimport {RecipeJSON, IngredientJSON, Recipe, Ingredient} from '../model/Recipe';\r\n\r\ntype RecipeEditorProps = {\r\n    recipe?: Recipe,\r\n    onClose: () => void,\r\n    onSave: (recipe: Recipe) => void,\r\n    onDelete: (recipe: Recipe) => void\r\n}\r\n\r\nexport const RecipeEditor: FunctionComponent<RecipeEditorProps> = (props) => {\r\n\r\n    const [recipeJSON, setRecipeJSON] = React.useState<RecipeJSON>(\r\n                            props.recipe?props.recipe.toJSON():Object.create({}));\r\n    const [isTitleInvalid, setIsTitleInvalid] = React.useState(!props.recipe);\r\n    const [isIngredientsInvalid, setIsIngredientsInvalid] = React.useState(false);\r\n\r\n    const generateIngredientCSV = (ingredients: Ingredient[]) =>\r\n    {\r\n        return ingredients.map(i=>i.getName() + \";\" + i.getAmount() + \";\" + i.getUnit()).join(\"\\n\")\r\n    }\r\n\r\n    const [ingredientCSV, setIngredientCSV] = React.useState(props.recipe ? \r\n                            generateIngredientCSV(props.recipe.getIngredients()):\"\");\r\n\r\n    const setTitle = (e: ChangeEvent<HTMLInputElement>) => {\r\n        let newVal = e.currentTarget.value;\r\n        setIsTitleInvalid(!newVal || newVal.length === 0);\r\n        setRecipeJSON(r => ({...r, ...{title: newVal}}))\r\n    }\r\n\r\n    const setSummary = (e: ChangeEvent<HTMLInputElement>) => {\r\n        let newVal: string = e.currentTarget.value;\r\n        setRecipeJSON(r => ({...r, ...{summary: newVal}}))\r\n    }\r\n\r\n    const setSource = (e: ChangeEvent<HTMLInputElement>) => {\r\n        let newVal: string =  e.currentTarget.value;\r\n        setRecipeJSON(r => ({...r, ...{source: newVal}}))\r\n    }\r\n\r\n    const setMinutes = (e: ChangeEvent<HTMLInputElement>) => {\r\n        let newVal: number | undefined = Number.parseInt(e.currentTarget.value)\r\n        if(isNaN(newVal)) newVal = undefined\r\n        setRecipeJSON(r => ({...r, ...{readyInMinutes: newVal}}))\r\n    }\r\n\r\n    const updateIngredients = (e: ChangeEvent<HTMLInputElement>) => {\r\n\r\n        setIngredientCSV(e.currentTarget.value);\r\n        let lines: string[] = e.currentTarget.value.split(/\\r?\\n/);\r\n\r\n        if(lines.length === 0)\r\n        {\r\n            setRecipeJSON(r => ({...r, ...{ingredients: []}}))\r\n        }\r\n        else\r\n        {\r\n            let ingredients: IngredientJSON[] = [];\r\n            let invalid = false;\r\n\r\n            lines.forEach(line => {\r\n                if(line.length>0)\r\n                {\r\n                    let parts: string[] = line.split(';').map(s=>s.trim());\r\n                    if(parts.length!==3 ||\r\n                      parts[0].length===0 || parts[1].length===0 || parts[2].length===0 ||\r\n                      \"\"+Number.parseInt(parts[1])!==parts[1])\r\n                    {\r\n                        invalid = true;\r\n                    }\r\n                    else\r\n                    {\r\n                        ingredients.push({name: parts[0], amount: Number.parseInt(parts[1]), unit: parts[2]});\r\n                    }\r\n                }\r\n            });\r\n\r\n            if(invalid)\r\n            {\r\n                setIsIngredientsInvalid(true);\r\n            }\r\n            else\r\n            {\r\n                setIsIngredientsInvalid(false);\r\n                setRecipeJSON(r => ({...r, ...{ingredients: ingredients}}))\r\n            }\r\n        }\r\n    }\r\n\r\n    const saveRecipe = () =>\r\n    {\r\n        props.onSave(Recipe.fromJSON(recipeJSON))\r\n    }\r\n\r\n    const deleteRecipe = () =>\r\n    {\r\n        if(props.recipe)\r\n        {\r\n            props.onDelete(props.recipe)\r\n        }\r\n    }\r\n\r\n    const focusElement = React.createRef<HTMLInputElement>();\r\n\r\n    return (\r\n        <Modal show={true} onHide={props.onClose} onEntered={() => {if(focusElement.current) focusElement.current.focus()}}>\r\n        <Modal.Header closeButton>\r\n        <Modal.Title>Add new recipe</Modal.Title>\r\n        </Modal.Header>\r\n        <Modal.Body>\r\n        <Form>\r\n        <Form.Group controlId=\"formTitle\">\r\n            <Form.Control type=\"title\" value={recipeJSON.title} placeholder=\"Title\" \r\n                                       isInvalid={isTitleInvalid} onChange={setTitle}\r\n                                       ref={focusElement}/>\r\n            <Form.Control.Feedback type=\"invalid\">Required field!</Form.Control.Feedback>\r\n        </Form.Group>\r\n        <Form.Group controlId=\"formSummary\">\r\n            <Form.Control as=\"textarea\" value={recipeJSON.summary} onChange={setSummary} rows={4} placeholder=\"Summary\"/>\r\n        </Form.Group>\r\n        <Form.Group controlId=\"formSource\">\r\n            <Form.Control type=\"source\" value={recipeJSON.source} onChange={setSource} placeholder=\"Where to find the recipe\"/>\r\n        </Form.Group>\r\n        <Form.Group controlId=\"formMinutes\">\r\n            <Form.Control type=\"minutes\" value={recipeJSON.readyInMinutes} \r\n                                        onChange={setMinutes} placeholder=\"Number of minutes to cook\"/>\r\n        </Form.Group>\r\n        <Form.Group controlId=\"formIngredients\">\r\n            <Form.Control as=\"textarea\" value={ingredientCSV} rows={8} \r\n                                        onChange={updateIngredients} isInvalid={isIngredientsInvalid}\r\n                                        placeholder=\"Ingredients: <name>;<amount>;<unit>\" />\r\n            <Form.Control.Feedback type=\"invalid\">Format must be {\"<\"}name{\">\"};{\"<\"}amount{\">\"};{\"<\"}unit{\">\"} for every line!\"</Form.Control.Feedback>\r\n        </Form.Group>\r\n        </Form>\r\n        </Modal.Body>\r\n        <Modal.Footer>\r\n        <Button type=\"button\" variant=\"secondary\" onClick={props.onClose}>Close</Button>\r\n        <Button type=\"button\" variant=\"primary\" onClick={saveRecipe} disabled={isTitleInvalid||isIngredientsInvalid}>Save recipe</Button>\r\n        {(() => {\r\n            if(props.recipe) {\r\n                return (<Button type=\"button\" variant=\"primary\" onClick={deleteRecipe}>Delete recipe</Button>)\r\n            }\r\n        })()}\r\n        </Modal.Footer>\r\n        </Modal>)\r\n}","import {Recipe} from './Recipe';\r\n\r\nexport class Plan {\r\n\r\n    constructor() {\r\n        this.explicitRecipes = [];\r\n        this.calculatedRecipes = [];\r\n    }\r\n\r\n    public allRecipes()\r\n    {\r\n        return this.explicitRecipes.concat(this.calculatedRecipes);\r\n    }\r\n\r\n    public nrRecipes()\r\n    {\r\n        return this.explicitRecipes.length + this.calculatedRecipes.length;\r\n    }\r\n\r\n    public clone() : Plan {\r\n        return Object.create(this);\r\n    }\r\n\r\n    public explicitRecipes: Recipe[];\r\n    public calculatedRecipes: Recipe[];\r\n}","import {Plan} from './model/Plan';\r\nimport {PlanSettings} from './model/PlanSettings';\r\nimport {Recipe} from './model/Recipe';\r\nimport {RecipeIndex} from './RecipeDB';\r\nimport {randomFilter} from './filters/Filter';\r\n\r\nexport function optimizePlan(recipeIndex: RecipeIndex, previousPlan: Plan, settings: PlanSettings) {\r\n\r\n    const nrRecipesToCalculate = Math.max(0, settings.nrRecipes - previousPlan.explicitRecipes.length);\r\n\r\n    const allRecipeIds = new Set(recipeIndex.all().map(r=>r.getId())); \r\n    const freeRecipeIds = new Set(allRecipeIds);\r\n    previousPlan.explicitRecipes.forEach(r=>freeRecipeIds.delete(r.getId()));\r\n\r\n    const calcultedRecipes: Recipe[] = [];\r\n\r\n    for(let i=0; i<nrRecipesToCalculate; i++)\r\n    {\r\n        let freeRecipes = recipeIndex.getAll(Array.from(freeRecipeIds));\r\n        let currentRecipes = settings.optimization.filter(previousPlan.explicitRecipes, calcultedRecipes, freeRecipes);\r\n\r\n        if(currentRecipes.length > 0)\r\n        {\r\n            var finalRecipe = randomFilter.filter(previousPlan.explicitRecipes, calcultedRecipes, currentRecipes)[0];\r\n\r\n            calcultedRecipes.push(finalRecipe);\r\n            freeRecipeIds.delete(finalRecipe.getId());\r\n        }\r\n    }\r\n\r\n    const newPlan = previousPlan.clone();\r\n    newPlan.calculatedRecipes = calcultedRecipes;\r\n\r\n    return newPlan;\r\n}","import React, {FunctionComponent} from 'react';\r\n\r\nimport {Navbar, Nav, NavDropdown, Button} from 'react-bootstrap';\r\nimport {Container, Row, Col} from 'react-bootstrap';\r\nimport {Alert} from 'react-bootstrap';\r\n\r\nimport {Recipe, serializeRecipes, deserializeRecipes} from './model/Recipe';\r\nimport {RecipeSelector} from './components/RecipeSelector';\r\nimport {RecipeIndex} from './RecipeDB';\r\nimport {LoadFileDialog} from './components/LoadFileDialog';\r\nimport {SaveFileDialog} from './components/SaveFileDialog';\r\nimport {PlanSettingsPanel} from './components/PlanSettings';\r\nimport {PlanSettings} from './model/PlanSettings';\r\nimport {PlanVisualizer} from './components/PlanVisualizer';\r\nimport {RecipeEditor} from './components/RecipeEditor';\r\nimport {Plan} from './model/Plan';\r\n\r\nimport {optimizePlan} from './Planner';\r\nimport {exportPlan} from './PlanExporter';\r\n\r\nimport {Beforeunload} from 'react-beforeunload';\r\n\r\nimport 'bootstrap/dist/css/bootstrap.min.css';\r\n    \r\ntype MenuProps = {\r\n    onLoadFile: () => void,\r\n    onNewRecipe: () => void,\r\n    onSaveFile: () => void,\r\n    unsavedChanges: boolean\r\n}\r\n\r\nconst Menu: FunctionComponent<MenuProps> = ({onLoadFile, onNewRecipe, onSaveFile, unsavedChanges}) => {\r\n\r\n    return (\r\n        <Navbar bg=\"dark\" variant=\"dark\">\r\n        <Navbar.Brand href=\"#home\">Mealee</Navbar.Brand>\r\n        <Navbar.Toggle aria-controls=\"basic-navbar-nav\" />\r\n        <Navbar.Collapse id=\"basic-navbar-nav\">\r\n            <Nav className=\"mr-auto\">\r\n            <NavDropdown title=\"Recipes\" id=\"collasible-nav-dropdown\">\r\n              <NavDropdown.Item href=\"#\" active={false} onClick={onLoadFile}>Load recipes...</NavDropdown.Item>\r\n              <NavDropdown.Item href=\"#\" active={false} onClick={onSaveFile} disabled={!unsavedChanges}>Save recipes...</NavDropdown.Item>\r\n              <NavDropdown.Divider />\r\n              <NavDropdown.Item href=\"#\" active={false} onClick={onNewRecipe}>Add new recipe...</NavDropdown.Item>\r\n            </NavDropdown>\r\n            </Nav>\r\n        </Navbar.Collapse>\r\n        </Navbar>\r\n    );    \r\n}\r\n\r\ntype AppState = {\r\n    recipeIndex: RecipeIndex,\r\n    planSettings: PlanSettings,\r\n    plan: Plan,\r\n    showDialog?: Dialog,\r\n    recipeToEdit?: Recipe,\r\n    error: string | null,\r\n    unsavedChanges: boolean \r\n}\r\n\r\nenum Dialog {\r\n    LoadFile,\r\n    SaveFile,\r\n    RecipeEditor,\r\n    SavePlanXLS\r\n} \r\n\r\nclass App extends React.Component<{}, AppState> {\r\n\r\n    constructor(props: {}) {\r\n        super(props);\r\n\r\n        let recipeIndex = new RecipeIndex();\r\n        let planSettings = new PlanSettings();\r\n\r\n        // Hard binding is needed if `loadFile` do not use arrow notation \r\n        // this.loadFile = this.loadFile.bind(this);\r\n        this.state = { \r\n            recipeIndex: recipeIndex,\r\n            planSettings: planSettings,\r\n            plan: optimizePlan(recipeIndex, new Plan(), planSettings),\r\n            showDialog: undefined,\r\n            recipeToEdit: undefined,\r\n            error: null,\r\n            unsavedChanges: false\r\n        };\r\n    }\r\n\r\n    addRecipes = (newRecipes: Recipe[], fromFile = false) => {\r\n        this.setState(st => {\r\n\r\n            // You want to save if it is not a first file load\r\n            let needsSave = st.unsavedChanges || !(fromFile && st.recipeIndex.count()===0);\r\n\r\n            let ret = {}\r\n            let newRecipeIndex = st.recipeIndex.addAll(newRecipes);\r\n\r\n            if(newRecipeIndex !== st.recipeIndex){\r\n\r\n                ret = {recipeIndex: newRecipeIndex,\r\n                       plan: optimizePlan(newRecipeIndex, st.plan, st.planSettings),\r\n                       unsavedChanges: needsSave};\r\n            }\r\n\r\n            return ret;\r\n        });\r\n    }\r\n\r\n    saveRecipe = (recipe: Recipe) => {\r\n        this.addRecipes([recipe]);\r\n        this.closeRecipeEditor();\r\n    }\r\n\r\n    onFileLoaded = (ev: ProgressEvent<FileReader>) => {\r\n        let res = ev.target?.result;\r\n\r\n        if(typeof res == \"string\")\r\n        {\r\n            try\r\n            {\r\n                this.addRecipes(deserializeRecipes(res), true);\r\n            }\r\n            catch(e)\r\n            {\r\n                this.setState({error: e.message});\r\n            }\r\n            \r\n        }\r\n        this.closeDialog();\r\n    }\r\n\r\n    loadFile = (file: File) => {\r\n        var reader = new FileReader();\r\n        reader.onload = (ev) => this.onFileLoaded(ev);\r\n        reader.readAsText(file);\r\n    } \r\n\r\n    genRecipeFileContent = () => {\r\n        return serializeRecipes(this.state.recipeIndex.all());\r\n    }\r\n\r\n    fileSaved = () => {\r\n        this.setState({unsavedChanges: false});\r\n        this.closeDialog();\r\n    }\r\n\r\n    showDialog = (dialog: Dialog) => {\r\n        return () => this.setState({showDialog: dialog});\r\n    }\r\n\r\n    closeDialog = () => {\r\n        this.setState({showDialog: undefined});\r\n    }\r\n\r\n    closeRecipeEditor = () => {\r\n        this.setState({recipeToEdit: undefined, showDialog: undefined});\r\n    }\r\n\r\n    dismissError = () => {\r\n        this.setState({error: null});\r\n    }\r\n\r\n    updatePlanSettings = (ps: PlanSettings) => {\r\n        this.setState(st => {\r\n            return {planSettings: ps,\r\n                    plan: optimizePlan(st.recipeIndex, st.plan, ps)}\r\n        });\r\n    }\r\n\r\n    updateExplicitRecipes = (newExplicitRecipes: Recipe[]) => {\r\n        this.setState(st => {\r\n            let newPlan: Plan = Object.create(st.plan);\r\n            newPlan.explicitRecipes = newExplicitRecipes;\r\n            return {plan: optimizePlan(st.recipeIndex, newPlan, st.planSettings)};\r\n        });\r\n    }\r\n\r\n    editRecipe = (recipe: Recipe) => {\r\n        this.setState({showDialog: Dialog.RecipeEditor,\r\n                       recipeToEdit: recipe});\r\n    }\r\n\r\n    deleteRecipe = (recipe: Recipe) => {\r\n        this.setState(st => {\r\n            let newRecipeIndex = st.recipeIndex.delete(recipe.getId());\r\n\r\n            return {recipeIndex: newRecipeIndex,\r\n                    plan: optimizePlan(newRecipeIndex, st.plan, st.planSettings),\r\n                    showDialog: undefined,\r\n                    recipeToEdit: undefined,\r\n                    unsavedChanges: true};\r\n        });\r\n    }\r\n\r\n    renderDialog = () => {\r\n\r\n        switch(this.state.showDialog) { \r\n            case Dialog.LoadFile: {\r\n                return <LoadFileDialog\r\n                        onClose={this.closeDialog}\r\n                        title=\"Load recipes file\"\r\n                        loadButtonTitle=\"Load recipes\"\r\n                        onLoad={this.loadFile}/>\r\n            }\r\n\r\n            case Dialog.SaveFile: { \r\n                return <SaveFileDialog\r\n                        onClose={this.closeDialog}\r\n                        title=\"Save recipes file\"\r\n                        saveButtonTitle=\"Save recipes\"\r\n                        data={this.genRecipeFileContent()}\r\n                        type=\"application/mealee-recipes\"\r\n                        initialFileName=\"recipes\"\r\n                        extension=\"json\"\r\n                        onSave={this.fileSaved}/>\r\n            }\r\n\r\n            case Dialog.RecipeEditor: {\r\n                return <RecipeEditor\r\n                        onClose={this.closeRecipeEditor}\r\n                        onSave={this.saveRecipe}\r\n                        onDelete={this.deleteRecipe}\r\n                        recipe={this.state.recipeToEdit}/>\r\n            }\r\n\r\n            case Dialog.SavePlanXLS: {\r\n                return <SaveFileDialog\r\n                        onClose={this.closeDialog}\r\n                        title=\"Save plan\"\r\n                        saveButtonTitle=\"Save plan\"\r\n                        data={exportPlan(this.state.plan)}\r\n                        type=\"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet\"\r\n                        initialFileName=\"plan\"\r\n                        extension=\"xlsx\"\r\n                        onSave={this.closeDialog}/>\r\n            }\r\n\r\n            default: {\r\n                return <></>\r\n            }\r\n        }\r\n\r\n    }\r\n\r\n    render() {\r\n        return (\r\n            <Container fluid className=\"p-3\">\r\n\r\n                <Alert variant=\"danger\" onClose={this.dismissError} show={!!this.state.error} dismissible>\r\n                    {this.state.error}\r\n                </Alert>\r\n\r\n                {(() => {\r\n                    if(this.state.unsavedChanges) {\r\n                        return <Beforeunload onBeforeunload={() => \"You'll lose your data!\"} />\r\n                    }\r\n                })()}\r\n\r\n                {this.renderDialog()}\r\n\r\n                <Row>\r\n                    <Col> \r\n                        <Menu onLoadFile={this.showDialog(Dialog.LoadFile)} \r\n                              onNewRecipe={this.showDialog(Dialog.RecipeEditor)}\r\n                              onSaveFile={this.showDialog(Dialog.SaveFile)}\r\n                              unsavedChanges={this.state.unsavedChanges}/>\r\n                    </Col>\r\n                </Row>\r\n                <Row>\r\n                    <Col>\r\n                        <PlanSettingsPanel planSettings={this.state.planSettings} \r\n                                           onUpdate={this.updatePlanSettings}/>\r\n                    </Col>\r\n                </Row>\r\n                <Row className=\"pb-2\">\r\n                    <Col xs=\"3\">\r\n                        <RecipeSelector selectedRecipes={this.state.plan.explicitRecipes} \r\n                                        recipeIndex={this.state.recipeIndex}\r\n                                        maxNrSelected={this.state.planSettings.nrRecipes}\r\n                                        onUpdate={this.updateExplicitRecipes}\r\n                                        onEdit={this.editRecipe}/>\r\n                    </Col>\r\n                    <Col>\r\n                        {(() => {\r\n                        if(this.state.plan.nrRecipes() === 0) {\r\n                            return <Container className=\"pt-2 pl-0\">No recipes are planned</Container>\r\n                        }\r\n                        else\r\n                        {\r\n                            return (\r\n                            <Container className=\"pt-2 pl-0 pr-0\">\r\n                                <Row>\r\n                                    <Col>\r\n                                    <PlanVisualizer plan={this.state.plan} planSettings={this.state.planSettings}/>\r\n                                    </Col>\r\n                                </Row>\r\n                                <Row>\r\n                                    <Col>\r\n                                    <Button className=\"float-right\" onClick={this.showDialog(Dialog.SavePlanXLS)}>Export plan</Button>\r\n                                    </Col>\r\n                                </Row>\r\n                            </Container>)\r\n                        }\r\n                        })()}\r\n                    </Col>\r\n                </Row>\r\n            </Container>\r\n        );\r\n    };\r\n};\r\n\r\nexport default App;","import './index.css';\nimport React from 'react';\nimport ReactDOM from 'react-dom';\nimport App from './App';\n\nReactDOM.render(\n  <React.StrictMode>\n    <App/>\n  </React.StrictMode>,\n  document.getElementById('root')\n);"],"sourceRoot":""}