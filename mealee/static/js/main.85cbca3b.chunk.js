(this.webpackJsonpmealee=this.webpackJsonpmealee||[]).push([[0],{72:function(e,t,n){e.exports=n(84)},73:function(e,t,n){},84:function(e,t,n){"use strict";n.r(t);n(73);var a=n(0),r=n.n(a),i=n(14),c=n.n(i),o=n(10),l=n(23),u=n(71),s=n(70),d=n(101),m=n(94),p=n(98),f=n(89),h=n(90),g=n(66),v=n(95),E=function(){function e(t,n,a){Object(o.a)(this,e),this.name=void 0,this.amount=void 0,this.unit=void 0,this.name=t,this.amount=n,this.unit=a}return Object(l.a)(e,[{key:"getName",value:function(){return this.name}},{key:"getAmount",value:function(){return this.amount}},{key:"getUnit",value:function(){return this.unit}},{key:"toJSON",value:function(){return{name:this.name,amount:this.amount,unit:this.unit}}}],[{key:"fromJSON",value:function(t){if(!t.name)throw new Error("Missing ingredient name");if(!t.unit)throw new Error("Missing ingredient unit");if(void 0===t.amount)throw new Error("Missing ingredient amount");return new e(t.name,t.amount,t.unit)}}]),e}();var y=function(){function e(t,n){Object(o.a)(this,e),this.id=void 0,this.title=void 0,this.summary=void 0,this.source=void 0,this.sourceUrl=void 0,this.readyInMinutes=void 0,this.ingredients=void 0,this.id=t,this.title=n,this.ingredients=[]}return Object(l.a)(e,[{key:"getId",value:function(){return this.id}},{key:"getTitle",value:function(){return this.title}},{key:"getSummary",value:function(){return this.summary}},{key:"getSource",value:function(){return this.source}},{key:"getSourceUrl",value:function(){return this.sourceUrl}},{key:"getReadyInMinutes",value:function(){return this.readyInMinutes}},{key:"getIngredients",value:function(){return this.ingredients}},{key:"toJSON",value:function(){return{id:this.id,title:this.title,summary:this.summary,source:this.source,sourceUrl:this.sourceUrl,readyInMinutes:this.readyInMinutes,ingredients:this.ingredients.map((function(e){return e.toJSON()}))}}}],[{key:"fromJSON",value:function(t){if(t.id||(t.id="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(function(e){var t=16*Math.random()|0;return("x"===e?t:3&t|8).toString(16)}))),!t.title)throw new Error("Missing recipe title");var n=new e(t.id,t.title);return n.summary=t.summary,n.source=t.source,n.sourceUrl=t.sourceUrl,n.readyInMinutes=t.readyInMinutes,Array.isArray(t.ingredients)&&(n.ingredients=t.ingredients.map((function(e){return E.fromJSON(e)}))),n}}]),e}();var b=n(16),x=n(103),I=n(97),S=n(92),w=n(68),R=n(102),O=n(91),j=n(99),N=n(67),k=function(e){var t=e.recipeIndex,n=e.selectedRecipes,a=e.maxNrSelected,i=e.onUpdate,c=e.onEdit,o=r.a.useState(""),l=Object(b.a)(o,2),u=l[0],s=l[1],d=r.a.useState(null),m=Object(b.a)(d,2),p=m[0],v=m[1],E=0===u.trim().length?t.all():t.search(u).map((function(e){return e.key})),y=new Map(n.map((function(e){return[e.getId(),e]}))),k=function(e){var t=e.getSummary()?e.getSummary():"Summary is not available",n=e.getIngredients().map((function(e){return e.getName()})).sort().map((function(e){return r.a.createElement(g.a,{sm:"auto",className:"border mt-1 ml-2 pt-2 pb-2"},e)}));return r.a.createElement(R.a,{id:"popover-basic"},r.a.createElement(R.a.Title,{as:"h4"},e.getTitle()),r.a.createElement(R.a.Content,null,r.a.createElement(f.a,{className:"pl-0 pr-0"},r.a.createElement(h.a,{className:"pb-2"},r.a.createElement(g.a,null,t)),r.a.createElement(h.a,{className:"pb-2"},r.a.createElement(g.a,{sm:"auto"},r.a.createElement(O.a,{src:"clock20x20.jpg"})),r.a.createElement(g.a,{sm:"auto"},e.getReadyInMinutes()?e.getReadyInMinutes()+" mintes":"unknown"),r.a.createElement(g.a,{sm:"auto"},r.a.createElement(O.a,{src:"babyowl17x20.jpg"})),r.a.createElement(g.a,{sm:"auto"},e.getSource()?e.getSource():"-")),r.a.createElement(h.a,null,n))))},M=E.map((function(e){return r.a.createElement(j.a,{placement:"right",overlay:k(e),onEnter:function(){return v(e.getId())},onExit:function(){return v(null)}},r.a.createElement(x.a.Item,{key:e.getId()},r.a.createElement(I.a.Check,{type:"checkbox",id:e.getId(),label:e.getTitle(),disabled:!y.has(e.getId())&&y.size>=a,checked:y.has(e.getId()),onChange:function(){return t=e,y.has(t.getId())?y.delete(t.getId()):y.set(t.getId(),t),void i(Array.from(y.values()));var t}}),function(e){return p===e.getId()?r.a.createElement(N.a,{variant:"outline-primary",size:"sm",className:"mt-2",onClick:function(t){return c(e)}},"Edit"):""}(e)))}));return r.a.createElement(I.a,{className:"pt-2",onSubmit:function(e){return e.preventDefault()}},r.a.createElement(S.a,{className:"mb-2"},r.a.createElement(S.a.Prepend,null,r.a.createElement(S.a.Text,{id:"basic-addon1"},"@")),r.a.createElement(w.a,{type:"text",placeholder:"Filter recipes",onChange:function(e){s(e.currentTarget.value)}})),r.a.createElement(I.a.Group,{controlId:"recipeGroup"},r.a.createElement(x.a,null,M)))},M=n(34),C=n(69),F=n(63),T=function e(){var t=this;Object(o.a)(this,e),this.recipesMap=void 0,this.index=void 0,this.fieldAccessors=[function(e){return e.getTitle()},function(e){var t;return null!==(t=e.getSummary())&&void 0!==t?t:""},function(e){return e.getIngredients().map((function(e){return e.getName()})).join(" ")}],this.fieldBoostFactors=[2,.5,1],this.termFilter=function(e){return e.toLowerCase()},this.add=function(e){var n=e.getId();return t.delete(n),t.recipesMap.set(n,e),t.index.docs.has(n)||Object(M.a)(t.index,t.fieldAccessors,F.words,t.termFilter,n,e),!0},this.search=function(e){return Object(C.a)(t.index,t.fieldBoostFactors,1.2,.75,F.words,t.termFilter,void 0,e).reduce((function(e,n){var a=t.recipesMap.get(n.key);return a&&e.push({key:a,score:n.score}),e}),[])},this.all=function(){return Array.from(t.recipesMap.values())},this.get=function(e){return t.recipesMap.get(e)},this.delete=function(e){Object(M.d)(t.index,new Set,e),t.recipesMap.delete(e)},this.getAll=function(e){return e.reduce((function(e,n){var a=t.recipesMap.get(n);return a&&e.push(a),e}),[])},this.index=Object(M.b)(3),this.recipesMap=new Map},L=n(96),A=function(e){var t=e.title,n=e.loadButtonTitle,a=e.onClose,i=e.onLoad,c=r.a.useState(null),o=Object(b.a)(c,2),l=o[0],u=o[1];return r.a.createElement(L.a,{show:!0,onHide:a},r.a.createElement(L.a.Header,{closeButton:!0},r.a.createElement(L.a.Title,null,t)),r.a.createElement(L.a.Body,null,r.a.createElement(I.a,null,r.a.createElement(w.a,{type:"file",onChange:function(e){e.target.files?u(e.target.files[0]):u(null)}}))),r.a.createElement(L.a.Footer,null,r.a.createElement(N.a,{type:"button",variant:"secondary",onClick:a},"Close"),r.a.createElement(N.a,{type:"button",variant:"primary",disabled:!l,onClick:function(){l&&i(l)}},n)))},U=n(100),D=n(104);var J=n(53);var B=function e(){Object(o.a)(this,e),this.name="Minimal number of ingredients",this.id="miningredients",this.filter=function(e,t,n){var a=new Set(e.concat(t).flatMap((function(e){return e.getIngredients().map((function(e){return e.getName()}))}))),r=n.map((function(e){return{recipe:e,score:(t=a,n=e,n.getIngredients().reduce((function(e,n){return t.has(n.getName())?e:e+1}),0))};var t,n})).sort((function(e,t){return e.score<t.score?-1:e.score>t.score?1:0})),i=[];if(r.length>0){var c,o=Object(J.a)(r);try{for(o.s();!(c=o.n()).done;){var l=c.value;if(r[0].score!==l.score)break;i.push(l.recipe)}}catch(u){o.e(u)}finally{o.f()}}return i}};var z=function e(){Object(o.a)(this,e),this.name="Maximal reuse of ingredients",this.id="maxreuse",this.filter=function(e,t,n){var a=new Set(e.concat(t).flatMap((function(e){return e.getIngredients().map((function(e){return e.getName()}))}))),r=n.map((function(e){return{recipe:e,score:(t=a,n=e,n.getIngredients().reduce((function(e,n){return t.has(n.getName())?e+1:e}),0))};var t,n})).sort((function(e,t){return e.score<t.score?1:e.score>t.score?-1:0})),i=[];if(r.length>0){var c,o=Object(J.a)(r);try{for(o.s();!(c=o.n()).done;){var l=c.value;if(r[0].score!==l.score)break;i.push(l.recipe)}}catch(u){o.e(u)}finally{o.f()}}return i}},G=new function e(){Object(o.a)(this,e),this.name="Random filter",this.id="rnd",this.filter=function(e,t,n){return 0===n.length?[]:[n[(a=n.length,Math.floor(Math.random()*Math.floor(a)))]];var a}};var H,P=function(){var e=[new B,new z,G],t=new Map(e.map((function(e){return[e.id,e]})));return{all:function(){return e},get:function(e){return t.get(e)}}}(),K=function(e){var t=r.a.useState(!0),n=Object(b.a)(t,2),a=n[0],i=n[1],c=P.all().map((function(e){return r.a.createElement("option",{value:e.id},e.name)}));return r.a.createElement(U.a,{defaultActiveKey:"0"},r.a.createElement(D.a,null,r.a.createElement(U.a.Toggle,{as:D.a.Header,variant:"link",eventKey:"1",onClick:function(){return i(!a)}},"Plan settings ",a?"[+]":"[-]"),r.a.createElement(U.a.Collapse,{eventKey:"1"},r.a.createElement(D.a.Body,null,r.a.createElement(I.a,{onSubmit:function(e){return e.preventDefault()}},r.a.createElement(I.a.Group,{controlId:"nrRecipes"},r.a.createElement(I.a.Label,null,"Number of recipes:"),r.a.createElement(I.a.Control,{as:"select",value:e.planSettings.nrRecipes,onChange:function(t){return function(t){var n=e.planSettings.clone();n.nrRecipes=t,e.onUpdate(n)}(parseInt(t.target.value))}},r.a.createElement("option",null,"3"),r.a.createElement("option",null,"4"),r.a.createElement("option",null,"5"),r.a.createElement("option",null,"6"),r.a.createElement("option",null,"7"))),r.a.createElement(I.a.Group,{controlId:"optimization"},r.a.createElement(I.a.Label,null,"Optimize by:"),r.a.createElement(I.a.Control,{as:"select",value:e.planSettings.optimization.id,onChange:function(t){return function(t){var n=P.get(t);if(n){var a=e.planSettings.clone();a.optimization=n,e.onUpdate(a)}}(t.target.value)}},c)))))))};!function(e){e[e.MinimalNrIngrediants=1]="MinimalNrIngrediants",e[e.MaximalResueOfIngredients=2]="MaximalResueOfIngredients"}(H||(H={}));var q=function(){function e(){Object(o.a)(this,e),this.nrRecipes=void 0,this.optimization=void 0,this.nrRecipes=5,this.optimization=P.all()[0]}return Object(l.a)(e,[{key:"clone",value:function(){return Object.create(this)}}]),e}(),W=n(93),Q=function(e){var t=e.plan,n=t.explicitRecipes.concat(t.calculatedRecipes);if(0===n.length)return r.a.createElement(f.a,{className:"pt-2"},"No recipes are planned");var a=t.explicitRecipes.map((function(e){return r.a.createElement("th",null,e.getTitle())})),i=t.calculatedRecipes.map((function(e){return r.a.createElement("th",{className:"bg-light"},e.getTitle())})),c=new Map,o=0;n.forEach((function(e){e.getIngredients().forEach((function(e){var t=c.get(e.getName());t||(t={},c.set(e.getName(),t)),t[o]=e.getAmount()+" "+e.getUnit()})),o++}));var l=Array.from(c.keys()).sort().map((function(e){var t=Array.from({length:n.length},(function(e,t){return t})).map((function(t){var n=c.get(e);return n&&n[t]?r.a.createElement("td",null,n[t]):r.a.createElement("td",null,"\xa0")}));return r.a.createElement("tr",null,r.a.createElement("th",null,e),t)}));return r.a.createElement(f.a,{className:"pt-2"},r.a.createElement(W.a,{striped:!0,bordered:!0,size:"sm"},r.a.createElement("thead",null,r.a.createElement("tr",null,r.a.createElement("th",null),a,i)),r.a.createElement("tbody",null,l)))},V=n(13),X=function(e){var t=r.a.useState(e.recipe?e.recipe.toJSON():Object.create({})),n=Object(b.a)(t,2),a=n[0],i=n[1],c=r.a.useState(!e.recipe),o=Object(b.a)(c,2),l=o[0],u=o[1],s=r.a.useState(!1),d=Object(b.a)(s,2),m=d[0],p=d[1],f=r.a.useState(e.recipe?e.recipe.getIngredients().map((function(e){return e.getName()+";"+e.getAmount()+";"+e.getUnit()})).join("\n"):""),h=Object(b.a)(f,2),g=h[0],v=h[1],E=function(){e.recipe&&e.onDelete(e.recipe)};return r.a.createElement(L.a,{show:!0,onHide:e.onClose},r.a.createElement(L.a.Header,{closeButton:!0},r.a.createElement(L.a.Title,null,"Add new recipe")),r.a.createElement(L.a.Body,null,r.a.createElement(I.a,null,r.a.createElement(I.a.Group,{controlId:"formTitle"},r.a.createElement(I.a.Control,{type:"title",value:a.title,placeholder:"Title",isInvalid:l,onChange:function(e){var t=e.currentTarget.value;u(!t||0===t.length),i((function(e){return Object(V.a)(Object(V.a)({},e),{title:t})}))}}),r.a.createElement(I.a.Control.Feedback,{type:"invalid"},"Required field!")),r.a.createElement(I.a.Group,{controlId:"formSummary"},r.a.createElement(I.a.Control,{as:"textarea",value:a.summary,onChange:function(e){var t=e.currentTarget.value;i((function(e){return Object(V.a)(Object(V.a)({},e),{summary:t})}))},rows:4,placeholder:"Summary"})),r.a.createElement(I.a.Group,{controlId:"formSource"},r.a.createElement(I.a.Control,{type:"source",value:a.source,onChange:function(e){var t=e.currentTarget.value;i((function(e){return Object(V.a)(Object(V.a)({},e),{source:t})}))},placeholder:"Where to find the recipe"})),r.a.createElement(I.a.Group,{controlId:"formMinutes"},r.a.createElement(I.a.Control,{type:"minutes",value:a.readyInMinutes,onChange:function(e){var t=Number.parseInt(e.currentTarget.value);isNaN(t)&&(t=void 0),i((function(e){return Object(V.a)(Object(V.a)({},e),{readyInMinutes:t})}))},placeholder:"Number of minutes to cook"})),r.a.createElement(I.a.Group,{controlId:"formIngredients"},r.a.createElement(I.a.Control,{as:"textarea",value:g,rows:8,onChange:function(e){v(e.currentTarget.value);var t=e.currentTarget.value.split(/\r?\n/);if(0===t.length)i((function(e){return Object(V.a)(Object(V.a)({},e),{ingredients:[]})}));else{var n=[],a=!1;t.forEach((function(e){if(e.length>0){var t=e.split(";").map((function(e){return e.trim()}));3!==t.length||0===t[0].length||0===t[1].length||0===t[2].length||""+Number.parseInt(t[1])!==t[1]?a=!0:n.push({name:t[0],amount:Number.parseInt(t[1]),unit:t[2]})}})),a?p(!0):(p(!1),i((function(e){return Object(V.a)(Object(V.a)({},e),{ingredients:n})})))}},isInvalid:m,placeholder:"Ingredients: <name>;<amount>;<unit>"}),r.a.createElement(I.a.Control.Feedback,{type:"invalid"},"Format must be ","<","name",">",";","<","amount",">",";","<","unit",">",' for every line!"')))),r.a.createElement(L.a.Footer,null,r.a.createElement(N.a,{type:"button",variant:"secondary",onClick:e.onClose},"Close"),r.a.createElement(N.a,{type:"button",variant:"primary",onClick:function(){e.onSave(y.fromJSON(a))},disabled:l||m},"Save recipe"),function(){if(e.recipe)return r.a.createElement(N.a,{type:"button",variant:"primary",onClick:E},"Delete recipe")}()))},Y=function(){function e(){Object(o.a)(this,e),this.explicitRecipes=void 0,this.calculatedRecipes=void 0,this.explicitRecipes=[],this.calculatedRecipes=[]}return Object(l.a)(e,[{key:"clone",value:function(){return Object.create(this)}}]),e}();function Z(e,t,n){var a=Math.max(0,n.nrRecipes-t.explicitRecipes.length),r=new Set(e.all().map((function(e){return e.getId()}))),i=new Set(r);t.explicitRecipes.forEach((function(e){return i.delete(e.getId())}));for(var c=[],o=0;o<a;o++){var l=e.getAll(Array.from(i)),u=n.optimization.filter(t.explicitRecipes,c,l);if(u.length>0){var s=G.filter(t.explicitRecipes,c,u)[0];c.push(s),i.delete(s.getId())}}var d=t.clone();return d.calculatedRecipes=c,d}n(83);var $=function(e){var t=e.onLoadFile,n=e.onNewRecipe,a=e.recipeFileUrl;return r.a.createElement(d.a,{bg:"dark",variant:"dark"},r.a.createElement(d.a.Brand,{href:"#home"},"Mealee"),r.a.createElement(d.a.Toggle,{"aria-controls":"basic-navbar-nav"}),r.a.createElement(d.a.Collapse,{id:"basic-navbar-nav"},r.a.createElement(m.a,{className:"mr-auto"},r.a.createElement(p.a,{title:"Recipes",id:"collasible-nav-dropdown"},r.a.createElement(p.a.Item,{href:"#",onClick:t},"Load recipes..."),r.a.createElement(p.a.Item,{href:a,download:""},"Save recipes..."),r.a.createElement(p.a.Item,{href:"",onClick:n},"New recipe...")))))},_=function(e){Object(u.a)(n,e);var t=Object(s.a)(n);function n(e){var a;Object(o.a)(this,n),(a=t.call(this,e)).addRecipes=function(e){a.setState((function(t){return e.forEach((function(e){t.recipeIndex.add(e)})),{recipeIndex:t.recipeIndex,plan:Z(t.recipeIndex,t.plan,t.planSettings)}}))},a.saveRecipe=function(e){a.addRecipes([e]),a.closeRecipeEditor()},a.onFileLoaded=function(e){var t,n=null===(t=e.target)||void 0===t?void 0:t.result;if("string"==typeof n)try{a.addRecipes(function(e){var t=JSON.parse(e);if(Array.isArray(t))return t.map(y.fromJSON);if("object"===typeof t){var n=t;if("undefined"!==typeof n.version){if(1!==n.version)throw new Error("Invalid recipe file version");if(Array.isArray(n.recipes))return n.recipes.map(y.fromJSON)}}throw new Error("Invalid recipe file")}(n))}catch(r){a.setState({error:r.message})}a.closeLoadFileDialog()},a.loadFile=function(e){var t=new FileReader;t.onload=function(e){return a.onFileLoaded(e)},t.readAsText(e)},a.generateRecipeFileURL=function(){var e,t=new Blob([(e=a.state.recipeIndex.all(),JSON.stringify({version:1,recipes:e}))],{type:"application/recipes"});return window.URL.createObjectURL(t)},a.showLoadFileDialog=function(){a.setState({showLoadFileDialog:!0})},a.showRecipeEditor=function(){a.setState({showRecipeEditor:!0})},a.closeLoadFileDialog=function(){a.setState({showLoadFileDialog:!1})},a.closeRecipeEditor=function(){a.setState({showRecipeEditor:!1,recipeToEdit:void 0})},a.dismissError=function(){a.setState({error:null})},a.updatePlanSettings=function(e){a.setState((function(t){return{planSettings:e,plan:Z(t.recipeIndex,t.plan,e)}}))},a.updateExplicitRecipes=function(e){a.setState((function(t){var n=Object.create(t.plan);return n.explicitRecipes=e,{plan:Z(t.recipeIndex,n,t.planSettings)}}))},a.editRecipe=function(e){a.setState({showRecipeEditor:!0,recipeToEdit:e})},a.deleteRecipe=function(e){a.setState((function(t){return t.recipeIndex.delete(e.getId()),{recipeIndex:t.recipeIndex,plan:Z(t.recipeIndex,t.plan,t.planSettings),showRecipeEditor:!1,recipeToEdit:void 0}}))};var r=new T,i=new q;return a.state={recipeIndex:r,planSettings:i,plan:Z(r,new Y,i),showLoadFileDialog:!1,showRecipeEditor:!1,recipeToEdit:void 0,error:null},a}return Object(l.a)(n,[{key:"render",value:function(){var e=this;return r.a.createElement(f.a,{fluid:!0,className:"p-3"},r.a.createElement(v.a,{variant:"danger",onClose:this.dismissError,show:!!this.state.error,dismissible:!0},this.state.error),function(){if(e.state.showLoadFileDialog)return r.a.createElement(A,{onClose:e.closeLoadFileDialog,title:"Load recipes file",loadButtonTitle:"Load recipes",onLoad:e.loadFile})}(),function(){if(e.state.showRecipeEditor)return r.a.createElement(X,{onClose:e.closeRecipeEditor,onSave:e.saveRecipe,onDelete:e.deleteRecipe,recipe:e.state.recipeToEdit})}(),r.a.createElement(h.a,null,r.a.createElement(g.a,null,r.a.createElement($,{onLoadFile:this.showLoadFileDialog,onNewRecipe:this.showRecipeEditor,recipeFileUrl:this.generateRecipeFileURL()}))),r.a.createElement(h.a,null,r.a.createElement(g.a,null,r.a.createElement(K,{planSettings:this.state.planSettings,onUpdate:this.updatePlanSettings}))),r.a.createElement(h.a,{className:"pb-2"},r.a.createElement(g.a,{xs:"3"},r.a.createElement(k,{selectedRecipes:this.state.plan.explicitRecipes,recipeIndex:this.state.recipeIndex,maxNrSelected:this.state.planSettings.nrRecipes,onUpdate:this.updateExplicitRecipes,onEdit:this.editRecipe})),r.a.createElement(g.a,null,r.a.createElement(Q,{plan:this.state.plan,planSettings:this.state.planSettings}))))}}]),n}(r.a.Component);c.a.render(r.a.createElement(r.a.StrictMode,null,r.a.createElement(_,null)),document.getElementById("root"))}},[[72,1,2]]]);
//# sourceMappingURL=main.85cbca3b.chunk.js.map