{"version":3,"sources":["component/LoadFileDialog.tsx","component/SaveFileDialog.tsx","model/ScoringFun.ts","model/Settings.ts","component/Settings.tsx","model/Recipe.ts","store/RecipeStore.ts","service/RecipeService.ts","component/IngredientLang.ts","component/RecipeEditor.tsx","model/Plan.ts","AppDialogs.tsx","service/PlanExporterService.ts","model/Scoring.ts","service/ScoringService.ts","component/RecipeQuickView.tsx","component/RecipeSelector.tsx","component/Planner.tsx","AppBodies.tsx","model/Workspace.ts","service/WorkspaceService.ts","component/InfoBox.tsx","component/IconBar.tsx","component/MenuBar.tsx","App.tsx","index.js"],"names":["LoadFileDialog","title","loadButtonTitle","onClose","onLoad","React","useState","file","setFile","Modal","show","onHide","Header","closeButton","Title","Body","Form","FormControl","type","onChange","e","target","files","Footer","Button","variant","onClick","disabled","SaveFileDialog","saveButtonTitle","onSave","data","initialFileName","extension","fileName","setFileName","Group","controlId","Label","Control","value","length","download","ScoringFun","name","script","this","o","Error","SettingsBuilder","settings","json","toJSON","nrBuckets","scoringfuns","scoringFuns","Settings","fromJSON","map","f","s","SettingsDialog","props","settingsChanged","setSettingsChanged","settingsJSON","setSettingsJSON","isValidName","idx","trim","isValidScript","scoringFunRows","style","width","isInvalid","className","size","newName","Object","assign","changeName","currentTarget","rows","split","as","height","newScript","changeScript","_","concat","take","drop","deleteScoringFun","cursor","dialogClassName","Tabs","defaultActiveKey","Tab","eventKey","Container","onSubmit","preventDefault","newNrBuckets","changeNrRecipes","parseInt","Table","hover","Ingredient","amount","unit","undefined","Recipe","id","comment","source","serving","ingredients","labels","imageURL","i","replace","c","r","Math","random","toString","Array","isArray","error","RecipeStore","index","recipesMap","fieldAccessors","getTitle","getComment","getSource","getIngredients","getName","join","getLabels","fieldBoostFactors","termFilter","term","normalize","toLowerCase","add","key","getId","toUpdate","has","JSON","stringify","get","delete","newMap","set","addDocumentToIndex","words","addAll","recipes","reduce","recipe","search","q","query","acc","res","push","score","all","from","values","removeDocumentFromIndex","Set","getAll","keys","count","createIndex","Map","new","prototype","forEach","Intl","Collator","sort","compare","getUnits","units","getUnit","l","toUpperCase","parseIngredients","text","errors","lines","line","parts","CodeMirror","Pos","to","message","startpos","startAmount","endAmount","Number","parseFloat","autocomplete","cm","getCursor","getLine","start","ch","end","nrpart","substring","match","charAt","word","slice","trimLeft","selection","filter","indexOf","startsWith","list","defineMode","Location","startState","location","token","stream","state","sol","next","eatWhile","registerHelper","RecipeEditor","create","recipeJSON","setRecipeJSON","isTitleInvalid","setIsTitleInvalid","isIngredientsInvalid","setIsIngredientsInvalid","getAmount","ingredientCSV","setIngredientCSV","allLabels","recipeStore","label","focusElement","createRef","ingredientEditorElement","onEntered","current","focus","fromTextArea","lineNumbers","mode","gutters","lint","extraKeys","on","instance","updateIngredients","getValue","showHint","hint","completeSingle","closeOnUnfocus","placeholder","newVal","ref","Feedback","isNaN","styles","menu","provided","zIndex","options","isMulti","newValue","onDelete","PlannedRecipe","recipeId","Plan","buckets","List","setSize","ret","bucket","bucketNr","plannedRecipe","getRecipeId","valueSeq","ids","pr","Dialog","calculateIngredientMap","ingredientMap","t","ingredientName","oneIngredientRecord","oneRecipeRecord","getServing","calculateShoppingList","ingredientList","ingredient","oneUsage","scale","ingredientsRows","amounts","renderDialog","showDialog","LoadFile","closeDialog","loadFile","SaveFile","genRecipeFileContent","fileSaved","closeRecipeEditor","saveRecipe","deleteRecipe","recipeToEdit","SavePlanXLS","plan","export","ShoppingList","cols","exportShoppingList","readOnly","PlanSettings","updateSettings","plannedRecipes","getAllPlannedRecipes","zip","row","shift","zippedPlannedRecipes","uniqueRecipes","wb","XLSX","utils","book_new","planRows","range","getNrBuckets","bid","getPlannedRecipes","planWS","aoa_to_sheet","book_append_sheet","ingredientsWS","mapHeaderRow","unshift","mapDataRows","recipeIngredient","au","mapRows","mapWS","recipeRows","recipeWS","sheetName","substr","bytes","write","bookType","bookSST","Blob","RecipeScoring","scorings","sum","addScoring","scoringFun","getSum","getScorings","Scoring","scoring","sf","rs","getScoring","labelDict","countBy","_scoreRecipes","fun","rand","evaluate","scoreBy","p","Parser","rlabels","precipeids","precipes","plabels","flatMap","functions","intersection","bs","hasLabel","ld","countLabelInPlan","countRecipeInPlan","parse","getScript","max","curr","scores","RecipeQuickView","n","Col","sm","scoringLines","oneScore","Row","xs","toFixed","fluid","RecipeListItem","forwardRef","selected","highlighted","onEdit","useDrag","item","collect","monitor","isDragging","drag","imageURLExists","getImageURL","position","backgroundColor","Card","opacity","top","transform","right","OverlayTrigger","placement","overlay","Image","src","Popover","Content","RecipeSelector","highlightedRecipes","setFilter","ISet","lastHighlightedRecipes","setLastHighlightedRecipes","debouncedSetFilter","useCallback","debounce","filteredRecipes","selectedRecipeSet","getAllRecipeIds","highlightedListItemRef","listItems","sortBy","ListGroup","Item","useEffect","scrollIntoView","behavior","block","InputGroup","Prepend","Text","event","Append","Tooltip","RecipeBox","bucketId","onUpdate","left","onWheel","newServing","deltaY","min","fontSize","paddingTop","paddingRight","Bucket","DroppableBucket","onDrop","onMove","useDrop","accept","dragr","isOver","Planner","updatePlan","addRecipe","bucketIdx","setPlannedRecipe","deleteRecipeById","updatePlannedRecipe","movePlannedRecipe","renderInitialBody","isOpen","isInitialTour","onRequestClose","setIsInitialTour","steps","selector","content","Alert","renderDesktopBody","md","lg","xl","minHeight","getScoringFuns","editRecipe","getNrRecipes","Workspace","lastUpdated","Date","serialize","str","fileVersion","getRecipes","getSettings","getLastUpdated","toISOString","TextEncoder","encode","InfoBox","wsInfo","toLocaleString","nrRecipes","IconBar","onLoadFile","onNewRecipe","onSaveFile","onEditSettings","unsavedChanges","color","MenuBar","Navbar","bg","Brand","href","alt","marginTop","fontFamily","fontWeight","Toggle","aria-controls","Collapse","Nav","process","App","AppDialogs","AppBodies","addRecipes","newRecipes","fromFile","setState","st","needsSave","newRand","newRecipeStore","onFileLoaded","ev","result","ws","deserializeWokspaceFile","reader","FileReader","onload","readAsText","dialog","dismissError","ps","setNrBuckets","planSettings","dismissible","onBeforeunload","isMobileOnly","Component","ReactGA","initialize","pageview","AppRoot","useLocation","console","log","DndProvider","backend","isMobile","TouchBackend","HTML5Backend","GoogleCallback","URLSearchParams","pathname","callback","ReactDOM","render","StrictMode","exact","path","document","getElementById"],"mappings":"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","file":"static/js/main.e0e92bfd.chunk.js","sourcesContent":["import React, {FunctionComponent} from 'react';\r\n\r\nimport {Modal, Form, FormControl, Button} from 'react-bootstrap';\r\n\r\ntype LoadFileDialogProps = {\r\n    title: string,\r\n    loadButtonTitle: string,\r\n    onClose: () => void,\r\n    onLoad: (file: File) => void\r\n}\r\n\r\nexport const LoadFileDialog: FunctionComponent<LoadFileDialogProps> = ({title, loadButtonTitle, onClose, onLoad}) => {\r\n\r\n    const [file, setFile] = React.useState<null | File>(null);\r\n\r\n    return (\r\n        <Modal show={true} onHide={onClose}>\r\n        <Modal.Header closeButton>\r\n        <Modal.Title>{title}</Modal.Title>\r\n        </Modal.Header>\r\n        <Modal.Body>\r\n        <Form>\r\n        <FormControl type=\"file\" onChange={(e: React.ChangeEvent<HTMLInputElement>) => {\r\n                                                if(e.target.files)\r\n                                                {\r\n                                                    setFile(e.target.files[0])\r\n                                                }\r\n                                                else\r\n                                                {\r\n                                                    setFile(null)\r\n                                                }\r\n                                            }}/>\r\n        </Form>\r\n        </Modal.Body>\r\n        <Modal.Footer>\r\n            <Button type=\"button\" variant=\"secondary\" onClick={onClose}>Close</Button>\r\n            <Button type=\"button\" variant=\"primary\" disabled={!file} \r\n                        onClick={() => {if(file) onLoad(file)}}>{loadButtonTitle}</Button>\r\n        </Modal.Footer>   \r\n        </Modal>\r\n    );\r\n}","import React, {FunctionComponent} from 'react';\r\n\r\nimport {Modal, Form, Button} from 'react-bootstrap';\r\n\r\nimport download from 'downloadjs'\r\n\r\ntype SaveFileDialogProps = {\r\n    title: string,\r\n    saveButtonTitle: string,\r\n    data: Blob,\r\n    type: string,\r\n    initialFileName: string,\r\n    extension: string,\r\n    onClose: () => void,\r\n    onSave: () => void\r\n}\r\n\r\nexport const SaveFileDialog: FunctionComponent<SaveFileDialogProps> \r\n                = ({title, saveButtonTitle, onClose, onSave, data, type, initialFileName, extension }) => {\r\n\r\n    const [fileName, setFileName] = React.useState(initialFileName);\r\n\r\n    const startDownload = () => {\r\n        download(data, fileName+\".\"+extension, type)\r\n    }\r\n\r\n    return (\r\n        <Modal show={true} onHide={onClose}>\r\n        <Modal.Header closeButton>\r\n        <Modal.Title>{title}</Modal.Title>\r\n        </Modal.Header>\r\n        <Modal.Body>\r\n        <Form>\r\n        <Form.Group controlId=\"formBasicFileName\">\r\n        <Form.Label>File name</Form.Label>\r\n        <Form.Control type=\"fileName\" value={fileName} onChange={(e: React.ChangeEvent<HTMLInputElement>) => setFileName(e.target.value)}/>\r\n        </Form.Group>\r\n        </Form>\r\n        </Modal.Body>\r\n        <Modal.Footer>\r\n            <Button type=\"button\" variant=\"secondary\" onClick={onClose}>Close</Button>\r\n            <Button type=\"button\" variant=\"primary\" disabled={!fileName || fileName.length===0} \r\n                        onClick={() => {startDownload(); onSave()}}>{saveButtonTitle}</Button>\r\n        </Modal.Footer>   \r\n        </Modal>\r\n    );\r\n}","export interface ScoringFunJSON {\r\n    name: string\r\n    script: string\r\n}\r\n\r\n/* IMMUTABLE */\r\nexport class ScoringFun {\r\n\r\n    private name: string\r\n    private script: string\r\n\r\n    constructor(name: string, script: string) {\r\n        this.name = name\r\n        this.script = script\r\n    }\r\n\r\n    public toJSON(): ScoringFunJSON {\r\n        return {\r\n            name: this.name,\r\n            script: this.script\r\n        };\r\n    }\r\n\r\n    public static fromJSON(o: ScoringFunJSON): ScoringFun {\r\n        if (!o.name) {\r\n            throw new Error(\"Missing name field\")\r\n        }\r\n\r\n        if (!o.script) {\r\n            throw new Error(\"Missing script field\")\r\n        }\r\n\r\n        return new ScoringFun(o.name, o.script)\r\n    }\r\n\r\n    public getName() {\r\n        return this.name\r\n    }\r\n\r\n    public getScript() {\r\n        return this.script\r\n    }\r\n}\r\n","import { ScoringFun, ScoringFunJSON } from './ScoringFun'\r\n\r\nexport interface SettingsJSON {\r\n    nrBuckets: number;\r\n    scoringFuns: ScoringFunJSON[];\r\n}\r\n\r\nexport class SettingsBuilder {\r\n    private json: SettingsJSON\r\n\r\n    constructor(settings?: Settings) {\r\n        this.json = settings ? settings.toJSON() : {} as SettingsJSON\r\n    }\r\n\r\n    buckets(nrBuckets: number): SettingsBuilder {\r\n        this.json.nrBuckets = nrBuckets\r\n        return this\r\n    }\r\n\r\n    scoringFuns(scoringfuns: ScoringFunJSON[]) {\r\n        this.json.scoringFuns = scoringfuns\r\n        return this\r\n    }\r\n\r\n    build(): Settings {\r\n        return Settings.fromJSON(this.json)\r\n    }\r\n}\r\n\r\nexport class Settings {\r\n    constructor() {\r\n        this.nrBuckets = 7\r\n        this.scoringFuns = []\r\n    }\r\n\r\n    static builder(settings?: Settings): SettingsBuilder {\r\n        return new SettingsBuilder(settings)\r\n    }\r\n\r\n    public toJSON(): SettingsJSON {\r\n        return {\r\n            nrBuckets: this.nrBuckets,\r\n            scoringFuns: this.scoringFuns.map(f => f.toJSON())\r\n        };\r\n    }\r\n\r\n    public static fromJSON(o: SettingsJSON): Settings {\r\n        if (!o.nrBuckets) {\r\n            o.nrBuckets = 7\r\n        }\r\n\r\n        if (o.nrBuckets < 1 || o.nrBuckets > 7) {\r\n            throw new Error(\"Wrong number of recipes\")\r\n        }\r\n\r\n        if (!o.scoringFuns) {\r\n            o.scoringFuns = []\r\n        }\r\n\r\n        let s = new Settings()\r\n        s.nrBuckets = o.nrBuckets\r\n        s.scoringFuns = o.scoringFuns.map(f => ScoringFun.fromJSON(f))\r\n\r\n        return s\r\n    }\r\n\r\n    public getNrBuckets() {\r\n        return this.nrBuckets\r\n    }\r\n\r\n    public getScoringFuns() {\r\n        return this.scoringFuns\r\n    }\r\n\r\n    private nrBuckets: number\r\n    private scoringFuns: ScoringFun[]\r\n}\r\n","import React, { FunctionComponent } from 'react';\r\n\r\nimport { Modal, Form, Button, Tabs, Tab, Container, Table } from 'react-bootstrap';\r\nimport { Trash } from 'react-bootstrap-icons';\r\n\r\nimport { Settings } from '../model/Settings';\r\n\r\nimport _ from 'lodash';\r\n\r\ntype SettingsDialogProps = {\r\n    settings: Settings,\r\n    onClose: () => void,\r\n    onSave: (planSettings: Settings) => void\r\n}\r\n\r\nexport const SettingsDialog: FunctionComponent<SettingsDialogProps> = (props) => {\r\n\r\n    const [settingsChanged, setSettingsChanged] = React.useState(false);\r\n\r\n    const [settingsJSON, setSettingsJSON] =\r\n        React.useState(props.settings.toJSON());\r\n\r\n    const changeNrRecipes = (newNrBuckets: number) => {\r\n        let s = Object.assign({}, settingsJSON)\r\n        s.nrBuckets = newNrBuckets\r\n        setSettingsJSON(s)\r\n        setSettingsChanged(true)\r\n    }\r\n\r\n    const addEmptyScoringFun = () => {\r\n        let s = Object.assign({}, settingsJSON)\r\n        s.scoringFuns = s.scoringFuns.concat([{ name: \"new scoring fun\", script: \"random(1)\" }])\r\n        setSettingsJSON(s)\r\n        setSettingsChanged(true)\r\n    }\r\n\r\n    const deleteScoringFun = (idx: number) => {\r\n        let s = Object.assign({}, settingsJSON)\r\n        s.scoringFuns = _.concat(_.take(s.scoringFuns, idx), _.drop(s.scoringFuns, idx + 1))\r\n        setSettingsJSON(s)\r\n        setSettingsChanged(true)\r\n    }\r\n\r\n    const changeName = (idx: number, newName: string) => {\r\n        let s = Object.assign({}, settingsJSON)\r\n        s.scoringFuns[idx].name = newName\r\n        setSettingsJSON(s)\r\n        setSettingsChanged(true)\r\n    }\r\n\r\n    const changeScript = (idx: number, newScript: string) => {\r\n        let s = Object.assign({}, settingsJSON)\r\n        s.scoringFuns[idx].script = newScript\r\n        setSettingsJSON(s)\r\n        setSettingsChanged(true)\r\n    }\r\n\r\n    const isValidName = (idx: number) => {\r\n        return settingsJSON.scoringFuns[idx].name.trim().length > 0\r\n    }\r\n\r\n    const isValidScript = (idx: number) => {\r\n        return settingsJSON.scoringFuns[idx].script.trim().length > 0\r\n    }\r\n\r\n    const scoringFunRows = settingsJSON.scoringFuns.map((f, idx) => {\r\n        return (\r\n            <tr>\r\n                <td style={{ width: 150 }}>\r\n                    <Form.Control\r\n                        isInvalid={!isValidName(idx)}\r\n                        className=\"mealee-table-edit\"\r\n                        type=\"name\"\r\n                        size=\"sm\"\r\n                        value={f.name}\r\n                        onChange={e => changeName(idx, e.currentTarget.value)} />\r\n                </td>\r\n                <td>\r\n                    <Form.Control\r\n                        isInvalid={!isValidScript(idx)}\r\n                        rows={isValidScript(idx) ? f.script.split(/\\r\\n|\\r|\\n/).length + 1 : 1}\r\n                        as=\"textarea\"\r\n                        className=\"mealee-table-edit\"\r\n                        type=\"name\"\r\n                        size=\"sm\"\r\n                        style={{ height: \"100%\" }}\r\n                        value={f.script}\r\n                        onChange={e => changeScript(idx, e.currentTarget.value)} />\r\n                </td>\r\n                <td style={{ width: 30 }}>\r\n                    <Trash\r\n                        onClick={() => deleteScoringFun(idx)}\r\n                        style={{ cursor: 'pointer' }} />\r\n                </td>\r\n            </tr>\r\n        )\r\n    })\r\n\r\n    const saveSettings = () => {\r\n        props.onSave(Settings.fromJSON(settingsJSON))\r\n    }\r\n\r\n    return (\r\n        <Modal show={true} onHide={props.onClose} dialogClassName=\"mealee-settings-dialog\">\r\n            <Modal.Header closeButton>\r\n                <Modal.Title>Settings</Modal.Title>\r\n            </Modal.Header>\r\n            <Modal.Body style={{ width: 800 }}>\r\n                <Tabs defaultActiveKey=\"general\">\r\n                    <Tab eventKey=\"general\" title=\"General\">\r\n                        <Container className=\"p-3\">\r\n                            <Form onSubmit={(e) => e.preventDefault()}>\r\n                                <Form.Group controlId=\"nrRecipes\">\r\n                                    <Form.Label>Number of recipes:</Form.Label>\r\n                                    <Form.Control as=\"select\" value={settingsJSON.nrBuckets}\r\n                                        onChange={(e) => changeNrRecipes(parseInt(e.target.value))}>\r\n                                        <option key=\"3\">3</option>\r\n                                        <option key=\"4\">4</option>\r\n                                        <option key=\"5\">5</option>\r\n                                        <option key=\"6\">6</option>\r\n                                        <option key=\"7\">7</option>\r\n                                    </Form.Control>\r\n                                </Form.Group>\r\n                            </Form>\r\n                        </Container>\r\n                    </Tab>\r\n                    <Tab eventKey=\"scoring\" title=\"Scoring\" className=\"h-100\">\r\n                        <Container className=\"p-3 h-100 d-flex flex-column\">\r\n                            <Form onSubmit={(e) => e.preventDefault()} className=\"h-100 d-grow-1\">\r\n                                <div className=\"p-0 tableFixHead\">\r\n                                    <Table hover size=\"sm\">\r\n                                        <thead>\r\n                                            <tr>\r\n                                                <th>Name</th>\r\n                                                <th>Expression</th>\r\n                                                <th className=\"m-0 p-0\" style={{ width: 0 }}>&nbsp;</th>\r\n                                            </tr>\r\n                                        </thead><tbody>\r\n                                            {scoringFunRows}\r\n                                        </tbody>\r\n                                    </Table>\r\n                                </div>\r\n                                <Button onClick={addEmptyScoringFun}>Add scoring function</Button>\r\n                            </Form>\r\n                        </Container>\r\n                    </Tab>\r\n                </Tabs>\r\n            </Modal.Body>\r\n            <Modal.Footer>\r\n                <Button type=\"button\" variant=\"primary\" onClick={saveSettings} disabled={!settingsChanged}>Save</Button>\r\n                <Button type=\"button\" variant=\"secondary\" onClick={props.onClose}>Close</Button>\r\n            </Modal.Footer>\r\n        </Modal >\r\n    );\r\n}\r\n","export interface IngredientJSON {\r\n    name: string;\r\n    amount: number;\r\n    unit: string;\r\n}\r\n\r\nexport interface RecipeJSON {\r\n    id: string;\r\n    title: string;\r\n    source?: string;\r\n    comment?: string;\r\n    serving?: number;\r\n    ingredients: IngredientJSON[];\r\n    labels?: string[];\r\n    imageURL?: string;\r\n}\r\n\r\n/* IMMUTABLE */\r\nexport class Ingredient {\r\n    private constructor(name: string, amount: number, unit: string) {\r\n        this.name = name;\r\n        this.amount = amount;\r\n        this.unit = unit;\r\n    }\r\n\r\n    public getName(): string {\r\n        return this.name;\r\n    }\r\n\r\n    public getAmount(): number {\r\n        return this.amount;\r\n    }\r\n\r\n    public getUnit(): string {\r\n        return this.unit;\r\n    }\r\n\r\n    public static fromJSON(o: IngredientJSON): Ingredient {\r\n        if (!o.name) {\r\n            throw new Error(\"Missing ingredient name\");\r\n        }\r\n\r\n        if (!o.unit) {\r\n            throw new Error(\"Missing ingredient unit\");\r\n        }\r\n\r\n        if (o.amount === undefined) {\r\n            throw new Error(\"Missing ingredient amount\");\r\n        }\r\n\r\n        return new Ingredient(o.name, o.amount, o.unit);\r\n    }\r\n\r\n    public toJSON(): IngredientJSON {\r\n        return {\r\n            name: this.name,\r\n            amount: this.amount,\r\n            unit: this.unit,\r\n        };\r\n    }\r\n\r\n    private name: string;\r\n    private amount: number;\r\n    private unit: string;\r\n}\r\n\r\nfunction uuidv4() {\r\n    return \"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx\".replace(/[xy]/g, function (c) {\r\n        var r = (Math.random() * 16) | 0,\r\n            v = c === \"x\" ? r : (r & 0x3) | 0x8;\r\n        return v.toString(16);\r\n    });\r\n}\r\n\r\n/* IMMUTABLE */\r\nexport class Recipe {\r\n    private constructor(id: string, title: string) {\r\n        this.id = id;\r\n        this.title = title;\r\n        this.ingredients = [];\r\n        this.labels = [];\r\n        this.serving = 4;\r\n    }\r\n\r\n    public static error = new Recipe(\"error\", \"Recipe cannot be found\")\r\n\r\n    public getId(): string {\r\n        return this.id;\r\n    }\r\n\r\n    public getTitle(): string {\r\n        return this.title;\r\n    }\r\n\r\n    public getComment(): string | undefined {\r\n        return this.comment;\r\n    }\r\n\r\n    public getSource(): string | undefined {\r\n        return this.source;\r\n    }\r\n\r\n    public getServing(): number {\r\n        return this.serving;\r\n    }\r\n\r\n    public getIngredients(): Ingredient[] {\r\n        return this.ingredients;\r\n    }\r\n\r\n    public getLabels(): string[] {\r\n        return this.labels;\r\n    }\r\n\r\n    public getImageURL(): string | undefined {\r\n        return this.imageURL;\r\n    }\r\n\r\n    public static fromJSON(o: RecipeJSON): Recipe {\r\n        if (!o.id) {\r\n            o.id = uuidv4();\r\n        }\r\n\r\n        if (!o.title) {\r\n            throw new Error(\"Missing recipe title\");\r\n        }\r\n\r\n        let r = new Recipe(o.id, o.title);\r\n\r\n        r.comment = o.comment;\r\n        r.source = o.source;\r\n        r.serving = o.serving ?? 4;\r\n        r.labels = o.labels ?? [];\r\n        r.imageURL = o.imageURL;\r\n\r\n        if (Array.isArray(o.ingredients)) {\r\n            r.ingredients = o.ingredients.map((i) => Ingredient.fromJSON(i));\r\n        }\r\n\r\n        return r;\r\n    }\r\n\r\n    public toJSON(): RecipeJSON {\r\n        return {\r\n            id: this.id,\r\n            title: this.title,\r\n            comment: this.comment,\r\n            source: this.source,\r\n            serving: this.serving,\r\n            ingredients: this.ingredients.map((i) => i.toJSON()),\r\n            labels: this.labels,\r\n            imageURL: this.imageURL\r\n        };\r\n    }\r\n\r\n    private id: string;\r\n    private title: string;\r\n    private comment?: string;\r\n    private source?: string;\r\n    private serving: number;\r\n    private ingredients: Ingredient[];\r\n    private labels: string[];\r\n    private imageURL?: string;\r\n}\r\n","import { Index, createIndex, addDocumentToIndex, removeDocumentFromIndex } from \"ndx\";\r\nimport { query, QueryResult } from \"ndx-query\";\r\n\r\nimport { Recipe } from \"../model/Recipe\";\r\n\r\nimport { words } from \"lodash\";\r\nimport { Map } from \"immutable\";\r\n\r\n// It is not quite immutable only looks like that. The underlying full text search index\r\n// is mutable, so be sure that old versions are not used. \r\nexport class RecipeStore {\r\n  private readonly recipesMap: Map<string, Recipe>;\r\n  private readonly index: Index<string>;\r\n\r\n  private readonly fieldAccessors = [\r\n    (r: Recipe) => r.getTitle(),\r\n    (r: Recipe) => r.getComment() ?? \"\",\r\n    (r: Recipe) => r.getSource() ?? \"\",\r\n    (r: Recipe) => r.getIngredients().map((i) => i.getName()).join(\" \"),\r\n    (r: Recipe) => r.getLabels().join(\" \")\r\n  ];\r\n\r\n  private readonly fieldBoostFactors = [2, 1, 1, 1, 2];\r\n\r\n  constructor(index?: Index<string>, recipesMap?: Map<string, Recipe>) {\r\n    this.index = index ? index : createIndex<string>(this.fieldAccessors.length);\r\n    this.recipesMap = recipesMap ? recipesMap : Map({});\r\n  }\r\n\r\n  private termFilter = (term: string) => {\r\n    return term\r\n      .normalize(\"NFD\")\r\n      .replace(/[\\u0300-\\u036f]/g, \"\")\r\n      .toLowerCase();\r\n  };\r\n\r\n  public static new = () => {\r\n    return new RecipeStore();\r\n  };\r\n\r\n  // `add()` function will add documents to the index.\r\n  public add = (r: Recipe) => {\r\n    let key = r.getId();\r\n\r\n    let toUpdate = true;\r\n\r\n    if (this.recipesMap.has(key)) {\r\n      if (JSON.stringify(this.recipesMap.get(key)) === JSON.stringify(r)) {\r\n        toUpdate = false;\r\n      }\r\n    }\r\n\r\n    if (toUpdate) {\r\n      // Don't add the same document twice, ndx becomes crazy...\r\n      this.delete(key);\r\n      let newMap = this.recipesMap.set(key, r);\r\n\r\n      addDocumentToIndex(\r\n        this.index,\r\n        this.fieldAccessors,\r\n        // Tokenizer is a function that breaks text into words, phrases, symbols, or other meaningful elements\r\n        // called tokens.\r\n        // Lodash function `words()` splits string into an array of its words, see https://lodash.com/docs/#words for\r\n        // details.\r\n        words,\r\n        // Filter is a function that processes tokens and returns terms, terms are used in Inverted Index to\r\n        // index documents.\r\n        this.termFilter,\r\n        // Document key, it can be a unique document id or a reference to a document if you want to store all documents\r\n        // in memory.\r\n        key,\r\n        // Document.\r\n        r\r\n      );\r\n\r\n      return new RecipeStore(this.index, newMap);\r\n    } else {\r\n      return this;\r\n    }\r\n  };\r\n\r\n  public addAll = (recipes: Recipe[]) => {\r\n    return recipes.reduce((idx: RecipeStore, recipe: Recipe) => {\r\n      return idx.add(recipe);\r\n    }, this);\r\n  };\r\n\r\n  // `search()` function will be used to perform queries.\r\n  public search = (q: string) =>\r\n    query<string>(\r\n      this.index,\r\n      this.fieldBoostFactors,\r\n      // BM25 ranking function constants:\r\n      1.2, // BM25 k1 constant, controls non-linear term frequency normalization (saturation).\r\n      0.75, // BM25 b constant, controls to what degree document length normalizes tf values.\r\n      words,\r\n      this.termFilter,\r\n      // Set of removed documents, in this example we don't want to support removing documents from the index,\r\n      // so we can ignore it by specifying this set as `undefined` value.\r\n      undefined,\r\n      q\r\n    ).reduce((acc: QueryResult<Recipe>[], res) => {\r\n      let r = this.recipesMap.get(res.key);\r\n      if (r) {\r\n        acc.push({ key: r, score: res.score });\r\n      }\r\n      return acc;\r\n    }, []);\r\n\r\n  public all = () => {\r\n    return Array.from(this.recipesMap.values());\r\n  };\r\n\r\n  public get = (key: string) => {\r\n    return this.recipesMap.get(key);\r\n  };\r\n\r\n  public delete = (key: string) => {\r\n    if (this.recipesMap.has(key)) {\r\n      let newMap = this.recipesMap.delete(key);\r\n      removeDocumentFromIndex(this.index, new Set(), key);\r\n      return new RecipeStore(this.index, newMap);\r\n    } else {\r\n      return this;\r\n    }\r\n  };\r\n\r\n  public getAll = (keys: string[]) => {\r\n    return keys.reduce((acc: Recipe[], key) => {\r\n      let r = this.recipesMap.get(key);\r\n      if (r) {\r\n        acc.push(r);\r\n      }\r\n      else {\r\n        acc.push(Recipe.error)\r\n      }\r\n      return acc;\r\n    }, []);\r\n  };\r\n\r\n  public count = () => {\r\n    return this.recipesMap.size;\r\n  };\r\n}\r\n","import { RecipeStore } from '../store/RecipeStore'\r\n\r\ndeclare module '../store/RecipeStore' {\r\n    interface RecipeStore {\r\n        getIngredients(): string[],\r\n        getUnits(): string[],\r\n        getLabels(): string[]\r\n    }\r\n}\r\n\r\nRecipeStore.prototype.getIngredients = function () {\r\n    let ingredients = new Set<string>();\r\n\r\n    this.all().forEach(r => {\r\n        r.getIngredients().forEach(i => {\r\n            ingredients.add(i.getName().toLowerCase());\r\n        })\r\n    });\r\n\r\n    const c = new Intl.Collator();\r\n    return Array.from(ingredients).sort(c.compare);\r\n};\r\n\r\nRecipeStore.prototype.getUnits = function () {\r\n\r\n    let units = new Set<string>();\r\n\r\n    this.all().forEach(r => {\r\n        r.getIngredients().forEach(i => {\r\n            units.add(i.getUnit().toLowerCase());\r\n        })\r\n    });\r\n\r\n    const c = new Intl.Collator();\r\n    return Array.from(units).sort(c.compare);\r\n}\r\n\r\nRecipeStore.prototype.getLabels = function () {\r\n\r\n    let labels = new Set<string>();\r\n\r\n    this.all().forEach(r => {\r\n        r.getLabels().forEach(l => {\r\n            labels.add(l.toUpperCase());\r\n        })\r\n    });\r\n\r\n    const c = new Intl.Collator();\r\n    return Array.from(labels).sort(c.compare);\r\n}","import CodeMirror from \"codemirror\";\r\nimport \"codemirror/addon/hint/show-hint\";\r\n\r\nimport { IngredientJSON } from '../model/Recipe';\r\n\r\nCodeMirror.defineMode(\"ingredients\", () => {\r\n  var Location = {\r\n    INGREDIENT: 0,\r\n    AMOUNT: 1,\r\n    UNIT: 2,\r\n    ERROR: 3,\r\n  };\r\n\r\n  return {\r\n    startState: function () {\r\n      return {\r\n        location: Location.INGREDIENT,\r\n      };\r\n    },\r\n    token: function (stream, state) {\r\n      if (stream.sol()) {\r\n        state.location = Location.INGREDIENT;\r\n      }\r\n\r\n      var ch = stream.next();\r\n\r\n      if (ch === \";\") {\r\n        if (state.location === Location.INGREDIENT)\r\n          state.location = Location.AMOUNT;\r\n        else if (state.location === Location.AMOUNT)\r\n          state.location = Location.UNIT;\r\n        else state.location = Location.ERROR;\r\n      }\r\n\r\n      if (state.location === Location.ERROR) {\r\n        return \"error\";\r\n      }\r\n\r\n      if (ch === \";\") {\r\n        return \"keyword\";\r\n      }\r\n\r\n      if (state.location === Location.INGREDIENT) {\r\n        stream.eatWhile(function (c: string) {\r\n          if (c !== \";\") {\r\n            return true;\r\n          }\r\n          return false;\r\n        });\r\n        return \"atom\";\r\n      }\r\n\r\n      if (state.location === Location.AMOUNT) {\r\n        stream.eatWhile(function (c: string) {\r\n          if (c !== \";\") {\r\n            return true;\r\n          }\r\n          return false;\r\n        });\r\n        return \"number\";\r\n      }\r\n\r\n      if (state.location === Location.UNIT) {\r\n        stream.eatWhile(function (c: string) {\r\n          if (c !== \";\") {\r\n            return true;\r\n          }\r\n          return false;\r\n        });\r\n        return \"atom\";\r\n      }\r\n\r\n      return \"error\";\r\n    },\r\n  };\r\n});\r\n\r\nexport function parseIngredients(text: string, errors: CodeMirror.Annotation[]) {\r\n\r\n  let ingredients: IngredientJSON[] = [];\r\n\r\n  let lines: string[] = text.split(/\\r?\\n/);\r\n\r\n  for (let i = 0; i < lines.length; i++) {\r\n    let line = lines[i];\r\n\r\n    if (line.trim().length > 0) {\r\n      let parts = line.split(\";\");\r\n\r\n      if (parts.length < 3) {\r\n        errors.push({\r\n          from: CodeMirror.Pos(i, 0),\r\n          to: CodeMirror.Pos(i, line.length),\r\n          message: \"Not enough parts. Syntax: <name>;<amount>;<unit>\",\r\n        });\r\n      } else if (parts.length > 3) {\r\n        let startpos = parts[0].length + parts[1].length + parts[2].length + 2;\r\n        errors.push({\r\n          from: CodeMirror.Pos(i, startpos),\r\n          to: CodeMirror.Pos(i, line.length),\r\n          message: \"Too many parts. Syntax: <name>;<amount>;<unit>\",\r\n        });\r\n      }\r\n      else {\r\n        let startAmount = parts[0].length + 1;\r\n        let endAmount = startAmount + parts[1].length;\r\n\r\n        parts = parts.map(s => s.trim());\r\n\r\n        if (parts[0].length === 0 || parts[1].length === 0 || parts[2].length === 0) {\r\n          errors.push({\r\n            from: CodeMirror.Pos(i, 0),\r\n            to: CodeMirror.Pos(i, line.length),\r\n            message: \"Empty part(s). Syntax: <name>;<amount>;<unit>\",\r\n          });\r\n        }\r\n        else if (\"\" + Number.parseFloat(parts[1]) !== parts[1]) {\r\n          errors.push({\r\n            from: CodeMirror.Pos(i, startAmount),\r\n            to: CodeMirror.Pos(i, endAmount),\r\n            message: \"Amount should be a number.\",\r\n          });\r\n        }\r\n        else {\r\n          ingredients.push({ name: parts[0], amount: Number.parseFloat(parts[1]), unit: parts[2] })\r\n        }\r\n      }\r\n    }\r\n  }\r\n\r\n  return ingredients;\r\n}\r\n\r\nCodeMirror.registerHelper(\"lint\", \"ingredients\", function (text: string) {\r\n  let errors: CodeMirror.Annotation[] = [];\r\n  parseIngredients(text, errors);\r\n  return errors;\r\n});\r\n\r\nexport function autocomplete(ingredients: string[], units: string[]) {\r\n  return function (\r\n    cm: CodeMirror.Editor,\r\n  ) {\r\n\r\n    var cursor = cm.getCursor(),\r\n      line = cm.getLine(cursor.line);\r\n    var start = cursor.ch,\r\n      end = cursor.ch;\r\n\r\n    let nrpart = (line.substring(0, end).match(/;/g) || []).length;\r\n\r\n    if (nrpart !== 0 && nrpart !== 2) {\r\n      return null;\r\n    }\r\n\r\n    while (start && line.charAt(start - 1) !== \";\") --start;\r\n    while (end < line.length && line.charAt(end) !== \";\") ++end;\r\n    var word = line.slice(start, end).trimLeft().toLowerCase();\r\n\r\n    let selection =\r\n      nrpart === 0\r\n        ? ingredients.filter((i) => i.indexOf(word) >= 0)\r\n        : units.filter((i) => i.startsWith(word));\r\n\r\n    if(selection.length === 1 && selection[0] === word) {\r\n        selection = []\r\n    }\r\n\r\n    return {\r\n      list: selection,\r\n      from: CodeMirror.Pos(cursor.line, start),\r\n      to: CodeMirror.Pos(cursor.line, end),\r\n    };\r\n  }\r\n};\r\n","import React, { FunctionComponent, ChangeEvent } from 'react';\r\nimport { Modal, Form, Button } from 'react-bootstrap';\r\n\r\nimport CreatableSelect from 'react-select/creatable';\r\n\r\nimport { RecipeJSON, Recipe, Ingredient } from '../model/Recipe';\r\nimport { RecipeStore } from '../store/RecipeStore';\r\nimport '../service/RecipeService';\r\n\r\nimport CodeMirror from 'codemirror';\r\nimport 'codemirror/lib/codemirror.css';\r\nimport 'codemirror/addon/lint/lint.css';\r\nimport 'codemirror/addon/hint/show-hint.css';\r\nimport 'codemirror/addon/selection/active-line.js';\r\nimport 'codemirror/addon/hint/show-hint';\r\nimport 'codemirror/addon/lint/lint.js';\r\nimport 'codemirror/addon/display/placeholder.js';\r\n\r\nimport { autocomplete, parseIngredients } from './IngredientLang'\r\n\r\ntype RecipeEditorProps = {\r\n    recipe?: Recipe,\r\n    recipeStore: RecipeStore,\r\n    onClose: () => void,\r\n    onSave: (recipe: Recipe) => void,\r\n    onDelete: (recipe: Recipe) => void\r\n}\r\n\r\nexport const RecipeEditor: FunctionComponent<RecipeEditorProps> = (props) => {\r\n\r\n    const [recipeJSON, setRecipeJSON] = React.useState<RecipeJSON>(\r\n        props.recipe ? props.recipe.toJSON() : Object.create({}));\r\n    const [isTitleInvalid, setIsTitleInvalid] = React.useState(!props.recipe);\r\n    const [isIngredientsInvalid, setIsIngredientsInvalid] = React.useState(false);\r\n\r\n    const generateIngredientCSV = (ingredients: Ingredient[]) => {\r\n        return ingredients.map(i => i.getName() + \";\" + i.getAmount() + \";\" + i.getUnit()).join(\"\\n\")\r\n    }\r\n\r\n    const [ingredientCSV, setIngredientCSV] = React.useState(props.recipe ?\r\n        generateIngredientCSV(props.recipe.getIngredients()) : \"\");\r\n\r\n    const allLabels = props.recipeStore.getLabels().map(\r\n        l => { return { value: l, label: l } })\r\n\r\n    const labels = recipeJSON.labels\r\n        ? recipeJSON.labels.map(\r\n            l => { return { value: l.toUpperCase(), label: l.toUpperCase() } })\r\n        : []\r\n\r\n    const setTitle = (e: ChangeEvent<HTMLInputElement>) => {\r\n        let newVal = e.currentTarget.value;\r\n        setIsTitleInvalid(!newVal || newVal.length === 0);\r\n        setRecipeJSON(r => ({ ...r, ...{ title: newVal } }))\r\n    }\r\n\r\n    const setImageURL = (e: ChangeEvent<HTMLInputElement>) => {\r\n        let newVal = e.currentTarget.value;\r\n        setRecipeJSON(r => ({ ...r, ...{ imageURL: newVal } }))\r\n    }\r\n\r\n    const setComment = (e: ChangeEvent<HTMLInputElement>) => {\r\n        let newVal: string = e.currentTarget.value;\r\n        setRecipeJSON(r => ({ ...r, ...{ comment: newVal } }))\r\n    }\r\n\r\n    const setSource = (e: ChangeEvent<HTMLInputElement>) => {\r\n        let newVal: string = e.currentTarget.value;\r\n        setRecipeJSON(r => ({ ...r, ...{ source: newVal } }))\r\n    }\r\n\r\n    const setServing = (e: ChangeEvent<HTMLInputElement>) => {\r\n        let newVal: number | undefined = Number.parseInt(e.currentTarget.value)\r\n        if (isNaN(newVal)) newVal = undefined\r\n        setRecipeJSON(r => ({ ...r, ...{ serving: newVal } }))\r\n    }\r\n\r\n    const updateLabels = (newValue: any) => {\r\n        let labels = (newValue as { label: string }[]).map(o => o.label)\r\n        setRecipeJSON(r => ({ ...r, ...{ labels: labels } }))\r\n    }\r\n\r\n    const updateIngredients = (text: string) => {\r\n\r\n        setIngredientCSV(text);\r\n\r\n        let errors: CodeMirror.Annotation[] = [];\r\n        let ingredients = parseIngredients(text, errors);\r\n        let invalid = errors.length > 0;\r\n\r\n        if (invalid) {\r\n            setIsIngredientsInvalid(true);\r\n        }\r\n        else {\r\n            setIsIngredientsInvalid(false);\r\n            setRecipeJSON(r => ({ ...r, ...{ ingredients: ingredients } }))\r\n        }\r\n    }\r\n\r\n    const saveRecipe = () => {\r\n        props.onSave(Recipe.fromJSON(recipeJSON))\r\n    }\r\n\r\n    const deleteRecipe = () => {\r\n        if (props.recipe) {\r\n            props.onDelete(props.recipe)\r\n        }\r\n    }\r\n\r\n    const focusElement = React.createRef<HTMLInputElement>();\r\n    const ingredientEditorElement = React.createRef<HTMLTextAreaElement>();\r\n\r\n    return (\r\n        <Modal show={true} onHide={props.onClose} onEntered={() => {\r\n            if (focusElement.current) focusElement.current.focus();\r\n            if (ingredientEditorElement.current) {\r\n                let cm = CodeMirror.fromTextArea(ingredientEditorElement.current,\r\n                    {\r\n                        lineNumbers: false,\r\n                        mode: \"ingredients\",\r\n                        gutters: [\"CodeMirror-lint-markers\"],\r\n                        lint: true,\r\n                        extraKeys: { \"Ctrl-Space\": \"autocomplete\" }\r\n                    });\r\n\r\n                cm.on(\"change\", (instance: CodeMirror.Editor) => {\r\n                    updateIngredients(instance.getValue());\r\n                });\r\n                cm.on(\"cursorActivity\", (instance: CodeMirror.Editor) => {\r\n                    instance.showHint({\r\n                        hint: autocomplete(props.recipeStore.getIngredients(), props.recipeStore.getUnits()),\r\n                        completeSingle: false,\r\n                        closeOnUnfocus: true\r\n                    });\r\n                });\r\n            }\r\n        }}>\r\n            <Modal.Header closeButton>\r\n                <Modal.Title>{props.recipe ? \"Edit\" : \"Add new \"} recipe</Modal.Title>\r\n            </Modal.Header>\r\n            <Modal.Body>\r\n                <Form>\r\n                    <Form.Group controlId=\"formTitle\">\r\n                        <Form.Control type=\"title\" value={recipeJSON.title} placeholder=\"Title\"\r\n                            isInvalid={isTitleInvalid} onChange={setTitle}\r\n                            ref={focusElement}\r\n                            size=\"sm\" />\r\n                        <Form.Control.Feedback type=\"invalid\">Required field!</Form.Control.Feedback>\r\n                    </Form.Group>\r\n                    <Form.Group controlId=\"formImageURL\">\r\n                        <Form.Control type=\"imageURL\" value={recipeJSON.imageURL} placeholder=\"Image URL\"\r\n                            onChange={setImageURL}\r\n                            size=\"sm\" />\r\n                        <Form.Control.Feedback type=\"invalid\">Required field!</Form.Control.Feedback>\r\n                    </Form.Group>\r\n                    <Form.Group controlId=\"formComment\">\r\n                        <Form.Control\r\n                            as=\"textarea\"\r\n                            value={recipeJSON.comment}\r\n                            onChange={setComment}\r\n                            rows={2}\r\n                            placeholder=\"Comment\"\r\n                            size=\"sm\" />\r\n                    </Form.Group>\r\n                    <Form.Group controlId=\"formSource\">\r\n                        <Form.Control\r\n                            type=\"source\"\r\n                            value={recipeJSON.source}\r\n                            onChange={setSource}\r\n                            placeholder=\"Where to find the recipe\"\r\n                            size=\"sm\" />\r\n                    </Form.Group>\r\n                    <Form.Group controlId=\"formServing\">\r\n                        <Form.Control\r\n                            type=\"serving\"\r\n                            value={recipeJSON.serving}\r\n                            onChange={setServing}\r\n                            placeholder=\"Number of porties\"\r\n                            size=\"sm\" />\r\n                    </Form.Group>\r\n                    <Form.Group controlId=\"formLabel\">\r\n                        <CreatableSelect\r\n                            styles={{\r\n                                menu: provided => ({ ...provided, zIndex: 9999 })\r\n                            }}\r\n                            size=\"sm\"\r\n                            options={allLabels}\r\n                            isMulti\r\n                            placeholder=\"Labels\"\r\n                            onChange={updateLabels}\r\n                            value={labels} />\r\n                    </Form.Group>\r\n                    <Form.Group controlId=\"formIngredients\">\r\n                        <Form.Control as=\"textarea\" value={ingredientCSV} ref={ingredientEditorElement}\r\n                            placeholder=\"Ingredients: <name>;<amount>;<unit>\" />\r\n                    </Form.Group>\r\n                </Form>\r\n            </Modal.Body>\r\n            <Modal.Footer>\r\n                <Button type=\"button\" variant=\"secondary\" onClick={props.onClose}>Close</Button>\r\n                <Button type=\"button\" variant=\"primary\" onClick={saveRecipe} disabled={isTitleInvalid || isIngredientsInvalid}>Save recipe</Button>\r\n                {props.recipe &&\r\n                    <Button type=\"button\" variant=\"primary\" onClick={deleteRecipe}>Delete recipe</Button>\r\n                }\r\n            </Modal.Footer>\r\n        </Modal >)\r\n}\r\n","import { List, Map, Set } from \"immutable\";\r\n\r\nexport class PlannedRecipe {\r\n\r\n  constructor(recipeId: string, serving: number) {\r\n    this.recipeId = recipeId;\r\n    this.serving = serving;\r\n  }\r\n\r\n  public getRecipeId() {\r\n    return this.recipeId;\r\n  }\r\n\r\n  /* get actual serving */\r\n  public getServing() {\r\n    return this.serving;\r\n  }\r\n\r\n  private recipeId: string;\r\n  private serving: number;\r\n}\r\n\r\n/* IMMUTABLE */\r\nexport class Plan {\r\n\r\n  // Don't store Recipes, only ids. They are immutable, so if they change...\r\n  private buckets = List<Map<string, PlannedRecipe>>();\r\n\r\n  private constructor(buckets: List<Map<string, PlannedRecipe>>) {\r\n    this.buckets = buckets;\r\n  }\r\n\r\n  public static new = (nrBuckets: number) => {\r\n    return new Plan(List().setSize(nrBuckets));\r\n  };\r\n\r\n  public setNrBuckets(nrBuckets: number) {\r\n    return new Plan(this.buckets.setSize(nrBuckets));\r\n  }\r\n\r\n  public getNrBuckets() {\r\n    return this.buckets.size;\r\n  }\r\n\r\n  public getNrRecipes() {\r\n    let ret = 0;\r\n    for (let bucket of this.buckets) {\r\n      if (bucket) {\r\n        ret += bucket.size\r\n      }\r\n    }\r\n    return ret;\r\n  }\r\n\r\n  public setPlannedRecipe(bucketNr: number, plannedRecipe: PlannedRecipe) {\r\n    let bucket = this.buckets.get(bucketNr) ?? Map();\r\n    return new Plan(this.buckets.set(bucketNr, bucket.set(plannedRecipe.getRecipeId(), plannedRecipe)));\r\n  }\r\n\r\n  public deleteRecipeById(bucketNr: number, recipeId: string) {\r\n    let bucket = this.buckets.get(bucketNr) ?? Map();\r\n    return new Plan(this.buckets.set(bucketNr, bucket.delete(recipeId)));\r\n  }\r\n\r\n  public getPlannedRecipes(bucketNr: number) {\r\n    let bucket = this.buckets.get(bucketNr) ?? Map();\r\n    return Array.from(bucket.valueSeq());\r\n  }\r\n\r\n  public getAllPlannedRecipes() {\r\n    let ids = List<PlannedRecipe>();\r\n    for (let bucket of this.buckets) {\r\n      if (bucket) {\r\n        ids = ids.concat(bucket.values());\r\n      }\r\n    }\r\n    return Array.from(ids);\r\n  }\r\n\r\n  /* A unique list of recipe ids */\r\n  public getAllRecipeIds() {\r\n    let ids = Set<string>();\r\n    for (let bucket of this.buckets) {\r\n      if (bucket) {\r\n        ids = ids.concat(bucket.valueSeq().map(pr => pr.getRecipeId()));\r\n      }\r\n    }\r\n    return Array.from(ids);\r\n  }\r\n}\r\n","import React from \"react\";\r\n\r\nimport { Button } from \"react-bootstrap\";\r\nimport { Form, Modal } from \"react-bootstrap\";\r\n\r\nimport { LoadFileDialog } from \"./component/LoadFileDialog\";\r\nimport { SaveFileDialog } from \"./component/SaveFileDialog\";\r\nimport { SettingsDialog } from \"./component/Settings\";\r\nimport { RecipeEditor } from \"./component/RecipeEditor\";\r\n\r\nimport \"./service/PlanExporterService\";\r\n\r\nimport App from \"./App\";\r\n\r\nexport enum Dialog {\r\n    LoadFile,\r\n    SaveFile,\r\n    RecipeEditor,\r\n    SavePlanXLS,\r\n    ShoppingList,\r\n    PlanSettings\r\n}\r\n\r\nexport function renderDialog(this: App) {\r\n    switch (this.state.showDialog) {\r\n        case Dialog.LoadFile: {\r\n            return (\r\n                <LoadFileDialog\r\n                    onClose={this.closeDialog}\r\n                    title=\"Load recipes file\"\r\n                    loadButtonTitle=\"Load recipes\"\r\n                    onLoad={this.loadFile}\r\n                />\r\n            );\r\n        }\r\n\r\n        case Dialog.SaveFile: {\r\n            return (\r\n                <SaveFileDialog\r\n                    onClose={this.closeDialog}\r\n                    title=\"Save recipes file\"\r\n                    saveButtonTitle=\"Save recipes\"\r\n                    data={this.genRecipeFileContent()}\r\n                    type=\"application/json\"\r\n                    initialFileName=\"recipes\"\r\n                    extension=\"json\"\r\n                    onSave={this.fileSaved}\r\n                />\r\n            );\r\n        }\r\n\r\n        case Dialog.RecipeEditor: {\r\n            return (\r\n                <RecipeEditor\r\n                    onClose={this.closeRecipeEditor}\r\n                    onSave={this.saveRecipe}\r\n                    onDelete={this.deleteRecipe}\r\n                    recipe={this.state.recipeToEdit}\r\n                    recipeStore={this.state.recipeStore}\r\n                />\r\n            );\r\n        }\r\n\r\n        case Dialog.SavePlanXLS: {\r\n            return (\r\n                <SaveFileDialog\r\n                    onClose={this.closeDialog}\r\n                    title=\"Save plan\"\r\n                    saveButtonTitle=\"Save plan\"\r\n                    data={this.state.plan.export(this.state.recipeStore)}\r\n                    type=\"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet\"\r\n                    initialFileName=\"plan\"\r\n                    extension=\"xlsx\"\r\n                    onSave={this.closeDialog}\r\n                />\r\n            );\r\n        }\r\n\r\n        case Dialog.ShoppingList: {\r\n            return (\r\n                <Modal show={true} onHide={this.closeDialog}>\r\n                    <Modal.Header closeButton>\r\n                        <Modal.Title>Shopping list</Modal.Title>\r\n                    </Modal.Header>\r\n\r\n                    <Modal.Body>\r\n                        <Form>\r\n                            <Form.Control\r\n                                as=\"textarea\"\r\n                                rows={20}\r\n                                cols={80}\r\n                                value={this.state.plan.exportShoppingList(this.state.recipeStore)}\r\n                                readOnly />\r\n                        </Form>\r\n                    </Modal.Body>\r\n\r\n                    <Modal.Footer>\r\n                        <Button variant=\"secondary\" onClick={this.closeDialog}>\r\n                            Close\r\n              </Button>\r\n                    </Modal.Footer>\r\n                </Modal>\r\n            );\r\n        }\r\n\r\n        case Dialog.PlanSettings: {\r\n            return (\r\n                <SettingsDialog\r\n                    onClose={this.closeDialog}\r\n                    settings={this.state.settings}\r\n                    onSave={this.updateSettings} />\r\n            );\r\n        }\r\n\r\n        default:\r\n            return <></>\r\n    }\r\n};\r\n","import { RecipeStore } from '../store/RecipeStore';\r\n\r\nimport { Plan, PlannedRecipe } from '../model/Plan';\r\nimport { Recipe } from '../model/Recipe';\r\n\r\nimport XLSX from 'xlsx';\r\nimport _ from 'lodash';\r\n\r\ndeclare module '../model/Plan' {\r\n    interface Plan {\r\n        exportShoppingList(recipeStore: RecipeStore): string\r\n        export(recipeStore: RecipeStore): Blob\r\n    }\r\n}\r\n\r\n// Returns: Ingredient -> (recipe id -> [amount, unit, scale][])\r\nfunction calculateIngredientMap(recipes: [Recipe, PlannedRecipe][]) {\r\n    let ingredientMap = new Map<string, Map<PlannedRecipe, [number, string, number][]>>();\r\n\r\n    recipes.forEach(t => {\r\n\r\n        let r = t[0];\r\n        let pr = t[1];\r\n\r\n        r.getIngredients().forEach(i => {\r\n            let ingredientName = i.getName().toLowerCase();\r\n            let oneIngredientRecord = ingredientMap.get(ingredientName);\r\n            if (!oneIngredientRecord) {\r\n                oneIngredientRecord = new Map()\r\n                ingredientMap.set(ingredientName, oneIngredientRecord);\r\n            }\r\n\r\n            let oneRecipeRecord = oneIngredientRecord.get(pr) ?? [];\r\n            oneRecipeRecord.push([i.getAmount(), i.getUnit().toLowerCase(), pr.getServing() / r.getServing()]);\r\n            oneIngredientRecord.set(pr, oneRecipeRecord);\r\n        });\r\n    });\r\n\r\n    return ingredientMap;\r\n}\r\n\r\nfunction calculateShoppingList(\r\n    ingredientMap: Map<string, Map<PlannedRecipe, [number, string, number][]>>,\r\n    ingredients: string[]) {\r\n    let ingredientList = ingredients.map(name => {\r\n\r\n        let oneIngredientRecord = new Map<string, number>()\r\n        let ingredient = ingredientMap.get(name) ?? new Map<string, [number, string, number][]>()\r\n\r\n        // Group ingredient usages by unit\r\n        for (let oneUsage of ingredient.values()) {\r\n            for (let [amount, unit, scale] of oneUsage) {\r\n                oneIngredientRecord.set(unit,\r\n                    (oneIngredientRecord.get(unit) ?? 0) + amount * scale)\r\n            }\r\n        }\r\n\r\n        return { \"name\": name, \"amounts\": oneIngredientRecord }\r\n    });\r\n\r\n    let ingredientsRows = []\r\n\r\n    for (let { name, amounts } of ingredientList) {\r\n        let line: [string] = [name]\r\n        for (let [unit, amount] of amounts) {\r\n            line.push(\"\" + amount + \" \" + unit)\r\n        }\r\n        ingredientsRows.push(line)\r\n    }\r\n\r\n    return ingredientsRows;\r\n}\r\n\r\n// Exports ShoppingList as list of MD lines\r\nPlan.prototype.exportShoppingList = function (recipeStore: RecipeStore) {\r\n    // Wan't here the recipes as many times as they appear in the plan\r\n    let plannedRecipes = this.getAllPlannedRecipes();\r\n    let recipes = recipeStore.getAll(plannedRecipes.map(pr => pr.getRecipeId()));\r\n    let ingredientMap = calculateIngredientMap(_.zip(recipes, plannedRecipes) as [Recipe, PlannedRecipe][]);\r\n\r\n    let c = new Intl.Collator();\r\n    let ingredients = Array.from(ingredientMap.keys()).sort(c.compare);\r\n    let ingredientsRows = calculateShoppingList(ingredientMap, ingredients);\r\n\r\n    let res = \"\";\r\n\r\n    for (let row of ingredientsRows) {\r\n        res += \"**\" + row.shift() + \"**\";\r\n        res += \" - \";\r\n        res += row.join(\" + \");\r\n        res += \"\\n\";\r\n    }\r\n\r\n    return res;\r\n}\r\n\r\n// Exports Plan as XLSX\r\nPlan.prototype.export = function (recipeStore: RecipeStore): Blob {\r\n    // Want here the recipes as many times as they appear in the plan\r\n    let plannedRecipes = this.getAllPlannedRecipes();\r\n    let recipes = recipeStore.getAll(plannedRecipes.map(pr => pr.getRecipeId()));\r\n    let zippedPlannedRecipes = _.zip(recipes, plannedRecipes) as [Recipe, PlannedRecipe][]\r\n\r\n    let uniqueRecipes = new Set(recipes);\r\n    let ingredientMap = calculateIngredientMap(zippedPlannedRecipes);\r\n    let ingredients = Array.from(ingredientMap.keys()).sort();\r\n\r\n    let wb = XLSX.utils.book_new();\r\n\r\n    // ----------------------------------------------------------------------------------------\r\n    // Generate map\r\n\r\n    let planRows: string[][] = _.range(0, this.getNrBuckets()).map(bid => {\r\n        let plannedRecipes = this.getPlannedRecipes(bid);\r\n        let recipes = recipeStore.getAll(plannedRecipes.map(pr => pr.getRecipeId()));\r\n        let zippedPlannedRecipes = _.zip(recipes, plannedRecipes) as [Recipe, PlannedRecipe][]\r\n        return [\"Day #\" + (bid + 1)].concat(\r\n            zippedPlannedRecipes.map(t => t[0].getTitle() + \" (\" + t[1].getServing() + \" people)\"))\r\n    })\r\n    let planWS = XLSX.utils.aoa_to_sheet(planRows);\r\n    XLSX.utils.book_append_sheet(wb, planWS, \"Plan\");\r\n\r\n    // ----------------------------------------------------------------------------------------\r\n    // Calculate shopping list\r\n\r\n    let ingredientsRows = calculateShoppingList(ingredientMap, ingredients);\r\n    let ingredientsWS = XLSX.utils.aoa_to_sheet(ingredientsRows);\r\n    XLSX.utils.book_append_sheet(wb, ingredientsWS, \"Shopping list\");\r\n\r\n    // ----------------------------------------------------------------------------------------\r\n    // Generate ingredient map\r\n\r\n    const mapHeaderRow = zippedPlannedRecipes.map(t => t[0].getTitle() + \" (\" + t[1].getServing() + \" people)\")\r\n    mapHeaderRow.unshift(\"\")\r\n\r\n    const mapDataRows = ingredients.map(name => {\r\n\r\n        let line = [name]\r\n\r\n        for (let pr of plannedRecipes) {\r\n            let ingredient = ingredientMap.get(name) ?? new Map<PlannedRecipe, [number, string, number][]>();\r\n            let recipeIngredient = ingredient.get(pr);\r\n            if (recipeIngredient) {\r\n                line.push(recipeIngredient.map(au => \"\" + (au[0] * au[2]) + \" \" + au[1]).join(\", \"));\r\n            }\r\n            else {\r\n                line.push(\"\");\r\n            }\r\n\r\n        }\r\n\r\n        return line;\r\n    });\r\n\r\n    let mapRows = [mapHeaderRow].concat(mapDataRows);\r\n    let mapWS = XLSX.utils.aoa_to_sheet(mapRows);\r\n    XLSX.utils.book_append_sheet(wb, mapWS, \"Ingredient map\");\r\n\r\n    // ----------------------------------------------------------------------------------------\r\n    // Generate recipes\r\n\r\n    // Recipes must be converted to a set to eliminate duplications\r\n    for (let r of uniqueRecipes) {\r\n        let recipeRows = [\r\n            [\"Title\", r.getTitle()],\r\n            [\"Comment\", r.getComment() ?? \"-\"],\r\n            [\"Serves\", r.getServing()],\r\n            [\"Source\", r.getSource() ?? \"-\"],\r\n            [\"Ingredients:\"]\r\n        ];\r\n\r\n        for (let i of r.getIngredients()) {\r\n            recipeRows.push([i.getName().toLowerCase(), i.getAmount(), i.getUnit().toLowerCase()])\r\n        }\r\n\r\n        let recipeWS = XLSX.utils.aoa_to_sheet(recipeRows);\r\n        // Replace special characters not allowed in sheet name\r\n        let sheetName = r.getTitle().substr(0, 31).replace(/[[\\]/\\\\:*?]/g, '_');\r\n        XLSX.utils.book_append_sheet(wb, recipeWS, sheetName);\r\n    }\r\n\r\n    let bytes = XLSX.write(wb, { bookType: 'xlsx', bookSST: false, type: 'array' });\r\n    return new Blob([bytes], {\r\n        type: 'application/octet-stream'\r\n    });\r\n}\r\n","import { ScoringFun } from './ScoringFun';\r\n\r\n/* These classes are not immutable, but it is fine as these are \r\n   not used in any state */ \r\n\r\nexport class RecipeScoring {\r\n    private scorings: Map<ScoringFun, number>\r\n    private sum: number\r\n\r\n    constructor() {\r\n        this.scorings = new Map();\r\n        this.sum = 0;\r\n    }\r\n\r\n    addScoring = (scoringFun: ScoringFun, score: number) => {\r\n        this.scorings.set(scoringFun, score)\r\n        this.sum += score\r\n    }\r\n\r\n    getSum = () => {\r\n        return this.sum;\r\n    }\r\n\r\n    getScorings = () => {\r\n        return Array.from(this.scorings);\r\n    }\r\n}\r\n\r\nexport class Scoring {\r\n    private scoring: Map<string, RecipeScoring>\r\n    private sum: number\r\n\r\n    constructor() {\r\n        this.scoring = new Map();\r\n        this.sum = 0;\r\n    }\r\n\r\n    public addScoring = (recipeId: string, sf: ScoringFun, score: number) => {\r\n        if (!this.scoring.has(recipeId)) {\r\n            this.scoring.set(recipeId, new RecipeScoring())\r\n        }\r\n\r\n        this.scoring.get(recipeId)?.addScoring(sf, score);\r\n    }\r\n\r\n    public getSum = (recipeId: string) => {\r\n        let rs = this.scoring.get(recipeId);\r\n        if (rs) {\r\n            return rs.getSum();\r\n        }\r\n        else {\r\n            return 0;\r\n        }\r\n    }\r\n\r\n    public getScoring = (recipeId: string) => {\r\n        return this.scoring.get(recipeId);\r\n    }\r\n}\r\n","import { Recipe } from '../model/Recipe';\r\nimport { Plan } from '../model/Plan';\r\nimport { ScoringFun } from '../model/ScoringFun';\r\nimport { Scoring } from '../model/Scoring';\r\n\r\nimport { RecipeStore } from '../store/RecipeStore';\r\n\r\nimport { Parser, Expression } from 'expr-eval';\r\n\r\nimport { Map as IMap } from \"immutable\";\r\nimport _ from 'lodash';\r\n\r\ndeclare module '../store/RecipeStore' {\r\n    interface RecipeStore {\r\n        scoreBy(plan: Plan, scoringFuns: ScoringFun[], rand: IMap<string, number>): Scoring\r\n    }\r\n}\r\n\r\nfunction labelDict(r: Recipe) {\r\n    return _.countBy(r.getLabels().map(l => l.toUpperCase()));\r\n}\r\n\r\nfunction _scoreRecipes(e: Expression, recipes: Recipe[], fun: ScoringFun, rand: IMap<string, number>) {\r\n    return new Map(recipes.map(r => {\r\n\r\n        let s = e.evaluate({\r\n            // Dirty trick to be able to pass Recipe type\r\n            \"this\": r as unknown as string,\r\n            \"rrandom\": rand.get(r.getId()) || 0\r\n        });\r\n        return [r, s]\r\n    }));\r\n}\r\n\r\nRecipeStore.prototype.scoreBy = function (plan: Plan, scoringFuns: ScoringFun[], rand: IMap<string, number>) {\r\n    let p = new Parser();\r\n\r\n    let recipes = this.all();\r\n    let rlabels = new Map(recipes.map(r => [r, labelDict(r)]))\r\n    let precipeids = plan.getAllPlannedRecipes().map(r => r.getRecipeId())\r\n    let precipes = _.countBy(precipeids)\r\n    let plabels = _.countBy(_.flatMap(this.getAll(precipeids), r => r.getLabels()).map(l => l.toUpperCase()))\r\n\r\n    p.functions.intersection = (as: any[], bs: any[]) => {\r\n        return _.intersection(as, bs);\r\n    }\r\n\r\n    p.functions.sum = (as: number[]) => {\r\n        return _.sum(as);\r\n    }\r\n\r\n    p.functions.ingredients = (r: Recipe) => {\r\n        return r.getIngredients();\r\n    }\r\n\r\n    p.functions.hasLabel = (r: Recipe, label: string) => {\r\n        let ld = rlabels.get(r);\r\n        if (ld) {\r\n            return ld[label] > 0;\r\n        }\r\n        else {\r\n            return false;\r\n        }\r\n    }\r\n\r\n    p.functions.countLabelInPlan = (label: string) => {\r\n        return plabels[label] ?? 0;\r\n    }\r\n\r\n    p.functions.countRecipeInPlan = (r: Recipe) => {\r\n        return precipes[r.getId()] ?? 0;\r\n    }\r\n\r\n    let scoring = new Scoring()\r\n\r\n    for (let sf of scoringFuns) {\r\n        let e = p.parse(sf.getScript())\r\n\r\n        let max = -1;\r\n\r\n        p.functions.normalize = (curr: number) => {\r\n            if (curr > max) {\r\n                max = curr;\r\n            }\r\n\r\n            return curr;\r\n        }\r\n\r\n        let scores = _scoreRecipes(e, recipes, sf, rand);\r\n\r\n        // If `normalize` was used, we need to run it again\r\n        if (max > 0) {\r\n            p.functions.normalize = (curr: number) => {\r\n                return curr / max;\r\n            }\r\n\r\n            scores = _scoreRecipes(e, recipes, sf, rand);\r\n        }\r\n\r\n        for (let [r, s] of scores) {\r\n            scoring.addScoring(r.getId(), sf, s);\r\n        }\r\n    }\r\n\r\n    return scoring;\r\n}\r\n","import React, { FunctionComponent } from 'react';\r\n\r\nimport { Container, Col, Row } from 'react-bootstrap';\r\nimport { Binoculars, People, Cart2, ExclamationCircle, ChatRightText, SortNumericUpAlt } from 'react-bootstrap-icons';\r\n\r\nimport { Recipe } from '../model/Recipe';\r\nimport { RecipeScoring } from '../model/Scoring';\r\n\r\ntype RecipeQuickViewProps = {\r\n    recipe: Recipe,\r\n    scoring?: RecipeScoring\r\n}\r\n\r\nexport const RecipeQuickView: FunctionComponent<RecipeQuickViewProps> = ({ recipe, scoring }) => {\r\n\r\n    const c = new Intl.Collator();\r\n    const ingredients = recipe.getIngredients().map(r => r.getName())\r\n        .sort(c.compare)\r\n        .map(n => <Col key={n} sm=\"auto\" className=\"border mt-1 ml-2 pt-2 pb-2\">{n}</Col>)\r\n\r\n    const labels = recipe.getLabels()\r\n        .sort(c.compare)\r\n        .map(n => <Col key={n} sm=\"auto\" className=\"border mt-1 ml-2 pt-2 pb-2\">{n}</Col>)\r\n\r\n    const scoringLines = scoring &&\r\n        scoring.getScorings().map(oneScore =>\r\n            <Row key={oneScore[0].getName()}>\r\n                <Col xs=\"2\">\r\n                    {oneScore[1].toFixed(2)}\r\n                </Col>\r\n                <Col xs=\"1\">\r\n                    ←\r\n                </Col>\r\n                <Col>\r\n                    {oneScore[0].getName()}\r\n                </Col>\r\n            </Row>);\r\n\r\n    return (\r\n        <Container className=\"pl-0 pr-2\">\r\n            {recipe.getComment() &&\r\n                <Row className=\"pb-2\">\r\n                    <Col sm=\"auto\"><ChatRightText height=\"18\" /></Col>\r\n                    <Col sm=\"auto\">{recipe.getComment()}</Col>\r\n                </Row>\r\n            }\r\n            {recipe.getServing() &&\r\n                <Row className=\"pb-2\">\r\n                    <Col sm=\"auto\"><People height=\"18\" /></Col>\r\n                    <Col sm=\"auto\">{recipe.getServing()}</Col>\r\n                </Row>\r\n            }\r\n            {recipe.getSource() &&\r\n                <Row className=\"pb-2\">\r\n                    <Col sm=\"auto\"><Binoculars height=\"18\" /></Col>\r\n                    <Col sm=\"auto\">{recipe.getSource()}</Col>\r\n                </Row>\r\n            }\r\n            <Row className=\"pb-2\">\r\n                <Col xs={1}>\r\n                    <Cart2 height=\"18\" />\r\n                </Col>\r\n                <Col>\r\n                    <Container fluid className=\"pl-0\">\r\n                        <Row>\r\n                            {ingredients}\r\n                        </Row>\r\n                    </Container>\r\n                </Col>\r\n            </Row>\r\n            {recipe.getLabels().length > 0 &&\r\n                <Row className=\"pb-2\">\r\n                    <Col xs={1}>\r\n                        <ExclamationCircle height=\"18\" />\r\n                    </Col>\r\n                    <Col>\r\n                        <Container fluid className=\"pl-0\">\r\n                            <Row>\r\n                                {labels}\r\n                            </Row>\r\n                        </Container>\r\n                    </Col>\r\n                </Row>\r\n            }\r\n            {scoring &&\r\n                <Row>\r\n                    <Col xs={1}>\r\n                        <SortNumericUpAlt height=\"18\" />\r\n                    </Col>\r\n                    <Col>\r\n                        <Container className=\"ml-0 pl-0\">\r\n                            {scoringLines}\r\n                            <Row>\r\n                                <Col xs=\"2\" className=\"border\">\r\n                                    {scoring.getSum().toFixed(2)}\r\n                                </Col>\r\n                            </Row>\r\n                        </Container>\r\n                    </Col>\r\n                </Row>\r\n            }\r\n        </Container>\r\n    )\r\n}\r\n","import React, { FunctionComponent, useEffect } from 'react';\r\n\r\nimport { Form, FormControl, InputGroup } from 'react-bootstrap';\r\nimport { Popover, OverlayTrigger, Tooltip } from 'react-bootstrap';\r\nimport { Card, ListGroup } from 'react-bootstrap';\r\nimport { Container, Row, Col } from 'react-bootstrap';\r\nimport { Image } from 'react-bootstrap';\r\n\r\nimport { Pencil, Eye, Search, X, Image as ImageIcon } from 'react-bootstrap-icons';\r\n\r\nimport { RecipeQuickView } from './RecipeQuickView'\r\n\r\nimport { Recipe } from '../model/Recipe';\r\nimport { Plan } from '../model/Plan';\r\nimport { Scoring, RecipeScoring } from '../model/Scoring';\r\nimport { RecipeStore } from '../store/RecipeStore';\r\n\r\nimport { useDrag } from 'react-dnd'\r\n\r\nimport { Set as ISet } from \"immutable\";\r\nimport _ from 'lodash';\r\n\r\ntype RecipeSelectorProps = {\r\n    recipeStore: RecipeStore,\r\n    scoring: Scoring,\r\n    plan: Plan,\r\n    highlightedRecipes: ISet<string>,\r\n    onEdit: (recipe: Recipe) => void\r\n}\r\n\r\ntype RecipeListItemProps = {\r\n    recipe: Recipe,\r\n    scoring?: RecipeScoring,\r\n    selected: boolean,\r\n    highlighted: boolean,\r\n    onEdit: (recipe: Recipe) => void\r\n}\r\n\r\nconst RecipeListItem = React.forwardRef<HTMLDivElement, RecipeListItemProps>(({\r\n    recipe,\r\n    selected,\r\n    scoring,\r\n    highlighted,\r\n    onEdit }, ref) => {\r\n\r\n    const [{ isDragging }, drag] = useDrag({\r\n        item: { type: \"recipe\", id: recipe.getId() },\r\n        collect: (monitor) => ({\r\n            isDragging: !!monitor.isDragging()\r\n        })\r\n    })\r\n\r\n    const c = new Intl.Collator();\r\n    const labels = recipe.getLabels()\r\n        .sort(c.compare)\r\n        .map(n => <Col key={n} sm=\"auto\" className=\"mealee-recipe-selector-label mt-1 ml-2\">{n}</Col>)\r\n\r\n    const imageURLExists = (recipe.getImageURL() || \"\").length > 0\r\n\r\n    return (\r\n        <div\r\n            ref={ref}\r\n            className=\"hover\"\r\n            style={{\r\n                position: 'relative',\r\n                width: '100%',\r\n                height: '100%',\r\n                backgroundColor: '#FFFFFF'\r\n            }}>\r\n\r\n            <Card\r\n                className={highlighted ? \"mealee-recipe-selector-item-highlighted\" : \"mealee-recipe-selector-item\"}\r\n                key={recipe.getId()}\r\n                ref={drag}\r\n                style={{\r\n                    opacity: isDragging || selected ? 0.5 : 1,\r\n                    cursor: 'move',\r\n                }}>\r\n                <Card.Body className=\"p-0\">\r\n                    <Container>\r\n                        <Row>\r\n                            <Col className=\"pl-0 ml-2\">\r\n                                {recipe.getTitle()}\r\n                            </Col>\r\n                        </Row>\r\n                        <Row>\r\n                            {labels}\r\n                        </Row>\r\n                    </Container>\r\n                </Card.Body>\r\n            </Card>\r\n\r\n            <div\r\n                className=\"hover-on\"\r\n                style={{\r\n                    position: 'absolute',\r\n                    top: '50%',\r\n                    transform: 'translateY(-50%)',\r\n                    right: 10,\r\n                    height: 20,\r\n                    width: imageURLExists ? 60 : 40,\r\n                    zIndex: 1,\r\n                    opacity: 0.5\r\n                }}>\r\n\r\n                {imageURLExists &&\r\n                    <>\r\n                        <OverlayTrigger\r\n                            placement=\"auto\"\r\n                            overlay={\r\n                                <Image src={recipe.getImageURL()} className=\"recipe-image rounded\" />\r\n                            }>\r\n                            <ImageIcon height=\"18\" style={{ cursor: 'pointer' }} />\r\n                        </OverlayTrigger>\r\n                        &nbsp;\r\n                    </>}\r\n                <OverlayTrigger\r\n                    placement=\"auto\"\r\n                    overlay={\r\n                        <Popover id=\"popover-recipe-quick-view\" className=\"recipe-quick-view\">\r\n                            <Popover.Title as=\"h4\">{recipe.getTitle()}</Popover.Title>\r\n                            <Popover.Content>\r\n                                <RecipeQuickView recipe={recipe} scoring={scoring} />\r\n                            </Popover.Content>\r\n                        </Popover>}>\r\n                    <Eye height=\"18\" style={{ cursor: 'pointer' }} />\r\n                </OverlayTrigger>\r\n                &nbsp;\r\n                <Pencil height=\"18\" onClick={() => onEdit(recipe)} style={{ cursor: 'pointer' }} />\r\n\r\n            </div>\r\n\r\n        </div >\r\n    )\r\n})\r\n\r\nexport const RecipeSelector: FunctionComponent<RecipeSelectorProps> = ({\r\n    recipeStore,\r\n    scoring,\r\n    plan,\r\n    highlightedRecipes,\r\n    onEdit }) => {\r\n\r\n    const [filter, setFilter] = React.useState(\"\");\r\n    // Use this to remember if we already scrolled to the highlited element\r\n    // We only want to do that once\r\n    const [lastHighlightedRecipes, setLastHighlightedRecipes] = React.useState(ISet());\r\n\r\n    const debouncedSetFilter = React.useCallback(\r\n        _.debounce(setFilter, 100),\r\n        [], // will be created only once initially\r\n    );\r\n\r\n    const refresh = (event: React.ChangeEvent<HTMLInputElement>) => {\r\n        debouncedSetFilter(event.currentTarget.value);\r\n    }\r\n\r\n    const filteredRecipes = (filter.trim().length === 0) ?\r\n        recipeStore.all() : recipeStore.search(filter).map(res => res.key);\r\n\r\n    const selectedRecipeSet = new Set(plan.getAllRecipeIds())\r\n\r\n    let highlightedListItemRef: React.RefObject<HTMLDivElement> | null = null\r\n\r\n    const listItems = _.sortBy(filteredRecipes, r => scoring.getSum(r.getId()) * -1)\r\n        .map((recipe) => {\r\n\r\n            const highlighted = highlightedRecipes.has(recipe.getId())\r\n            const ref = highlighted && !highlightedListItemRef ? React.createRef<HTMLDivElement>() : null\r\n\r\n            if (ref) {\r\n                highlightedListItemRef = ref;\r\n            }\r\n\r\n            return (\r\n                <ListGroup.Item className=\"p-0\" key={recipe.getId()} >\r\n                    <RecipeListItem\r\n                        key={recipe.getId()}\r\n                        ref={ref}\r\n                        recipe={recipe}\r\n                        scoring={scoring.getScoring(recipe.getId())}\r\n                        onEdit={onEdit}\r\n                        selected={selectedRecipeSet.has(recipe.getId())}\r\n                        highlighted={highlighted} />\r\n                </ListGroup.Item >\r\n            )\r\n        });\r\n\r\n    // Scroll to first highlighted item, but only once\r\n    // If highlightedRecipes === lastHighlightedRecipes, we already scrolled there\r\n    useEffect(() => {\r\n        if (highlightedListItemRef && highlightedRecipes !== lastHighlightedRecipes) {\r\n            if (highlightedListItemRef.current) {\r\n                highlightedListItemRef.current.scrollIntoView({\r\n                    behavior: 'smooth',\r\n                    block: 'start',\r\n                })\r\n                setLastHighlightedRecipes(highlightedRecipes);\r\n            }\r\n        }\r\n\r\n    }, [highlightedListItemRef, highlightedRecipes, lastHighlightedRecipes]);\r\n\r\n    return (\r\n        <Form className=\"pt-2 h-100 d-flex flex-column\" onSubmit={(e) => e.preventDefault()}>\r\n            <InputGroup className=\"mb-1\">\r\n                <InputGroup.Prepend>\r\n                    <InputGroup.Text><Search /></InputGroup.Text>\r\n                </InputGroup.Prepend>\r\n                <FormControl type=\"text\" placeholder=\"Filter recipes\" value={filter} onChange={refresh} />\r\n                <InputGroup.Append>\r\n                    <InputGroup.Text style={{ backgroundColor: \"white\" }}>\r\n                        <OverlayTrigger\r\n                            key=\"download\"\r\n                            placement=\"right\"\r\n                            overlay={\r\n                                <Tooltip id=\"clear-search-field\">\r\n                                    Clear search field\r\n                                </Tooltip>\r\n                            }>\r\n                            <X style={{ cursor: \"pointer\" }} onClick={() => setFilter(\"\")} />\r\n                        </OverlayTrigger>\r\n                    </InputGroup.Text>\r\n                </InputGroup.Append>\r\n            </InputGroup>\r\n            <Form.Group controlId=\"recipeGroup\" className=\"flex-grow-1 overflow-auto mealee-recipe-selector-list\">\r\n                <ListGroup>{listItems}</ListGroup>\r\n            </Form.Group>\r\n        </Form>\r\n    );\r\n}\r\n","import React, { FunctionComponent } from 'react';\r\n\r\nimport { Container, Row, Col, Card } from 'react-bootstrap';\r\nimport { Popover, OverlayTrigger, Tooltip } from 'react-bootstrap';\r\nimport { Trash, Eye, People } from 'react-bootstrap-icons';\r\n\r\nimport { RecipeQuickView } from './RecipeQuickView'\r\n\r\nimport { RecipeStore } from \"../store/RecipeStore\";\r\nimport { Recipe } from \"../model/Recipe\";\r\nimport { Plan, PlannedRecipe } from \"../model/Plan\";\r\n\r\nimport { useDrop, useDrag } from 'react-dnd'\r\nimport _ from 'lodash';\r\n\r\ntype RecipeBoxProps = {\r\n    bucketId: number,\r\n    recipeStore: RecipeStore,\r\n    plannedRecipe: PlannedRecipe,\r\n    onDelete: (recipeId: string) => void\r\n    onUpdate: (plannedRecipe: PlannedRecipe) => void\r\n}\r\n\r\nconst RecipeBox: FunctionComponent<RecipeBoxProps> = ({\r\n    bucketId,\r\n    recipeStore,\r\n    plannedRecipe,\r\n    onDelete,\r\n    onUpdate }) => {\r\n\r\n    let recipe = recipeStore.get(plannedRecipe.getRecipeId()) ?? Recipe.error\r\n\r\n    const [{ isDragging }, drag] = useDrag({\r\n        item: { type: \"recipe\", plannedRecipe: plannedRecipe, from: bucketId },\r\n        collect: (monitor) => ({\r\n            isDragging: !!monitor.isDragging()\r\n        })\r\n    })\r\n\r\n    const updateServing = (e: React.WheelEvent<HTMLDivElement>) => {\r\n        var newServing = e.deltaY > 0\r\n            ? Math.max(1, plannedRecipe.getServing() - 1)\r\n            : Math.min(9, plannedRecipe.getServing() + 1);\r\n\r\n        onUpdate(new PlannedRecipe(plannedRecipe.getRecipeId(), newServing))\r\n    }\r\n\r\n    const c = new Intl.Collator();\r\n    const labels = recipe.getLabels()\r\n        .sort(c.compare)\r\n        .map(n => <Col key={n} sm=\"auto\" className=\"mealee-bucker-recipe-label mt-1 ml-2\">{n}</Col>)\r\n\r\n    return (\r\n        <div\r\n            ref={drag}\r\n            className=\"hover\"\r\n            style={{\r\n                position: 'relative',\r\n                width: '100%',\r\n                height: '100%',\r\n                opacity: isDragging ? 0.5 : 1,\r\n                cursor: 'move',\r\n            }}>\r\n\r\n            <Card className=\"mealee-bucket-recipe\">\r\n                <Card.Body className=\"mealee-bucket-recipe-body\">\r\n                    <Container>\r\n                        <Row>\r\n                            <Col className=\"pl-0 ml-2\">\r\n                                {recipe.getTitle()}\r\n                            </Col>\r\n                        </Row>\r\n                        <Row>\r\n                            {labels}\r\n                        </Row>\r\n                    </Container>\r\n                </Card.Body>\r\n            </Card>\r\n\r\n            <div\r\n                className=\"hover-on\"\r\n                style={{\r\n                    position: 'absolute',\r\n                    top: 0,\r\n                    right: 0,\r\n                    height: 40,\r\n                    width: 20,\r\n                    zIndex: 1,\r\n                    opacity: 0.5\r\n                }}>\r\n\r\n                <Trash height=\"18\" onClick={() => onDelete(recipe.getId())} style={{ cursor: 'pointer' }} />\r\n                <OverlayTrigger\r\n                    placement=\"auto\"\r\n                    overlay={\r\n                        <Popover id=\"popover-recipe-quick-view\" className=\"recipe-quick-view\">\r\n                            <Popover.Title as=\"h4\">{recipe.getTitle()}</Popover.Title>\r\n                            <Popover.Content>\r\n                                <RecipeQuickView recipe={recipe} />\r\n                            </Popover.Content>\r\n                        </Popover>}>\r\n                    <Eye height=\"18\" style={{ cursor: 'pointer' }} />\r\n                </OverlayTrigger>\r\n\r\n            </div>\r\n\r\n            <div\r\n                className=\"hover-on\"\r\n                style={{\r\n                    position: 'absolute',\r\n                    top: 0,\r\n                    left: 3,\r\n                    height: 20,\r\n                    width: 25,\r\n                    zIndex: 1,\r\n                    opacity: 0.5\r\n                }}>\r\n\r\n                <OverlayTrigger\r\n                    key=\"new\"\r\n                    placement=\"right\"\r\n                    overlay={\r\n                        <Tooltip id=\"tooltip-new\">\r\n                            Scroll up/down to change\r\n                        </Tooltip>\r\n                    }>\r\n                    <div onWheel={updateServing}>\r\n                        <span style={{ fontSize: 12, paddingTop: 2, paddingRight: 0 }}>{plannedRecipe.getServing()}</span>\r\n                        <People height=\"12\" />\r\n                    </div>\r\n                </OverlayTrigger>\r\n\r\n            </div>\r\n        </div>\r\n    )\r\n}\r\n\r\ntype BucketProps = {\r\n    bucketId: number,\r\n    recipeStore: RecipeStore,\r\n    plannedRecipes: PlannedRecipe[],\r\n    onDelete: (bucketid: number, recipeStore: string) => void,\r\n    onUpdate: (bucketid: number, plannedRecipe: PlannedRecipe) => void,\r\n}\r\n\r\nconst Bucket: FunctionComponent<BucketProps> = ({\r\n    bucketId,\r\n    recipeStore,\r\n    plannedRecipes,\r\n    onDelete,\r\n    onUpdate }) => {\r\n\r\n    return (\r\n        <Card className=\"mealee-bucket\">\r\n            <Card.Header className=\"mealee-bucket-header\">{\"Day \" + (bucketId + 1)}</Card.Header>\r\n            <Card.Body className=\"mealee-bucket-body\">\r\n                {plannedRecipes.map(r =>\r\n                    <RecipeBox key={r.getRecipeId()}\r\n                        bucketId={bucketId}\r\n                        recipeStore={recipeStore}\r\n                        plannedRecipe={r}\r\n                        onDelete={(recipeId) => onDelete(bucketId, recipeId)}\r\n                        onUpdate={(plannedRecipe) => onUpdate(bucketId, plannedRecipe)} />)}\r\n            </Card.Body>\r\n        </Card>\r\n    )\r\n}\r\n\r\ntype DroppableBucketProps = BucketProps & {\r\n    onDrop: (buckedId: number, plannedRecipe: PlannedRecipe) => void,\r\n    onMove: (from: number, to: number, plannedRecipe: PlannedRecipe) => void\r\n}\r\n\r\nconst DroppableBucket: FunctionComponent<DroppableBucketProps> = ({\r\n    bucketId,\r\n    recipeStore,\r\n    plannedRecipes,\r\n    onDrop,\r\n    onMove,\r\n    onDelete,\r\n    onUpdate }) => {\r\n\r\n    const [{ isOver }, drop] = useDrop({\r\n        accept: \"recipe\",\r\n        drop: (dragr) => {\r\n            let r = dragr as unknown as { id: string, from?: number, plannedRecipe?: PlannedRecipe };\r\n            if (r.from !== undefined && r.plannedRecipe !== undefined) {\r\n                onMove(r.from, bucketId, r.plannedRecipe)\r\n            }\r\n            else {\r\n                let recipe = recipeStore.get(r.id)\r\n                onDrop(bucketId, new PlannedRecipe(r.id, recipe ? recipe.getServing() : 0))\r\n            }\r\n        },\r\n        collect: monitor => ({\r\n            isOver: !!monitor.isOver(),\r\n        }),\r\n    })\r\n\r\n    return (\r\n        <div\r\n            ref={drop}\r\n            style={{\r\n                position: 'relative',\r\n                width: '100%',\r\n                height: '100%',\r\n            }}>\r\n\r\n            <Bucket\r\n                bucketId={bucketId}\r\n                recipeStore={recipeStore}\r\n                plannedRecipes={plannedRecipes}\r\n                onDelete={onDelete}\r\n                onUpdate={onUpdate} />\r\n\r\n            {isOver && (\r\n                <div\r\n                    style={{\r\n                        position: 'absolute',\r\n                        top: 0,\r\n                        left: 0,\r\n                        height: '100%',\r\n                        width: '100%',\r\n                        zIndex: 1,\r\n                        opacity: 0.5,\r\n                        backgroundColor: 'yellow',\r\n                    }} />\r\n            )}\r\n\r\n        </div>\r\n    )\r\n}\r\n\r\ntype PlannerProps = {\r\n    recipeStore: RecipeStore,\r\n    plan: Plan,\r\n    updatePlan: (plan: Plan) => void\r\n}\r\n\r\nexport const Planner: FunctionComponent<PlannerProps> = ({ recipeStore, plan, updatePlan }) => {\r\n\r\n    const addRecipe = (bucketIdx: number, plannedRecipe: PlannedRecipe) => {\r\n        updatePlan(plan.setPlannedRecipe(bucketIdx, plannedRecipe))\r\n    }\r\n\r\n    const deleteRecipe = (bucketIdx: number, recipeId: string) => {\r\n        updatePlan(plan.deleteRecipeById(bucketIdx, recipeId))\r\n    }\r\n\r\n    const updatePlannedRecipe = (bucketIdx: number, plannedRecipe: PlannedRecipe) => {\r\n        updatePlan(plan.setPlannedRecipe(bucketIdx, plannedRecipe))\r\n    }\r\n\r\n    const movePlannedRecipe = (from: number, to: number, plannedRecipe: PlannedRecipe) => {\r\n        updatePlan(plan.deleteRecipeById(from, plannedRecipe.getRecipeId()).setPlannedRecipe(to, plannedRecipe))\r\n    }\r\n\r\n    let cols = _.range(plan.getNrBuckets()).map(i => {\r\n        return (\r\n            <Col key={i} xs=\"auto\" className=\"pr-2 pl-0\">\r\n                <DroppableBucket\r\n                    bucketId={i}\r\n                    recipeStore={recipeStore}\r\n                    plannedRecipes={plan.getPlannedRecipes(i)}\r\n                    onDrop={addRecipe}\r\n                    onDelete={deleteRecipe}\r\n                    onUpdate={updatePlannedRecipe}\r\n                    onMove={movePlannedRecipe} />\r\n            </Col>\r\n        )\r\n    })\r\n\r\n    return (\r\n        <Container className=\"pt-0 pb-2 pl-0 pr-0\">\r\n            <Row>\r\n                {cols}\r\n            </Row>\r\n        </Container>\r\n    );\r\n\r\n}\r\n","import React from \"react\";\r\n\r\nimport { Alert, Button } from \"react-bootstrap\";\r\nimport { Container, Col, Row, Image } from \"react-bootstrap\";\r\n\r\nimport './service/ScoringService';\r\n\r\nimport { RecipeSelector } from \"./component/RecipeSelector\";\r\nimport { Planner } from \"./component/Planner\";\r\n\r\nimport Tour from 'reactour';\r\n\r\nimport App from \"./App\";\r\nimport { Dialog } from \"./AppDialogs\";\r\n\r\nexport function renderInitialBody(this: App) {\r\n    return (\r\n        <Col xs=\"auto\" className=\"pt-3\">\r\n            <Tour\r\n                isOpen={this.state.isInitialTour}\r\n                onRequestClose={() => this.setIsInitialTour(false)}\r\n                steps={[\r\n                    {\r\n                        selector: '.my-first-step-a',\r\n                        content: <Container className=\"pt-4\">Load some recipes from a file or ...</Container>,\r\n                    },\r\n                    {\r\n                        selector: '.my-first-step-b',\r\n                        content: <Container className=\"pt-4\">... or add a new recipe manually!</Container>,\r\n                    }\r\n                ]} />\r\n            <Alert key=\"recipe\" variant=\"warning\">\r\n                I do not see any recipes. <Button variant=\"link\" className=\"pt-1\" onClick={() => this.setIsInitialTour(true)}>Are you new to Mealee?</Button>\r\n            </Alert>\r\n        </Col>\r\n    )\r\n};\r\n\r\nexport function renderDesktopBody(this: App) {\r\n\r\n    return (\r\n        <>\r\n            <Col xs=\"8\" sm=\"5\" md=\"4\" lg=\"3\" xl=\"3\" className=\"h-100\" style={{ minHeight: 0 }}>\r\n                <RecipeSelector\r\n                    plan={this.state.plan}\r\n                    scoring={this.state.recipeStore.scoreBy(this.state.plan, this.state.settings.getScoringFuns(), this.state.rand)}\r\n                    recipeStore={this.state.recipeStore}\r\n                    onEdit={this.editRecipe}\r\n                    highlightedRecipes={this.state.highlightedRecipes} />\r\n            </Col>\r\n            <Col>\r\n                <Container className=\"pt-2 pl-0 pr-0\">\r\n                    <Row>\r\n                        <Col>\r\n                            <Planner\r\n                                recipeStore={this.state.recipeStore}\r\n                                plan={this.state.plan}\r\n                                updatePlan={this.updatePlan} />\r\n                        </Col>\r\n                    </Row>\r\n                    {this.state.plan.getNrRecipes() > 0 &&\r\n                        <Row>\r\n                            <Col className=\"pl-0\">\r\n                                <Button\r\n                                    variant=\"mealee\"\r\n                                    onClick={this.showDialog(Dialog.SavePlanXLS)}>\r\n                                    Export plan &nbsp;\r\n                                <Image src=\"xlsx_logo.svg\" height=\"18\" />\r\n                                </Button>\r\n                                <Button\r\n                                    className=\"ml-2\"\r\n                                    variant=\"mealee\"\r\n                                    onClick={this.showDialog(Dialog.ShoppingList)}>\r\n                                    Show shopping list &nbsp;\r\n                                <Image src=\"todoist_logo.svg\" height=\"18\" />\r\n                                </Button>\r\n                            </Col>\r\n                        </Row>\r\n                    }\r\n                </Container>\r\n            </Col>\r\n        </>\r\n    )\r\n};\r\n","\r\nimport { Recipe, RecipeJSON } from './Recipe'\r\nimport { Settings, SettingsJSON } from './Settings'\r\n\r\nexport interface WorkspaceFileJSON {\r\n    fileVersion: number;\r\n    recipes: RecipeJSON[];\r\n    settings: SettingsJSON;\r\n    lastUpdated: string;\r\n}\r\n\r\nexport class Workspace {\r\n\r\n    constructor(recipes: Recipe[], settings: Settings, lastUpdated?: Date) {\r\n        this.recipes = recipes;\r\n        this.settings = settings;\r\n        this.lastUpdated = lastUpdated ?? new Date();\r\n    }\r\n\r\n    public getRecipes() {\r\n        return this.recipes;\r\n    }\r\n\r\n    public getSettings() {\r\n        return this.settings;\r\n    }\r\n\r\n    public getLastUpdated() {\r\n        return this.lastUpdated;\r\n    }\r\n\r\n    private recipes: Recipe[];\r\n    private settings: Settings;\r\n    private lastUpdated: Date;\r\n}","import { Recipe } from '../model/Recipe'\r\nimport { Workspace, WorkspaceFileJSON } from '../model/Workspace'\r\nimport { Settings } from '../model/Settings'\r\n\r\ndeclare module '../model/Workspace' {\r\n    interface Workspace {\r\n        serialize(): Blob,\r\n    }\r\n}\r\n\r\nWorkspace.prototype.serialize = function () {\r\n    let str = JSON.stringify({\r\n        fileVersion: 1,\r\n        recipes: this.getRecipes(),\r\n        settings: this.getSettings(),\r\n        lastUpdated: this.getLastUpdated().toISOString()\r\n    });\r\n    let bytes = new TextEncoder().encode(str);\r\n    let blob = new Blob([bytes], {\r\n        type: \"application/json;charset=utf-8\",\r\n    });\r\n    return blob;\r\n}\r\n\r\nexport function deserializeWokspaceFile(data: string) {\r\n    let json = JSON.parse(data);\r\n\r\n    if (typeof json === \"object\") {\r\n        let r: WorkspaceFileJSON = json;\r\n        if (!r.fileVersion) r.fileVersion = 1;\r\n\r\n        if (typeof r.fileVersion !== \"undefined\") {\r\n            if (r.fileVersion !== 1) {\r\n                throw new Error(\"Invalid recipe file version\");\r\n            }\r\n\r\n            let lastUpdated = r.lastUpdated ? new Date(Date.parse(r.lastUpdated)) : undefined\r\n\r\n            if (Array.isArray(r.recipes)) {\r\n                return new Workspace(\r\n                    r.recipes.map(Recipe.fromJSON),\r\n                    r.settings ? Settings.fromJSON(r.settings) : new Settings(),\r\n                    lastUpdated);\r\n            }\r\n        }\r\n    }\r\n\r\n    throw new Error(\"Invalid mealee file\");\r\n}\r\n","import React, { FunctionComponent } from 'react';\r\nimport { Container, Row, Col } from \"react-bootstrap\";\r\n\r\nimport { WorkspaceInfo } from '../model/WorkspaceInfo';\r\n\r\ntype InfoBoxProps = {\r\n    wsInfo: WorkspaceInfo\r\n}\r\n\r\nexport const InfoBox: FunctionComponent<InfoBoxProps> = ({ wsInfo }) => {\r\n\r\n    return (\r\n        <Container>\r\n            <Row>\r\n                <Col xs={6}>Last updated:</Col>\r\n                <Col sm=\"auto\">{wsInfo.lastUpdated ? wsInfo.lastUpdated.toLocaleString() : \"-\"}</Col>\r\n            </Row>\r\n            <Row>\r\n                <Col xs={6}>Number of recipes:</Col>\r\n                <Col sm=\"auto\">{wsInfo.nrRecipes}</Col>\r\n            </Row>\r\n        </Container>\r\n    )\r\n}\r\n\r\n","import React, { FunctionComponent } from \"react\";\r\n\r\nimport { Container, Row, Col } from \"react-bootstrap\";\r\nimport { OverlayTrigger, Tooltip, Popover } from \"react-bootstrap\";\r\nimport { Upload, Download, PlusCircle, InfoCircle, Gear } from 'react-bootstrap-icons';\r\n\r\nimport { InfoBox } from \"./InfoBox\";\r\nimport { WorkspaceInfo } from \"../model/WorkspaceInfo\";\r\n\r\ntype IconBarProps = {\r\n    onLoadFile: () => void;\r\n    onNewRecipe: () => void;\r\n    onSaveFile: () => void;\r\n    onEditSettings: () => void;\r\n    unsavedChanges: boolean;\r\n    wsInfo: WorkspaceInfo;\r\n};\r\n\r\nexport const IconBar: FunctionComponent<IconBarProps> = ({\r\n    onLoadFile,\r\n    onNewRecipe,\r\n    onSaveFile,\r\n    onEditSettings,\r\n    unsavedChanges,\r\n    wsInfo\r\n}) => {\r\n    return (\r\n        <Container className=\"pl-0 ml-2 mr-2 p-0\">\r\n            <Row className=\"mb-4\">\r\n                <Col className=\"pr-0\">\r\n                    <OverlayTrigger\r\n                        key=\"upload\"\r\n                        placement=\"right\"\r\n                        overlay={\r\n                            <Tooltip id=\"tooltip-upload\">\r\n                                Load recipes and settings\r\n                            </Tooltip>\r\n                        }>\r\n                        <Upload\r\n                            className=\"my-first-step-a\"\r\n                            style={{ color: \"#ffffff\", cursor: \"pointer\" }}\r\n                            onClick={onLoadFile} />\r\n                    </OverlayTrigger>\r\n                </Col>\r\n            </Row>\r\n            <Row className=\"mb-4\">\r\n                <Col className=\"pr-0\">\r\n                    <OverlayTrigger\r\n                        key=\"download\"\r\n                        placement=\"right\"\r\n                        overlay={\r\n                            <Tooltip id=\"tooltip-download\">\r\n                                Save recipes and settings\r\n                            </Tooltip>\r\n                        }>\r\n                        {unsavedChanges\r\n                            ? <Download\r\n                                className=\"text-warning\"\r\n                                style={{ cursor: \"pointer\" }}\r\n                                onClick={onSaveFile} />\r\n                            : <Download\r\n                                style={{ color: \"#ffffff40\" }} />\r\n                        }\r\n                    </OverlayTrigger>\r\n                </Col>\r\n            </Row>\r\n            <Row className=\"mb-4\">\r\n                <Col className=\"pr-0\">\r\n                    <OverlayTrigger\r\n                        key=\"new\"\r\n                        placement=\"right\"\r\n                        overlay={\r\n                            <Tooltip id=\"tooltip-new\">\r\n                                Add new recipe\r\n                            </Tooltip>\r\n                        }>\r\n                        <PlusCircle\r\n                            className=\"my-first-step-b\"\r\n                            style={{ color: \"#ffffff\", cursor: \"pointer\" }}\r\n                            onClick={onNewRecipe} />\r\n                    </OverlayTrigger>\r\n                </Col>\r\n            </Row>\r\n            <Row className=\"mb-4\">\r\n                <Col className=\"pr-0\">\r\n                    <OverlayTrigger\r\n                        key=\"info\"\r\n                        placement=\"right\"\r\n                        overlay={\r\n                            <Popover id=\"popover-info\" className=\"quick-info\">\r\n                                <Popover.Title>Recipes information</Popover.Title>\r\n                                <Popover.Content>\r\n                                    <InfoBox wsInfo={wsInfo} />\r\n                                </Popover.Content>\r\n                            </Popover>\r\n                        }>\r\n                        <InfoCircle\r\n                            style={{ color: \"#ffffff\", cursor: \"pointer\" }} />\r\n                    </OverlayTrigger>\r\n                </Col>\r\n            </Row>\r\n            <Row className=\"mb-4\">\r\n                <Col className=\"pr-0\">\r\n                    <OverlayTrigger\r\n                        key=\"settings\"\r\n                        placement=\"right\"\r\n                        overlay={\r\n                            <Tooltip id=\"tooltip-settings\">\r\n                                Settings\r\n                            </Tooltip>\r\n                        }>\r\n\r\n                        <Gear style={{\r\n                            color: \"#ffffff\",\r\n                            cursor: \"pointer\"\r\n                        }} onClick={onEditSettings} />\r\n                    </OverlayTrigger>\r\n                </Col>\r\n            </Row>\r\n        </Container>\r\n    );\r\n};\r\n","import React, { FunctionComponent } from \"react\";\r\n\r\nimport { Navbar, Nav, Image } from \"react-bootstrap\";\r\n\r\nfunction getVersionNumber() {\r\n    return `${process.env.REACT_APP_VERSION}`;\r\n}\r\n\r\nexport const MenuBar: FunctionComponent = () => {\r\n    return (\r\n        <Navbar bg=\"mealee-menu\" variant=\"dark\" className=\"pl-1\">\r\n            <Navbar.Brand className=\"logo mr-2\" href=\"#home\">\r\n                <Image src=\"mealee_logo_v9.svg\" height={60} alt=\"Mealee\" />\r\n            </Navbar.Brand>\r\n            <Navbar.Brand style={{ marginTop: 40 }}>\r\n                <span style={{\r\n                    fontFamily: \"'Baloo 2', cursive\",\r\n                    fontWeight: 500,\r\n                    fontSize: 30\r\n                }}>meal planning for geeks</span>\r\n            </Navbar.Brand>\r\n            <Navbar.Toggle aria-controls=\"basic-navbar-nav\" />\r\n            <Navbar.Collapse id=\"basic-navbar-nav\">\r\n                <Nav className=\"container-fluid\">\r\n                    <Nav.Item className=\"ml-auto\">\r\n                        <span style={{\r\n                            fontFamily: \"'Baloo 2', cursive\",\r\n                            fontWeight: 600,\r\n                            fontSize: 20,\r\n                            color: \"#D1EdF230\"\r\n                        }}>v{getVersionNumber()}\r\n                        </span>\r\n                    </Nav.Item>\r\n                </Nav>\r\n            </Navbar.Collapse>\r\n        </Navbar>\r\n    );\r\n};\r\n","import React from \"react\";\r\n\r\nimport { Container, Row, Col } from \"react-bootstrap\";\r\nimport { Alert } from \"react-bootstrap\";\r\n\r\nimport * as AppDialogs from \"./AppDialogs\";\r\nimport * as AppBodies from \"./AppBodies\";\r\n\r\nimport { Map, Set } from \"immutable\";\r\n\r\nimport { RecipeStore } from \"./store/RecipeStore\";\r\n\r\nimport { Settings } from \"./model/Settings\";\r\nimport { Plan } from \"./model/Plan\";\r\nimport { Recipe } from \"./model/Recipe\";\r\nimport { Workspace } from \"./model/Workspace\";\r\n\r\nimport \"./service/WorkspaceService\"\r\nimport { deserializeWokspaceFile } from \"./service/WorkspaceService\"\r\n\r\nimport { IconBar } from \"./component/IconBar\";\r\nimport { MenuBar } from \"./component/MenuBar\";\r\n\r\nimport { Beforeunload } from \"react-beforeunload\";\r\nimport { isMobileOnly } from \"react-device-detect\";\r\n\r\nimport \"bootstrap/dist/css/bootstrap.min.css\";\r\n\r\ntype AppState = {\r\n    recipeStore: RecipeStore;\r\n    settings: Settings;\r\n    plan: Plan;\r\n    showDialog?: Dialog;\r\n    recipeToEdit?: Recipe;\r\n    error: string | null;\r\n    unsavedChanges: boolean;\r\n    isInitialTour: boolean;\r\n    lastUpdated?: Date;\r\n    rand: Map<string, number>; // stable random numbers per recipe\r\n    highlightedRecipes: Set<string>;\r\n};\r\n\r\nenum Dialog {\r\n    LoadFile,\r\n    SaveFile,\r\n    RecipeEditor,\r\n    SavePlanXLS,\r\n    ShoppingList,\r\n    PlanSettings\r\n}\r\n\r\nclass App extends React.Component<{}, AppState> {\r\n    constructor(props: {}) {\r\n        super(props);\r\n\r\n        let recipeStore = new RecipeStore();\r\n        let planSettings = new Settings();\r\n        let plan = Plan.new(planSettings.getNrBuckets());\r\n\r\n        // Hard binding is needed if `loadFile` do not use arrow notation\r\n        // this.loadFile = this.loadFile.bind(this);\r\n        this.state = {\r\n            recipeStore: recipeStore,\r\n            settings: planSettings,\r\n            plan: plan,\r\n            showDialog: undefined,\r\n            recipeToEdit: undefined,\r\n            error: null,\r\n            unsavedChanges: false,\r\n            isInitialTour: false,\r\n            rand: Map(),\r\n            highlightedRecipes: Set()\r\n        };\r\n    }\r\n\r\n    public renderDialog = AppDialogs.renderDialog;\r\n    public renderInitialBody = AppBodies.renderInitialBody;\r\n    public renderDesktopBody = AppBodies.renderDesktopBody;\r\n\r\n    addRecipes = (newRecipes: Recipe[], fromFile = false) => {\r\n        this.setState((st) => {\r\n            // You want to save only if it is not a first file load\r\n            let needsSave =\r\n                st.unsavedChanges || !(fromFile && st.recipeStore.count() === 0);\r\n\r\n            let newRand = newRecipes.reduce((acc: Map<string, number>, r: Recipe) => {\r\n                if (acc.has(r.getId())) {\r\n                    return acc;\r\n                } else {\r\n                    return acc.set(r.getId(), Math.random());\r\n                }\r\n            }, st.rand)\r\n\r\n            let ret = {};\r\n            let newRecipeStore = st.recipeStore.addAll(newRecipes);\r\n\r\n            if (newRecipeStore !== st.recipeStore) {\r\n                ret = {\r\n                    recipeStore: newRecipeStore,\r\n                    rand: newRand,\r\n                    highlightedRecipes: needsSave ? Set(newRecipes.map(r => r.getId())) : Set(),\r\n                    unsavedChanges: needsSave\r\n                };\r\n            }\r\n\r\n            return ret;\r\n        });\r\n    };\r\n\r\n    setIsInitialTour = (t: boolean) => {\r\n        this.setState({ isInitialTour: t });\r\n    }\r\n\r\n    saveRecipe = (recipe: Recipe) => {\r\n        this.addRecipes([recipe]);\r\n        this.closeRecipeEditor();\r\n    };\r\n\r\n    onFileLoaded = (ev: ProgressEvent<FileReader>) => {\r\n        let data = ev.target?.result;\r\n\r\n        if (typeof data == \"string\") {\r\n            try {\r\n                let ws = deserializeWokspaceFile(data);\r\n                this.addRecipes(ws.getRecipes(), true);\r\n                this.updateSettings(ws.getSettings(), true);\r\n                this.setState({ lastUpdated: ws.getLastUpdated() });\r\n            } catch (e) {\r\n                this.setState({ error: e.message });\r\n            }\r\n        }\r\n        this.closeDialog();\r\n    };\r\n\r\n    loadFile = (file: File) => {\r\n        var reader = new FileReader();\r\n        reader.onload = (ev) => this.onFileLoaded(ev);\r\n        reader.readAsText(file, \"UTF-8\");\r\n    };\r\n\r\n    genRecipeFileContent = () => {\r\n        let ws = new Workspace(this.state.recipeStore.all(), this.state.settings);\r\n        return ws.serialize();\r\n    };\r\n\r\n    fileSaved = () => {\r\n        this.setState({ unsavedChanges: false, lastUpdated: new Date() });\r\n        this.closeDialog();\r\n    };\r\n\r\n    showDialog = (dialog: Dialog) => {\r\n        return () => this.setState({ showDialog: dialog });\r\n    };\r\n\r\n    closeDialog = () => {\r\n        this.setState({ showDialog: undefined });\r\n    };\r\n\r\n    closeRecipeEditor = () => {\r\n        this.setState({ recipeToEdit: undefined, showDialog: undefined });\r\n    };\r\n\r\n    dismissError = () => {\r\n        this.setState({ error: null });\r\n    };\r\n\r\n    updateSettings = (ps: Settings, fromFile = false) => {\r\n        this.setState((st) => {\r\n            return {\r\n                settings: ps,\r\n                unsavedChanges: !fromFile,\r\n                plan: st.plan.setNrBuckets(ps.getNrBuckets()),\r\n                showDialog: undefined\r\n            };\r\n        });\r\n    };\r\n\r\n    updatePlan = (plan: Plan) => {\r\n        this.setState({\r\n            plan: plan\r\n        });\r\n    };\r\n\r\n    editRecipe = (recipe: Recipe) => {\r\n        this.setState({ showDialog: Dialog.RecipeEditor, recipeToEdit: recipe });\r\n    };\r\n\r\n    deleteRecipe = (recipe: Recipe) => {\r\n        this.setState((st) => {\r\n            let newRecipeStore = st.recipeStore.delete(recipe.getId());\r\n\r\n            return {\r\n                recipeStore: newRecipeStore,\r\n                showDialog: undefined,\r\n                recipeToEdit: undefined,\r\n                unsavedChanges: true,\r\n            };\r\n        });\r\n    };\r\n\r\n    render(this: App) {\r\n\r\n        return (\r\n            <Container fluid className=\"d-flex flex-column vh-100\">\r\n                <Alert\r\n                    variant=\"danger\"\r\n                    onClose={this.dismissError}\r\n                    show={!!this.state.error}\r\n                    dismissible>\r\n                    {this.state.error}\r\n                </Alert>\r\n\r\n                {this.state.unsavedChanges &&\r\n                    <Beforeunload onBeforeunload={() => \"You'll lose your data!\"} />\r\n                }\r\n\r\n                {this.renderDialog()}\r\n\r\n                <Row>\r\n                    <Col>\r\n                        <MenuBar />\r\n                    </Col>\r\n                </Row>\r\n\r\n                {!isMobileOnly\r\n                    ?\r\n                    <Row className=\"h-100\" style={{ minHeight: 0 }}>\r\n                        <Col xs=\"auto\" className=\"pl-0 pr-2 pt-3\">\r\n                            <IconBar\r\n                                onLoadFile={this.showDialog(Dialog.LoadFile)}\r\n                                onNewRecipe={this.showDialog(Dialog.RecipeEditor)}\r\n                                onSaveFile={this.showDialog(Dialog.SaveFile)}\r\n                                onEditSettings={this.showDialog(Dialog.PlanSettings)}\r\n                                unsavedChanges={this.state.unsavedChanges}\r\n                                wsInfo={{\r\n                                    lastUpdated: this.state.lastUpdated,\r\n                                    nrRecipes: this.state.recipeStore.count()\r\n                                }} />\r\n                        </Col>\r\n                        {this.state.recipeStore.count() === 0 && this.renderInitialBody()}\r\n                        {this.state.recipeStore.count() > 0 && !isMobileOnly && this.renderDesktopBody()}\r\n                    </Row>\r\n                    :\r\n                    <Row>\r\n                        <Col className=\"mt-3\">\r\n                            <Alert key=\"recipe\" variant=\"danger\">\r\n                                Mobile is not supported as for now. Please try it on a little bit bigger device. Sorry for that.\r\n              </Alert>\r\n                        </Col>\r\n                    </Row>\r\n                }\r\n\r\n            </Container >\r\n        );\r\n    }\r\n}\r\n\r\nexport default App;\r\n","import './index.css'\r\nimport React from 'react'\r\nimport ReactDOM from 'react-dom'\r\nimport App from './App'\r\nimport ReactGA from 'react-ga'\r\n\r\nimport {\r\n    BrowserRouter as Router,\r\n    Switch,\r\n    Route,\r\n    Redirect,\r\n    useLocation\r\n} from \"react-router-dom\"\r\n\r\nimport { isMobile } from \"react-device-detect\"\r\n\r\nimport HttpsRedirect from 'react-https-redirect'\r\nimport { DndProvider } from 'react-dnd'\r\nimport { HTML5Backend } from 'react-dnd-html5-backend'\r\nimport { TouchBackend } from 'react-dnd-touch-backend'\r\n\r\nconst trackingId = \"UA-74643376-3\"\r\nReactGA.initialize(trackingId)\r\n/*\r\nReactGA.set({\r\n any data that is relevant to the user session\r\n that you would like to track with google analytics\r\n})\r\n*/\r\nReactGA.pageview(\"/\")\r\n\r\n// A custom hook that builds on useLocation to parse\r\n// the query string for you.\r\nfunction useQuery() {\r\n    return new URLSearchParams(useLocation().search)\r\n}\r\n\r\nconst AppRoot = () => {\r\n    let location = useLocation()\r\n\r\n    console.log(\"state\")\r\n    console.log(location.state)\r\n\r\n    return (\r\n        <DndProvider backend={isMobile ? TouchBackend : HTML5Backend}>\r\n            <App />\r\n        </DndProvider>\r\n    )\r\n}\r\n\r\nconst GoogleCallback = () => {\r\n    let query = useQuery()\r\n\r\n    return (\r\n        <Redirect to={{\r\n            pathname: process.env.PUBLIC_URL,\r\n            state: {\r\n                callback: \"google-signin\",\r\n                token: query.get(\"token\")\r\n            }\r\n        }} />\r\n    )\r\n}\r\n\r\nReactDOM.render(\r\n    <React.StrictMode>\r\n        <HttpsRedirect>\r\n            <Router>\r\n                <Switch>\r\n                    <Route exact path={process.env.PUBLIC_URL}>\r\n                        <AppRoot />\r\n                    </Route>\r\n                    <Route path={process.env.PUBLIC_URL + \"/google-signin\"}>\r\n                        <GoogleCallback />\r\n                    </Route>\r\n                </Switch>\r\n            </Router>\r\n        </HttpsRedirect>\r\n    </React.StrictMode>,\r\n    document.getElementById('root')\r\n)\r\n"],"sourceRoot":""}